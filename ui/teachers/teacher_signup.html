<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Teacher Signup â€” Paper X</title>
  <link rel="icon" type="image/x-icon" href="../assets/img/favicon.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,600,0,0"
    rel="stylesheet">
  <link rel="stylesheet" href="../assets/css/tailwind.css" />
  <script src="../config.js"></script>
  <script>
    if (window.tailwind) {
      tailwind.config = { darkMode: 'class', theme: { container: { center: true, padding: '1rem' }, extend: { fontFamily: { sans: ['Inter', 'ui-sans-serif', 'system-ui', 'sans-serif'] }, colors: { brand: { 900: '#1E1E2F', 700: '#4C2A59', 500: '#9E4B8A' }, brandlt: { 50: '#FAF5FB', 100: '#F3E7F2', 200: '#E7D0E4', 300: '#D9B4D3', 400: '#C88DBA', 500: '#9E4B8A', 700: '#4C2A59', 900: '#1E1E2F' }, ink: '#1E1E2F', plum: '#4C2A59', orchid: '#9E4B8A' }, boxShadow: { glow: '0 8px 30px rgba(158,75,138,0.35)', card: '0 24px 60px rgba(30,30,47,0.35)' }, backgroundImage: { 'hero-dark': 'radial-gradient(1000px 600px at 50% -10%, rgba(158,75,138,0.28), transparent 60%), linear-gradient(180deg, #1E1E2F 0%, #201934 35%, #141321 100%)', 'hero-light': 'radial-gradient(1000px 600px at 50% -10%, rgba(158,75,138,0.18), transparent 60%), linear-gradient(180deg, #FFFFFF 0%, #FBF8FC 45%, #F7F2F9 100%)' } } } };
    }
  </script>
  <style>
    .material-symbols-rounded {
      vertical-align: -6px
    }

    .gradient-hero-text {
      display: inline-block;
      background-image: linear-gradient(90deg, #1E1E2F, #4C2A59, #9E4B8A, #4C2A59, #1E1E2F);
      background-size: 200% 200%;
      animation: gradient-shift 4s ease-in-out infinite;
      color: transparent;
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      -webkit-box-decoration-break: clone;
      box-decoration-break: clone;
    }

    .dark .gradient-hero-text {
      background-image: linear-gradient(90deg, #EFA3DC, #CA6CB3, #FFFFFF, #CA6CB3, #EFA3DC)
    }

    @keyframes gradient-shift {
      0% {
        background-position: 0% 50%
      }

      50% {
        background-position: 100% 50%
      }

      100% {
        background-position: 0% 50%
      }
    }

    .glass-card {
      background: rgba(255, 255, 255, .82);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(158, 75, 138, .18)
    }

    .dark .glass-card {
      background: rgba(30, 30, 47, .72);
      border-color: rgba(255, 255, 255, .12);
      box-shadow: 0 20px 45px rgba(0, 0, 0, .45)
    }

    .dark body {
      background-image: linear-gradient(to left top, #1e1e2f, #242138, #2b2440, #332649, #3d2850, #3f254a, #402244, #401f3e, #34182d, #26131e, #190b11, #000000);
      background-repeat: no-repeat;
      background-size: cover
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: .4rem;
      padding: .35rem .6rem;
      border-radius: 9999px;
      font-size: 12px;
      line-height: 1;
      background: rgba(158, 75, 138, .10);
      color: #4C2A59;
      border: 1px solid rgba(158, 75, 138, .20)
    }

    .pill button {
      background: transparent;
      border: 0;
      color: inherit;
      cursor: pointer
    }
  </style>
  <script>(() => { const s = localStorage.getItem('px_theme'); const prefers = window.matchMedia('(prefers-color-scheme: dark)').matches; const dark = s ? s === 'dark' : prefers; if (dark) { document.documentElement.classList.add('dark'); } else { document.documentElement.classList.remove('dark'); } })();</script>
</head>

<body
  class="min-h-screen font-sans antialiased text-neutral-900 dark:text-white bg-hero-light dark:bg-hero-dark overflow-x-hidden">
  <div aria-hidden="true" class="pointer-events-none fixed inset-0 -z-10">
    <div
      class="absolute -top-32 -left-24 w-[420px] h-[420px] rounded-full bg-brand-500/15 blur-[110px] dark:bg-brand-500/30">
    </div>
    <div
      class="absolute top-[40%] -right-24 w-[380px] h-[380px] rounded-full bg-brand-700/15 blur-[120px] dark:bg-brand-700/35">
    </div>
  </div>
  <header
    class="sticky top-0 z-40 bg-white/70 dark:bg-brand-900/60 backdrop-blur border-b border-black/5 dark:border-white/10">
    <div class="container flex items-center justify-between py-4">
      <a href="../index.html" class="flex items-center gap-3">
        <img src="../assets/img/logo-light.svg" class="h-9 w-auto dark:hidden" alt="Paper X" />
        <img src="../assets/img/logo-dark.svg" class="h-9 w-auto hidden dark:block" alt="Paper X" />
      </a>
      <nav class="hidden md:flex items-center gap-6 text-sm text-neutral-700 dark:text-white/85">
        <a href="../index.html" class="hover:text-brandlt-900 dark:hover:text-white">Home</a>
        <a href="../about.html" class="hover:text-brandlt-900 dark:hover:text-white">About</a>
        <a href="../contact.html" class="hover:text-brandlt-900 dark:hover:text-white">Contact</a>
        <a href="../help.html" class="hover:text-brandlt-900 dark:hover:text-white">Help</a>
        <a href="teacher_login.html" class="hover:text-brandlt-900 dark:hover:text-white">Teacher Login</a>
        <a href="teacher_connect.html" class="hover:text-brandlt-900 dark:hover:text-white">Connect</a>
      </nav>
      <div class="hidden md:flex items-center gap-2">
        <button data-theme-toggle
          class="inline-flex items-center gap-2 rounded-full px-3 py-2 text-sm ring-1 ring-black/10 dark:ring-white/15 hover:bg-black/5 dark:hover:bg-white/5"
          aria-label="Toggle theme"><span class="material-symbols-rounded">dark_mode</span><span
            class="hidden sm:block">Theme</span></button>
      </div>
    </div>
  </header>
  <main>
    <section class="relative overflow-hidden pt-8 pb-16">
      <div
        class="pointer-events-none absolute inset-0 opacity-[0.35] bg-[radial-gradient(circle_at_20%_10%,rgba(158,75,138,0.25),transparent_60%),radial-gradient(circle_at_80%_85%,rgba(76,42,89,0.28),transparent_60%)]">
      </div>
      <div class="container relative z-10 grid gap-12 lg:grid-cols-[minmax(0,1.05fr)_minmax(0,0.95fr)] items-start">
        <div class="space-y-6">
          <span
            class="inline-flex items-center gap-2 rounded-full px-4 py-2 text-xs font-semibold text-white bg-gradient-to-r from-[#9E4B8A] via-[#B06AB3] to-[#FF7FD1] shadow-[0_8px_20px_rgba(158,75,138,0.25)] hover:shadow-[0_12px_28px_rgba(158,75,138,0.32)] transition">Apply
            as Teacher</span>
          <div class="space-y-4">
            <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight leading-tight gradient-hero-text">Join Paper X
              Faculty Network</h1>
            <div
              class="rounded-3xl overflow-hidden bg-white/80 dark:bg-white/5 ring-1 ring-black/5 dark:ring-white/10 shadow-soft dark:shadow-glow aspect-[16/9] md:aspect-[21/10] max-w-xl md:max-w-lg">
              <video class="w-full h-full object-cover" autoplay muted loop playsinline>
                <source src="../assets/video/register.mp4" type="video/mp4" />
              </video>
            </div>
          </div>
          <ul class="space-y-3 text-sm text-neutral-600 dark:text-white/65">
            <li class="flex items-start gap-3"><span
                class="mt-0.5 inline-flex size-6 items-center justify-center rounded-full bg-brand-500/15 text-brand-500"><span
                  class="material-symbols-rounded text-base">verified_user</span></span> Admin approval ensures trusted
              profiles.</li>
            <li class="flex items-start gap-3"><span
                class="mt-0.5 inline-flex size-6 items-center justify-center rounded-full bg-brand-700/25 text-brand-700 dark:bg-brand-700/30 dark:text-brand-400"><span
                  class="material-symbols-rounded text-base">upload</span></span> Upload ID card (front/back) for
              verification.</li>
            <li class="flex items-start gap-3"><span
                class="mt-0.5 inline-flex size-6 items-center justify-center rounded-full bg-brand-500/15 text-brand-500"><span
                  class="material-symbols-rounded text-base">school</span></span> Link to your college, degree, and
              department.</li>
          </ul>
        </div>

        <div class="relative">
          <div
            class="glass-card rounded-3xl p-5 sm:p-6 shadow-soft dark:shadow-glow ring-1 ring-black/5 dark:ring-white/10">
            <div class="mb-6 space-y-2 text-center">
            </div>
            <form id="teacherSignupForm" class="space-y-8" enctype="multipart/form-data">
              <section class="rounded-2xl p-6 bg-white/70 dark:bg-white/5 ring-1 ring-black/5 dark:ring-white/10">
                <h2 class="text-sm font-semibold uppercase tracking-wider text-neutral-500 dark:text-white/60 mb-4">
                  Account</h2>
                <div class="space-y-6">
                  <div>
                    <label class="block text-xs font-semibold tracking-wide uppercase mb-1">Full Name</label>
                    <input type="text" name="name" required
                      class="w-full rounded-lg border-neutral-300 dark:border-white/15 bg-white/70 dark:bg-brand-900/40 focus:ring-brand-500 focus:border-brand-500" />
                  </div>
                  <div class="grid md:grid-cols-3 gap-6">
                    <div>
                      <label class="block text-xs font-semibold tracking-wide uppercase mb-1">Email</label>
                      <input type="email" name="email" required
                        class="w-full rounded-lg border-neutral-300 dark:border-white/15 bg-white/70 dark:bg-brand-900/40 focus:ring-brand-500 focus:border-brand-500" />
                    </div>
                    <div>
                      <label class="block text-xs font-semibold tracking-wide uppercase mb-1">Password</label>
                      <input type="password" name="password" required minlength="6"
                        class="w-full rounded-lg border-neutral-300 dark:border-white/15 bg-white/70 dark:bg-brand-900/40 focus:ring-brand-500 focus:border-brand-500" />
                    </div>
                    <div>
                      <label class="block text-xs font-semibold tracking-wide uppercase mb-1">Confirm Password</label>
                      <input type="password" name="confirm_password" required minlength="6"
                        class="w-full rounded-lg border-neutral-300 dark:border-white/15 bg-white/70 dark:bg-brand-900/40 focus:ring-brand-500 focus:border-brand-500" />
                    </div>
                  </div>
                  <div class="grid sm:grid-cols-2 gap-6">
                    <div>
                      <label class="block text-xs font-semibold tracking-wide uppercase mb-2">ID Card Front
                        (Image)</label>
                      <div class="relative group">
                        <label for="id_card_front"
                          class="flex flex-col items-center justify-center w-full h-20 border-2 border-dashed rounded-xl cursor-pointer border-neutral-300 dark:border-white/20 bg-white/50 dark:bg-white/5 hover:border-brand-500 dark:hover:border-brand-400 hover:bg-brand-50 dark:hover:bg-brand-500/10 transition-all">
                          <div class="flex flex-col items-center justify-center pt-3 pb-3">
                            <span
                              class="material-symbols-rounded text-3xl text-brand-500 dark:text-brand-400 mb-1">upload_file</span>
                            <p class="text-xs text-neutral-600 dark:text-white/70 font-medium">Click to upload</p>
                            <p class="text-[10px] text-neutral-500 dark:text-white/50">PNG, JPG (MAX. 5MB)</p>
                          </div>
                          <input id="id_card_front" type="file" name="id_card_front" accept="image/*" required
                            class="hidden" />
                        </label>
                      </div>
                      <img id="previewFront" alt="Front Preview"
                        class="mt-2 hidden rounded-lg ring-1 ring-black/10 dark:ring-white/10 max-h-40 w-full object-cover" />
                    </div>
                    <div>
                      <label class="block text-xs font-semibold tracking-wide uppercase mb-2">ID Card Back
                        (Image)</label>
                      <div class="relative group">
                        <label for="id_card_back"
                          class="flex flex-col items-center justify-center w-full h-20 border-2 border-dashed rounded-xl cursor-pointer border-neutral-300 dark:border-white/20 bg-white/50 dark:bg-white/5 hover:border-brand-500 dark:hover:border-brand-400 hover:bg-brand-50 dark:hover:bg-brand-500/10 transition-all">
                          <div class="flex flex-col items-center justify-center pt-3 pb-3">
                            <span
                              class="material-symbols-rounded text-3xl text-brand-500 dark:text-brand-400 mb-1">upload_file</span>
                            <p class="text-xs text-neutral-600 dark:text-white/70 font-medium">Click to upload</p>
                            <p class="text-[10px] text-neutral-500 dark:text-white/50">PNG, JPG (MAX. 5MB)</p>
                          </div>
                          <input id="id_card_back" type="file" name="id_card_back" accept="image/*" required
                            class="hidden" />
                        </label>
                      </div>
                      <img id="previewBack" alt="Back Preview"
                        class="mt-2 hidden rounded-lg ring-1 ring-black/10 dark:ring-white/10 max-h-40 w-full object-cover" />
                    </div>
                  </div>
                  <div class="grid md:grid-cols-3 gap-6">
                    <div>
                      <label class="block text-xs font-semibold tracking-wide uppercase mb-1">College</label>
                      <select id="collegeSelect" name="college"
                        class="w-full rounded-lg border-neutral-300 dark:border-white/15 bg-white/70 dark:bg-brand-900/40 focus:ring-brand-500 focus:border-brand-500">
                        <option value="">-- Select College --</option>
                      </select>
                    </div>
                    <div>
                      <label class="block text-xs font-semibold tracking-wide uppercase mb-1">Degree</label>
                      <select id="degreeSelect" name="degree"
                        class="w-full rounded-lg border-neutral-300 dark:border-white/15 bg-white/70 dark:bg-brand-900/40 focus:ring-brand-500 focus:border-brand-500">
                        <option value="">-- Select Degree --</option>
                      </select>
                    </div>
                    <div>
                      <label class="block text-xs font-semibold tracking-wide uppercase mb-1">Department</label>
                      <select id="departmentSelect" name="department"
                        class="w-full rounded-lg border-neutral-300 dark:border-white/15 bg-white/70 dark:bg-brand-900/40 focus:ring-brand-500 focus:border-brand-500">
                        <option value="">-- Select Department --</option>
                      </select>
                    </div>
                  </div>

                  <div class="text-center text-xs text-neutral-500 dark:text-white/60">Showcase of your expertise and
                    past credits will be handled after approval.</div>
                </div>
              </section>
              <div class="flex justify-end">
                <button type="submit"
                  class="inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-[#9E4B8A] via-[#B06AB3] to-[#FF7FD1] px-6 py-3 text-sm font-semibold text-white shadow-[0_10px_30px_rgba(158,75,138,0.28)] hover:shadow-[0_16px_36px_rgba(158,75,138,0.35)] transition">Submit
                  Application</button>
              </div>
            </form>
            <div id="appStatus" class="mt-6 hidden text-sm rounded-xl px-4 py-3 font-medium"></div>
          </div>
          <p class="mt-4 text-[11px] text-center text-neutral-500 dark:text-white/45">By submitting you agree to our <a
              href="#" class="underline">Terms</a> and <a href="#" class="underline">Privacy Policy</a>.</p>
        </div>
      </div>
    </section>
  </main>
  <script>
    // Dynamic API base discovery: fall back to :8000 if serving UI from a different static port (e.g. 5500)
    let API_BASE = window.API_BASE || '';
    (function resolveApiBase() {
      if (API_BASE) return; // externally injected
      const origin = location.origin;
      // If already on expected API port (8000) or running through backend /ui mount, use origin
      if (location.port === '8000' || origin.includes('/ui')) { API_BASE = origin; return; }
      // Try common backend ports (8000) on same host
      const host = location.hostname;
      const candidates = [origin, `http://${host}:8000`, `https://${host}:8000`];
      // Pick first that responds to public health/meta endpoint
      const testPath = '/api/public/academic-meta';
      let tried = 0;
      function tryNext(i) {
        if (i >= candidates.length) { console.warn('[api-base] All candidates failed, using current origin'); API_BASE = origin; return; }
        const base = candidates[i].replace(/\/$/, '');
        fetch(base + testPath, { method: 'GET' })
          .then(r => { if (r.ok) { API_BASE = base; } else { tried++; tryNext(i + 1); } })
          .catch(() => { tried++; tryNext(i + 1); });
      }
      tryNext(0);
    })();
    const form = document.getElementById('teacherSignupForm');
    const frontInput = form.querySelector('input[name="id_card_front"]');
    const backInput = form.querySelector('input[name="id_card_back"]');
    const previewFront = document.getElementById('previewFront');
    const previewBack = document.getElementById('previewBack');
    const collegeSelect = document.getElementById('collegeSelect');
    const degreeSelect = document.getElementById('degreeSelect');
    const departmentSelect = document.getElementById('departmentSelect');
    const statusBox = document.getElementById('appStatus');

    let academicMeta = { colleges: [], degrees: [], departments: [] };
    async function loadAcademicOptions() {
      try {
        // Wait a brief moment if API_BASE still resolving
        let attempts = 0; while ((!API_BASE || API_BASE === location.origin) && attempts < 5) { await new Promise(r => setTimeout(r, 120)); attempts++; }
        const url = (API_BASE || location.origin).replace(/\/$/, '') + '/api/public/academic-meta';
        const res = await fetch(url);
        if (!res.ok) {
          const txt = await res.text().catch(() => '<no body>');
          throw new Error('Failed to load academic metadata (' + res.status + '): ' + txt.substring(0, 140));
        }
        academicMeta = await res.json();
      } catch (e) {
        console.warn('Academic load failed', e);
        // Surface inline error UI
        const errBox = document.getElementById('appStatus');
        if (errBox) {
          errBox.className = 'mt-6 text-sm rounded-xl px-4 py-3 font-medium bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-300';
          errBox.style.display = 'block';
          errBox.textContent = 'Academic metadata load failed. Please ensure backend API (:8000) is running. ' + (e.message || '');
        }
        return;
      }
      populateColleges();
      populateDegrees();
      populateDepartments();
    }
    function clearSelect(sel, placeholder) {
      sel.innerHTML = '';
      const o = document.createElement('option'); o.value = ''; o.textContent = placeholder; sel.appendChild(o);
    }
    function populateColleges() {
      clearSelect(collegeSelect, '-- Select College --');
      (academicMeta.colleges || []).forEach(c => { const opt = document.createElement('option'); opt.value = c.id; opt.textContent = c.name; collegeSelect.appendChild(opt); });
    }
    function populateDegrees() {
      clearSelect(degreeSelect, '-- Select Degree --');
      const collegeId = collegeSelect.value;
      (academicMeta.degrees || []).filter(d => !collegeId || d.college_id === collegeId).forEach(d => { const opt = document.createElement('option'); opt.value = d.id; opt.textContent = d.name; degreeSelect.appendChild(opt); });
    }
    function populateDepartments() {
      clearSelect(departmentSelect, '-- Select Department --');
      const collegeId = collegeSelect.value;
      const degreeId = degreeSelect.value;
      (academicMeta.departments || []).filter(dep => (!collegeId || dep.college_id === collegeId) && (!degreeId || dep.degree_id === degreeId)).forEach(dep => { const opt = document.createElement('option'); opt.value = dep.id; opt.textContent = dep.name; departmentSelect.appendChild(opt); });
    }
    collegeSelect.addEventListener('change', () => { populateDegrees(); populateDepartments(); });
    degreeSelect.addEventListener('change', () => { populateDepartments(); });

    function attachPreview(input, img) {
      input.addEventListener('change', () => {
        const f = input.files?.[0];
        if (!f) { img.classList.add('hidden'); return; }
        const url = URL.createObjectURL(f);
        img.src = url; img.classList.remove('hidden');
      });
    }
    attachPreview(frontInput, previewFront);
    attachPreview(backInput, previewBack);

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const fd = new FormData(form);
      fd.set('college', collegeSelect.options[collegeSelect.selectedIndex]?.text || '');
      fd.set('degree', degreeSelect.options[degreeSelect.selectedIndex]?.text || '');
      fd.set('department', departmentSelect.options[departmentSelect.selectedIndex]?.text || '');
      statusBox.style.display = 'none';
      try {
        const base = (API_BASE || location.origin).replace(/\/$/, '');
        const res = await fetch(base + '/api/teacher/signup', { method: 'POST', body: fd });
        const data = await res.json();
        if (!res.ok) throw new Error(data.detail || 'Signup failed');
        localStorage.setItem('teacherToken', data.access_token || '');
        try { localStorage.removeItem('px_token'); } catch { }
        statusBox.className = 'status pending';
        statusBox.textContent = 'Application submitted. Waiting for approval...';
        statusBox.style.display = 'block';
        pollStatus();
      } catch (err) {
        alert(err.message);
      }
    });

    async function pollStatus() {
      const token = localStorage.getItem('teacherToken');
      if (!token) return;
      try {
        const res = await fetch(API_BASE + '/api/teacher/me/status', { headers: { 'Authorization': 'Bearer ' + token } });
        if (!res.ok) return;
        const data = await res.json();
        if (data.status) {
          statusBox.style.display = 'block';
          statusBox.className = 'status ' + data.status;
          statusBox.textContent = 'Status: ' + data.status + (data.role === 'teacher' ? ' (role assigned)' : '');
          if (data.status === 'approved' && data.role === 'teacher') {
            statusBox.textContent += ' You can now access Teacher Connect & Notes.';
            return; // stop polling
          }
        }
      } catch (e) { /* ignore */ }
      setTimeout(pollStatus, 6000);
    }

    loadAcademicOptions();
    pollStatus();

    // Theme toggle functionality
    function initThemeToggle() {
      const themeToggleBtn = document.querySelector('[data-theme-toggle]');
      const htmlElement = document.documentElement;

      function updateThemeIcon() {
        if (!themeToggleBtn) return;
        const icon = themeToggleBtn.querySelector('.material-symbols-rounded');
        if (!icon) return;
        if (htmlElement.classList.contains('dark')) {
          icon.textContent = 'light_mode';
        } else {
          icon.textContent = 'dark_mode';
        }
      }

      if (themeToggleBtn) {
        themeToggleBtn.addEventListener('click', (e) => {
          e.preventDefault();
          htmlElement.classList.toggle('dark');
          const isDark = htmlElement.classList.contains('dark');
          localStorage.setItem('px_theme', isDark ? 'dark' : 'light');
          updateThemeIcon();
          console.log('Theme toggled to:', isDark ? 'dark' : 'light');
        });

        // Initialize icon on page load
        updateThemeIcon();
      } else {
        console.warn('Theme toggle button not found');
      }
    }

    // Initialize theme toggle
    initThemeToggle();
  </script>
</body>

</html>