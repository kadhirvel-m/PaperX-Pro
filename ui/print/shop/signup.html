<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Shop Sign Up — PaperX</title>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Inter + Material Symbols -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,600,0,0"
    rel="stylesheet">

  <!-- Runtime Tailwind config -->
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'ui-sans-serif', 'system-ui'] },
          colors: {
            brand: {
              50: '#F6F5FA',
              100: '#EEEAF4',
              200: '#D9CCE6',
              300: '#C1A3D2',
              400: '#A574BD',
              500: '#9E4B8A', /* PaperX Magenta Pink */
              600: '#6E3868',
              700: '#4C2A59', /* Deep Purple */
              800: '#2C2240',
              900: '#1E1E2F'  /* Dark Indigo */
            }
          },
          boxShadow: {
            'elev-1': '0 1px 2px rgba(0,0,0,.06), 0 1px 1px rgba(0,0,0,.04)',
            'elev-2': '0 8px 24px rgba(0,0,0,.12)',
            'neon': '0 0 0 1px rgba(158,75,138,.25), 0 8px 32px rgba(158,75,138,.25)'
          },
          backgroundImage: {
            'grid': 'linear-gradient(to right, rgba(255,255,255,.06) 1px, transparent 1px), linear-gradient(to bottom, rgba(255,255,255,.06) 1px, transparent 1px)'
          }
        }
      }
    }
  </script>

  <script src="../../config.js"></script>

  <style>
    .material-symbols-rounded {
      vertical-align: -6px
    }

    .glass {
      background: rgba(255, 255, 255, .82);
      backdrop-filter: blur(12px)
    }

    .dark .glass {
      background: rgba(30, 30, 47, .55)
    }

    .ring-soft {
      box-shadow: inset 0 0 0 1px rgba(0, 0, 0, .08)
    }

    .dark .ring-soft {
      box-shadow: inset 0 0 0 1px rgba(255, 255, 255, .12)
    }

    .focus-ring:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(158, 75, 138, .35)
    }
  </style>
</head>

<body
  class="min-h-screen font-sans antialiased text-neutral-900 dark:text-white bg-[radial-gradient(1200px_600px_at_10%_-10%,rgba(158,75,138,.18),transparent),radial-gradient(900px_500px_at_110%_10%,rgba(76,42,89,.25),transparent)] dark:bg-[radial-gradient(1200px_600px_at_10%_-10%,rgba(158,75,138,.2),transparent),radial-gradient(900px_500px_at_110%_10%,rgba(30,30,47,.7),transparent)]">
  <!-- Top App Bar -->
  <header
    class="sticky top-0 z-50 backdrop-blur border-b border-black/5 dark:border-white/10 bg-white/70 dark:bg-brand-900/60">
    <div class="max-w-6xl mx-auto px-4 flex items-center justify-between h-16">
      <a href="../index.html" class="flex items-center gap-2 group">
        <span class="material-symbols-rounded">home</span>
        <span class="font-semibold tracking-tight group-hover:underline">Home</span>
      </a>

      <div class="flex items-center gap-3">
        <button id="themeToggle"
          class="inline-flex items-center gap-2 px-3 py-1.5 rounded-full ring-soft hover:shadow-elev-1 transition">
          <span class="material-symbols-rounded" id="themeIcon">dark_mode</span>
          <span class="text-sm">Theme</span>
        </button>
        <a href="./login.html" class="text-sm hover:underline">Already have an account?</a>
      </div>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-6xl mx-auto px-4 py-10 grid grid-cols-1 lg:grid-cols-12 gap-6">
    <!-- Left: Form Card -->
    <section class="lg:col-span-7 relative">
      <div class="absolute -inset-1 rounded-3xl blur-2xl bg-gradient-to-br from-brand-500/20 to-brand-700/20 -z-10">
      </div>

      <div class="glass rounded-3xl p-6 lg:p-8 ring-1 ring-black/5 dark:ring-white/10 shadow-neon">
        <div class="flex items-start justify-between mb-6">
          <div>
            <h1 class="text-2xl font-bold tracking-tight">Create Your Print Shop</h1>
            <p class="text-sm opacity-80">Sign up as the owner and list your capabilities. You’ll appear in students’
              nearby shop search instantly.</p>
          </div>
          <span
            class="inline-flex items-center gap-1 text-xs px-2 py-1 rounded-full bg-brand-500/15 text-brand-500 ring-1 ring-brand-500/30">
            <span class="material-symbols-rounded text-sm">verified</span> Trusted
          </span>
        </div>

        <!-- Stepper -->
        <ol class="grid grid-cols-3 gap-2 mb-6 text-[12px]">
          <li
            class="flex items-center gap-2 rounded-lg px-3 py-2 bg-brand-500/10 ring-1 ring-brand-500/30 text-brand-100 dark:text-white">
            <span class="material-symbols-rounded text-base">person</span> Owner
          </li>
          <li class="flex items-center gap-2 rounded-lg px-3 py-2 ring-soft">
            <span class="material-symbols-rounded text-base">storefront</span> Shop
          </li>
          <li class="flex items-center gap-2 rounded-lg px-3 py-2 ring-soft">
            <span class="material-symbols-rounded text-base">print</span> Capabilities
          </li>
        </ol>

        <form id="authForm" class="grid grid-cols-1 md:grid-cols-2 gap-4 text-[13px]">
          <!-- Owner -->
          <div class="md:col-span-2">
            <div class="text-sm font-semibold mb-2">Owner Account</div>
          </div>

          <label class="block">
            <span class="text-xs opacity-80">Email</span>
            <input name="email" type="email" required
              class="mt-1 w-full px-3 py-2 rounded-lg bg-white/90 dark:bg-white/5 ring-soft focus-ring"
              placeholder="owner@zeroxshop.com" />
          </label>

          <label class="block relative">
            <span class="text-xs opacity-80">Password</span>
            <input id="password" name="password" type="password" minlength="6" required
              class="mt-1 w-full px-3 py-2 rounded-lg bg-white/90 dark:bg-white/5 ring-soft focus-ring pr-10"
              placeholder="At least 6 characters" />
            <button type="button" id="togglePwd"
              class="absolute right-2 bottom-2.5 p-1 rounded-md hover:bg-black/5 dark:hover:bg-white/10">
              <span class="material-symbols-rounded text-base">visibility</span>
            </button>
            <span id="pwdHint" class="block text-[11px] mt-1 opacity-70">Use 8+ chars with a number & symbol for
              stronger security.</span>
          </label>

          <!-- Shop -->
          <div class="md:col-span-2 pt-2">
            <div class="text-sm font-semibold mb-2">Shop Details</div>
          </div>

          <label class="block md:col-span-2">
            <span class="text-xs opacity-80">Shop Name</span>
            <input name="shop_name" required
              class="mt-1 w-full px-3 py-2 rounded-lg bg-white/90 dark:bg-white/5 ring-soft focus-ring"
              placeholder="ZeroX Prints, MG Road" />
          </label>

          <label class="block">
            <span class="text-xs opacity-80">Phone</span>
            <input name="phone" inputmode="tel"
              class="mt-1 w-full px-3 py-2 rounded-lg bg-white/90 dark:bg-white/5 ring-soft focus-ring"
              placeholder="+91 9XXXXXXXXX" />
          </label>

          <label class="block">
            <span class="text-xs opacity-80">Shop Email</span>
            <input name="shop_email" type="email"
              class="mt-1 w-full px-3 py-2 rounded-lg bg-white/90 dark:bg-white/5 ring-soft focus-ring"
              placeholder="hello@zeroxprints.in" />
          </label>

          <label class="block md:col-span-2">
            <span class="text-xs opacity-80">Address</span>
            <input name="address"
              class="mt-1 w-full px-3 py-2 rounded-lg bg-white/90 dark:bg-white/5 ring-soft focus-ring"
              placeholder="Door no., Street, Area, City, Pincode" />
          </label>

          <!-- Capabilities -->
          <div class="md:col-span-2 pt-1">
            <div class="text-sm font-semibold mb-2">Capabilities</div>
          </div>

          <div class="md:col-span-2 grid sm:grid-cols-3 gap-3">
            <!-- Color -->
            <label class="flex items-center justify-between px-3 py-2 rounded-xl ring-soft bg-white/80 dark:bg-white/5">
              <span class="inline-flex items-center gap-2">
                <span class="material-symbols-rounded text-base">palette</span> Color
              </span>
              <input type="checkbox" name="cap_color" checked class="toggle toggle-sm accent-brand-500 cursor-pointer">
            </label>

            <!-- Duplex -->
            <label class="flex items-center justify-between px-3 py-2 rounded-xl ring-soft bg-white/80 dark:bg-white/5">
              <span class="inline-flex items-center gap-2">
                <span class="material-symbols-rounded text-base">compare_arrows</span> Duplex
              </span>
              <input type="checkbox" name="cap_duplex" checked class="toggle toggle-sm accent-brand-500 cursor-pointer">
            </label>

            <!-- Sizes (kept as <select multiple> to match your API code; styled better) -->
            <label class="block">
              <span class="text-xs opacity-80">Supported Sizes</span>
              <select name="cap_sizes" multiple
                class="mt-1 w-full px-2 py-2 rounded-lg bg-white/90 dark:bg-white/5 ring-soft focus-ring h-[42px]">
                <option selected>A4</option>
                <option>A3</option>
                <option>Letter</option>
              </select>
              <span class="text-[11px] opacity-70">Tip: Hold Ctrl / Cmd to select multiple.</span>
            </label>
          </div>

          <!-- Actions -->
          <div class="md:col-span-2 flex items-center gap-3 pt-2">
            <button id="submit" type="submit"
              class="inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-brand-500 text-white hover:bg-brand-700 active:scale-[.99] transition shadow-elev-2">
              <span class="material-symbols-rounded text-base" aria-hidden="true">storefront</span>
              <span>Create Shop</span>
            </button>
            <div id="status" class="text-[12px] opacity-80"></div>
          </div>
        </form>
      </div>
    </section>

    <!-- Right: Info / Highlights -->
    <section class="lg:col-span-5">
      <div class="glass rounded-3xl p-6 lg:p-8 ring-1 ring-black/5 dark:ring-white/10">
        <div class="flex items-center gap-2 mb-4">
          <span class="material-symbols-rounded">tips_and_updates</span>
          <h2 class="text-lg font-semibold">What happens next</h2>
        </div>
        <ol class="text-[13px] space-y-3 opacity-90 list-decimal list-inside">
          <li>We create your owner account with the email/password above.</li>
          <li>Your shop profile goes live with the capabilities you set.</li>
          <li>You’re redirected to the Jobs Board to start accepting print jobs.</li>
        </ol>

        <hr class="my-6 border-black/10 dark:border-white/10">

        <div class="grid sm:grid-cols-2 gap-3">
          <div class="p-4 rounded-2xl bg-white/70 dark:bg-white/5 ring-soft">
            <div class="flex items-center gap-2 mb-1">
              <span class="material-symbols-rounded">pin_drop</span>
              <p class="text-sm font-semibold">Show up in Nearby</p>
            </div>
            <p class="text-[12px] opacity-80">Students discover you by distance, live availability, and price.</p>
          </div>
          <div class="p-4 rounded-2xl bg-white/70 dark:bg-white/5 ring-soft">
            <div class="flex items-center gap-2 mb-1">
              <span class="material-symbols-rounded">bolt</span>
              <p class="text-sm font-semibold">1-Tap Print</p>
            </div>
            <p class="text-[12px] opacity-80">Shop receives jobs with the exact print settings. Just press print.</p>
          </div>
          <div class="p-4 rounded-2xl bg-white/70 dark:bg-white/5 ring-soft">
            <div class="flex items-center gap-2 mb-1">
              <span class="material-symbols-rounded">shield_person</span>
              <p class="text-sm font-semibold">OTP Pickup</p>
            </div>
            <p class="text-[12px] opacity-80">Secure handover with job OTP shared to the student.</p>
          </div>
          <div class="p-4 rounded-2xl bg-white/70 dark:bg-white/5 ring-soft">
            <div class="flex items-center gap-2 mb-1">
              <span class="material-symbols-rounded">payments</span>
              <p class="text-sm font-semibold">Bring Your Own Pricing</p>
            </div>
            <p class="text-[12px] opacity-80">Flexible per-page & binding rates (configure later in dashboard).</p>
          </div>
        </div>
      </div>

      <div class="mt-6 rounded-3xl p-6 bg-brand-900 text-white overflow-hidden relative">
        <div class="absolute inset-0 opacity-10 bg-grid bg-[size:32px_32px]"></div>
        <div class="relative">
          <h3 class="text-xl font-bold mb-2">Pro tip</h3>
          <p class="text-sm opacity-90">
            Add <span class="font-semibold">A3 Color</span> and <span class="font-semibold">Spiral Binding</span> to
            appear in more student searches.
          </p>
        </div>
      </div>
    </section>
  </main>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 hidden">
    <div class="px-4 py-2 rounded-xl bg-brand-500 text-white shadow-elev-2">
      <span id="toastMsg" class="text-sm"></span>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    // Theme toggle
    const themeBtn = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const saved = localStorage.getItem('px_theme');
    if ((saved === 'dark') || (!saved && prefersDark)) document.documentElement.classList.add('dark');

    function syncIcon() {
      themeIcon.textContent = document.documentElement.classList.contains('dark') ? 'light_mode' : 'dark_mode';
    }
    syncIcon();
    themeBtn.addEventListener('click', () => {
      document.documentElement.classList.toggle('dark');
      localStorage.setItem('px_theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
      syncIcon();
    });

    // Password show/hide
    document.getElementById('togglePwd').addEventListener('click', () => {
      const pwd = document.getElementById('password');
      pwd.type = pwd.type === 'password' ? 'text' : 'password';
    });

    // Toast helper
    function toast(msg, ms = 1800) {
      const t = document.getElementById('toast');
      const m = document.getElementById('toastMsg');
      m.textContent = msg; t.classList.remove('hidden', 'opacity-0');
      t.classList.add('transition', 'duration-200');
      setTimeout(() => { t.classList.add('opacity-0'); setTimeout(() => t.classList.add('hidden'), 200); }, ms);
    }

    // API submit (preserves your contract, but adds UX niceties)
    const API = (window.API_BASE || '').replace(/\/$/, '');
    const form = document.getElementById('authForm');
    const statusEl = document.getElementById('status');
    const submitBtn = document.getElementById('submit');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      statusEl.textContent = '';
      submitBtn.disabled = true;
      submitBtn.classList.add('opacity-70', 'pointer-events-none');
      const originalBtn = submitBtn.innerHTML;
      submitBtn.innerHTML = `<span class="material-symbols-rounded animate-spin text-base">progress_activity</span> <span>Creating…</span>`;

      const fd = new FormData(e.currentTarget);
      const email = fd.get('email');
      const password = fd.get('password');
      const shop_name = fd.get('shop_name');
      const phone = fd.get('phone');
      const shop_email = fd.get('shop_email');
      const address = fd.get('address');

      // Sizes: support <select multiple>
      const selectEl = e.currentTarget.querySelector('select[name="cap_sizes"]');
      const sizes = Array.from(selectEl?.selectedOptions || []).map(o => o.value);

      const capabilities = {
        color: !!fd.get('cap_color'),
        duplex: !!fd.get('cap_duplex'),
        sizes,
        bindings: ['none', 'staple', 'spiral'],
        gsm: [70, 80, 100]
      };

      try {
        // 1) Signup
        const r1 = await fetch(`${API}/signup`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password })
        });
        const j1 = await r1.json().catch(() => ({}));
        if (!r1.ok) {
          const msg = j1.detail || 'Signup failed';
          statusEl.textContent = msg; toast(msg);
          return;
        }
        const token = j1.access_token || '';
        if (!token) { statusEl.textContent = 'Missing token from signup'; toast('Missing token from signup'); return; }
        localStorage.setItem('px_token', token);

        // 2) Create shop
        const r2 = await fetch(`${API}/api/shop/signup`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json', Authorization: 'Bearer ' + token },
          body: JSON.stringify({ name: shop_name, phone, email: shop_email, address, capabilities })
        });
        const j2 = await r2.json().catch(() => ({}));
        if (!r2.ok) {
          const msg = j2.detail || 'Shop creation failed';
          statusEl.textContent = msg; toast(msg);
          return;
        }

        statusEl.textContent = 'Created. Redirecting…';
        toast('Shop created! Redirecting…');
        setTimeout(() => location.href = './jobs.html', 600);

      } catch (err) {
        statusEl.textContent = 'Network error';
        toast('Network error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.classList.remove('opacity-70', 'pointer-events-none');
        submitBtn.innerHTML = originalBtn;
      }
    });
  </script>
</body>

</html>