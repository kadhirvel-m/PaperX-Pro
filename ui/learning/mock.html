<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>PaperX Learning Tracks — Mock Arena</title>
    <link rel="icon" type="image/x-icon" href="../assets/img/favicon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,600,0,0"
        rel="stylesheet">
    <script>
        window.tailwind = window.tailwind || {};
        window.tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['Inter', 'ui-sans-serif', 'system-ui', 'sans-serif'] },
                    colors: {
                        brand: {
                            900: '#1E1E2F',
                            700: '#4C2A59',
                            500: '#9E4B8A',
                            300: '#C88DBA'
                        },
                        surface: '#0E1020'
                    }
                }
            }
        };
    </script>
    <link rel="stylesheet" href="../assets/css/tailwind.css" />
    <script defer src="../config.js"></script>
    <script defer src="tracks.js"></script>
</head>

<body class="min-h-screen bg-gradient-to-br from-surface via-brand-900 to-brand-700 text-white">
    <header class="border-b border-white/10 bg-black/40 backdrop-blur">
        <div class="mx-auto flex max-w-5xl items-center justify-between px-6 py-5">
            <div>
                <a href="dashboard.html"
                    class="inline-flex items-center gap-2 text-sm font-semibold text-white/70 hover:text-white">
                    <span class="material-symbols-rounded text-base">arrow_back</span>
                    Back to dashboard
                </a>
                <h1 class="mt-2 text-3xl font-bold tracking-tight text-white">Mock & Interview Arena</h1>
                <p class="text-sm text-white/70">Company-aware drill sets powered by Gemini 2.5 Flash.</p>
            </div>
            <div class="hidden flex-col items-end text-xs uppercase tracking-wider text-white/60 md:flex" id="planMeta">
            </div>
        </div>
    </header>

    <main class="mx-auto grid max-w-5xl gap-6 px-6 py-10 md:grid-cols-[minmax(0,1.4fr)_minmax(0,2fr)]">
        <section class="space-y-6">
            <article class="rounded-3xl border border-white/10 bg-white/5 p-6 shadow-lg shadow-black/40">
                <h2 class="text-lg font-semibold text-white">Session setup</h2>
                <form id="mockForm" class="mt-4 space-y-5 text-sm text-white/80">
                    <div>
                        <label class="text-xs uppercase tracking-wider text-white/50" for="focusRound">Focus
                            round</label>
                        <select id="focusRound"
                            class="mt-2 w-full rounded-xl border border-white/20 bg-black/40 px-3 py-2 text-white outline-none focus:border-white/50">
                            <option value="coding_round">Coding round</option>
                            <option value="system_design">System design</option>
                            <option value="behavioral">Behavioural</option>
                            <option value="mixed">Mixed interview</option>
                        </select>
                    </div>
                    <div>
                        <span class="text-xs uppercase tracking-wider text-white/50">Recently covered topics</span>
                        <div id="topicChecklist"
                            class="mt-3 grid max-h-48 gap-2 overflow-y-auto rounded-2xl border border-white/10 bg-white/5 p-3 text-xs">
                        </div>
                    </div>
                    <div class="flex items-center justify-between">
                        <span id="mockStatus" class="text-xs text-brand-300"></span>
                        <button type="submit"
                            class="inline-flex items-center gap-2 rounded-full bg-brand-500 px-5 py-2 text-sm font-semibold text-brand-900">
                            <span class="material-symbols-rounded text-base">stadia_controller</span>
                            Generate session
                        </button>
                    </div>
                </form>
            </article>
            <article class="rounded-3xl border border-white/10 bg-white/5 p-6 text-sm text-white/70">
                <h2 class="text-lg font-semibold text-white">Arena tips</h2>
                <ul class="mt-3 space-y-2">
                    <li>• Coding rounds reference LeetCode and GfG practice archives filtered by company.</li>
                    <li>• System design prompts follow company interview blueprints.</li>
                    <li>• Behavioural questions map to STAR narratives relevant to the selected stack.</li>
                </ul>
            </article>
        </section>
        <section class="rounded-3xl border border-white/10 bg-black/30 p-6 shadow-2xl shadow-black/60">
            <div class="flex items-center justify-between gap-4">
                <h2 class="text-lg font-semibold text-white">Session plan</h2>
                <button id="exportSession"
                    class="inline-flex items-center gap-2 rounded-full border border-white/20 px-3 py-1 text-xs uppercase tracking-wider text-white/70 hover:border-white/40">
                    <span class="material-symbols-rounded text-base">download</span>
                    Export JSON
                </button>
            </div>
            <div id="mockOutput" class="mt-5 space-y-6 text-sm text-white/80"></div>
        </section>
    </main>

    <template id="checkTemplate">
        <label class="flex items-center gap-2 rounded-xl border border-white/10 bg-black/40 px-3 py-2">
            <input type="checkbox"
                class="h-4 w-4 rounded border-white/30 bg-transparent text-brand-300 focus:ring-brand-300" />
            <span class="flex-1">Topic</span>
        </label>
    </template>

    <template id="sectionTemplate">
        <div class="rounded-2xl border border-white/10 bg-white/5 p-4">
            <h3 class="text-sm font-semibold text-white">Section title</h3>
            <div class="mt-3 space-y-3"></div>
        </div>
    </template>

    <template id="questionTemplate">
        <div class="rounded-xl bg-black/40 px-3 py-3 text-sm text-white/80">
            <p class="font-semibold">Question</p>
            <p class="mt-1 text-xs text-white/60">Rubric</p>
            <div class="mt-2 flex flex-wrap items-center gap-3 text-xs text-brand-300"></div>
        </div>
    </template>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const plan = PaperXLearning.ensurePlan();
            const planMeta = document.getElementById('planMeta');
            planMeta.innerHTML = '';
            ['language', 'stack', 'goal'].forEach(function (key) {
                const span = document.createElement('span');
                span.textContent = key + ': ' + (plan[key] || '').toUpperCase();
                planMeta.appendChild(span);
            });
            const companySpan = document.createElement('span');
            companySpan.textContent = 'companies: ' + (plan.companies || []).map(c => c.toUpperCase()).join(', ');
            planMeta.appendChild(companySpan);

            const topicChecklist = document.getElementById('topicChecklist');
            const checkTemplate = document.getElementById('checkTemplate');
            (plan.modules || []).forEach(function (module) {
                (module.topics || []).forEach(function (topic) {
                    const node = checkTemplate.content.firstElementChild.cloneNode(true);
                    node.querySelector('span').textContent = topic.title;
                    node.querySelector('input').value = topic.title;
                    topicChecklist.appendChild(node);
                });
            });

            const form = document.getElementById('mockForm');
            const mockOutput = document.getElementById('mockOutput');
            const mockStatus = document.getElementById('mockStatus');
            const exportBtn = document.getElementById('exportSession');
            let latestPlan = null;

            const sectionTemplate = document.getElementById('sectionTemplate');
            const questionTemplate = document.getElementById('questionTemplate');

            function renderSection(name, questions) {
                const section = sectionTemplate.content.firstElementChild.cloneNode(true);
                section.querySelector('h3').textContent = name;
                const bucket = section.querySelector('div');
                (questions || []).forEach(function (q) {
                    const card = questionTemplate.content.firstElementChild.cloneNode(true);
                    card.querySelector('p.font-semibold').textContent = q.title || q.prompt || 'Question';
                    card.querySelector('p.mt-1').textContent = q.rubric || 'Focus on clarity, structure, and company alignment.';
                    const meta = card.querySelector('div.flex');
                    meta.innerHTML = '';
                    if (q.difficulty) {
                        const pill = document.createElement('span');
                        pill.textContent = 'Difficulty: ' + q.difficulty;
                        meta.appendChild(pill);
                    }
                    if (q.estimated_minutes) {
                        const pill = document.createElement('span');
                        pill.textContent = 'Time: ' + q.estimated_minutes + ' mins';
                        meta.appendChild(pill);
                    }
                    bucket.appendChild(card);
                });
                mockOutput.appendChild(section);
            }

            form.addEventListener('submit', async function (event) {
                event.preventDefault();
                mockStatus.textContent = '';
                mockOutput.innerHTML = '';
                const selectedTopics = Array.from(topicChecklist.querySelectorAll('input:checked')).map(function (input) { return input.value; });
                try {
                    latestPlan = await PaperXLearning.requestMock({
                        stack: plan.stack,
                        goal: plan.goal,
                        companies: plan.companies,
                        language: plan.language,
                        focus_round: document.getElementById('focusRound').value,
                        recent_topics: selectedTopics
                    });
                    Object.keys(latestPlan || {}).forEach(function (key) {
                        if (Array.isArray(latestPlan[key]) && latestPlan[key].length) {
                            renderSection(key.replace(/_/g, ' ').toUpperCase(), latestPlan[key]);
                        }
                    });
                } catch (err) {
                    mockStatus.textContent = 'Mock generation failed: ' + err.message;
                }
            });

            exportBtn.addEventListener('click', function () {
                if (!latestPlan) {
                    mockStatus.textContent = 'Generate a session before exporting.';
                    return;
                }
                const blob = new Blob([JSON.stringify(latestPlan, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = 'paperx-mock-session.json';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
            });
        });
    </script>
</body>

</html>