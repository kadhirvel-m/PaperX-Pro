<!DOCTYPE html>
<html lang="en" class="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explorable: The Relational Model</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: {
                            500: '#6366f1', // Indigo
                            600: '#4f46e5',
                        }
                    },
                    fontFamily: {
                        mono: ['ui-monospace', 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', "Liberation Mono", "Courier New", 'monospace'],
                        sans: ['system-ui', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/Flip.min.js"></script>

    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        body {
            transition: background-color 0.3s, color 0.3s;
        }

        .glass-panel {
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }

        .connector-line {
            fill: none;
            stroke-width: 3;
            stroke-linecap: round;
            pointer-events: none;
            stroke-dasharray: 1000;
            stroke-dashoffset: 1000;
        }

        /* Custom scrollbar for data tables */
        .scroller::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .scroller::-webkit-scrollbar-track {
            background: transparent;
        }

        .scroller::-webkit-scrollbar-thumb {
            background-color: rgba(156, 163, 175, 0.5);
            border-radius: 4px;
        }
    </style>
</head>

<body
    class="bg-slate-50 text-slate-900 dark:bg-slate-950 dark:text-slate-200 min-h-screen overflow-x-hidden selection:bg-brand-500 selection:text-white">

    <nav
        class="fixed top-0 w-full z-50 px-6 py-4 flex justify-between items-center glass-panel border-b border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-slate-950/80">
        <div class="flex items-center gap-2">
            <i data-lucide="database" class="text-brand-500 h-6 w-6"></i>
            <span class="font-bold tracking-tight text-lg">Data<span class="text-brand-500">Struct</span></span>
        </div>
        <button id="theme-toggle" class="p-2 rounded-full hover:bg-slate-200 dark:hover:bg-slate-800 transition-colors">
            <i data-lucide="sun" class="hidden dark:block h-5 w-5 text-yellow-400"></i>
            <i data-lucide="moon" class="block dark:hidden h-5 w-5 text-slate-600"></i>
        </button>
    </nav>

    <main class="pt-24 pb-20 max-w-5xl mx-auto px-4 sm:px-6">

        <header class="mb-20 text-center">
            <div class="inline-flex items-center justify-center p-3 rounded-2xl bg-brand-500/10 text-brand-500 mb-6">
                <i data-lucide="music-2" class="w-8 h-8"></i>
            </div>
            <h1 class="text-4xl md:text-6xl font-extrabold tracking-tight mb-6">
                The Jukebox Problem
            </h1>
            <p class="text-xl md:text-2xl text-slate-600 dark:text-slate-400 max-w-3xl mx-auto leading-relaxed">
                Imagine a jukebox with 10,000 songs. <br>
                If you write the Artist's full biography on <em>every single sticker</em> of every song they sang, you
                run out of space immediately.
            </p>
            <p class="mt-4 text-lg text-brand-500 font-medium">
                The Relational Model is the art of writing things once, then using a "Shortcut Number" to find it again.
            </p>
        </header>

        <section
            class="relative bg-white dark:bg-slate-900 rounded-3xl border border-slate-200 dark:border-slate-800 shadow-2xl overflow-hidden mb-24">

            <div
                class="p-6 border-b border-slate-200 dark:border-slate-800 flex flex-col sm:flex-row justify-between items-center gap-4 bg-slate-50 dark:bg-slate-900/50">
                <div class="flex items-center gap-3">
                    <span class="text-sm font-bold uppercase tracking-wider text-slate-500">Mode:</span>
                    <div class="flex bg-slate-200 dark:bg-slate-800 rounded-lg p-1">
                        <button id="btn-flat"
                            class="px-4 py-2 rounded-md text-sm font-medium bg-white dark:bg-slate-700 shadow-sm text-brand-600 transition-all">Flat
                            (Messy)</button>
                        <button id="btn-relational"
                            class="px-4 py-2 rounded-md text-sm font-medium text-slate-500 hover:text-slate-900 dark:hover:text-slate-200 transition-all">Relational
                            (Clean)</button>
                    </div>
                </div>
                <div class="text-xs text-slate-500 flex items-center gap-2">
                    <i data-lucide="mouse-pointer-2" class="w-4 h-4"></i>
                    <span id="instruction-text">View the redundant data mess.</span>
                </div>
            </div>

            <div id="stage" class="relative p-4 md:p-8 min-h-[500px] flex flex-col md:flex-row gap-8 overflow-hidden">

                <svg id="connection-layer" class="absolute inset-0 w-full h-full pointer-events-none z-20"></svg>

                <div id="container-songs" class="flex-1 transition-all duration-700">
                    <div class="mb-3 flex justify-between items-end">
                        <h3 class="text-lg font-bold flex items-center gap-2">
                            <i data-lucide="list-music" class="w-5 h-5 text-brand-500"></i>
                            The Playlist
                        </h3>
                        <span
                            class="text-xs font-mono text-slate-500 bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded">Table:
                            Songs</span>
                    </div>

                    <div
                        class="bg-slate-100 dark:bg-slate-950 rounded-xl border border-slate-200 dark:border-slate-800 overflow-hidden shadow-inner">
                        <table class="w-full text-left text-sm">
                            <thead class="bg-slate-200 dark:bg-slate-800 text-xs uppercase text-slate-500">
                                <tr>
                                    <th class="p-3">Track</th>
                                    <th class="p-3 w-1/3 transition-colors duration-500" id="th-artist">Artist (Data)
                                    </th>
                                    <th class="p-3 text-right">Dur</th>
                                </tr>
                            </thead>
                            <tbody id="tbody-songs" class="divide-y divide-slate-200 dark:divide-slate-800">
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="container-artists"
                    class="w-0 opacity-0 overflow-hidden transition-all duration-700 flex flex-col">
                    <div class="mb-3 flex justify-between items-end">
                        <h3 class="text-lg font-bold flex items-center gap-2">
                            <i data-lucide="users" class="w-5 h-5 text-emerald-500"></i>
                            Artist Directory
                        </h3>
                        <span
                            class="text-xs font-mono text-slate-500 bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded">Table:
                            Artists</span>
                    </div>

                    <div
                        class="bg-emerald-500/5 dark:bg-emerald-900/10 rounded-xl border border-emerald-500/20 dark:border-emerald-500/20 overflow-hidden shadow-inner flex-1">
                        <table class="w-full text-left text-sm">
                            <thead
                                class="bg-emerald-100/50 dark:bg-emerald-900/30 text-xs uppercase text-emerald-600 dark:text-emerald-400">
                                <tr>
                                    <th class="p-3">ID</th>
                                    <th class="p-3">Artist Name</th>
                                    <th class="p-3">Genre</th>
                                </tr>
                            </thead>
                            <tbody id="tbody-artists" class="divide-y divide-emerald-500/10 dark:divide-emerald-500/20">
                            </tbody>
                        </table>
                    </div>
                    <div class="mt-4 p-3 bg-slate-100 dark:bg-slate-800 rounded-lg text-xs text-slate-500">
                        <p><strong>Note:</strong> We only store "Daft Punk" once here. The playlist just points to ID
                            #1.</p>
                    </div>
                </div>

            </div>
        </section>

        <section class="space-y-8">
            <h2 class="text-3xl font-bold border-l-4 border-brand-500 pl-4">Under The Hood</h2>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">

                <div
                    class="col-span-1 bg-white dark:bg-slate-900 p-6 rounded-2xl border border-slate-200 dark:border-slate-800 hover:border-brand-500 transition-colors group">
                    <div
                        class="w-10 h-10 bg-emerald-100 dark:bg-emerald-900/30 text-emerald-600 rounded-lg flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                        <i data-lucide="key" class="w-5 h-5"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-2">Primary Key (PK)</h3>
                    <p class="text-slate-600 dark:text-slate-400 text-sm mb-4">
                        Remember the "ID" in the Artist Directory? That's a Primary Key. It is a unique social security
                        number for that specific row of data.
                    </p>
                    <code class="block bg-slate-100 dark:bg-slate-950 p-2 rounded text-xs font-mono text-emerald-600">
                        id INT PRIMARY KEY AUTO_INCREMENT
                    </code>
                </div>

                <div
                    class="col-span-1 bg-white dark:bg-slate-900 p-6 rounded-2xl border border-slate-200 dark:border-slate-800 hover:border-brand-500 transition-colors group">
                    <div
                        class="w-10 h-10 bg-brand-100 dark:bg-brand-900/30 text-brand-600 rounded-lg flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                        <i data-lucide="link" class="w-5 h-5"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-2">Foreign Key (FK)</h3>
                    <p class="text-slate-600 dark:text-slate-400 text-sm mb-4">
                        The "Shortcut Number" in the Playlist. It doesn't hold data; it points to a Primary Key in
                        another table.
                    </p>
                    <code class="block bg-slate-100 dark:bg-slate-950 p-2 rounded text-xs font-mono text-brand-500">
                        artist_id INT, <br>
                        FOREIGN KEY (artist_id) REFERENCES Artists(id)
                    </code>
                </div>

                <div
                    class="col-span-1 bg-white dark:bg-slate-900 p-6 rounded-2xl border border-slate-200 dark:border-slate-800 hover:border-brand-500 transition-colors group">
                    <div
                        class="w-10 h-10 bg-purple-100 dark:bg-purple-900/30 text-purple-600 rounded-lg flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                        <i data-lucide="shrink" class="w-5 h-5"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-2">Normalization</h3>
                    <p class="text-slate-600 dark:text-slate-400 text-sm mb-4">
                        The process of splitting that "Messy Flat List" into clean, separated tables to reduce
                        redundancy and errors.
                    </p>
                    <div class="flex gap-2 text-xs font-mono mt-2">
                        <span class="bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded">1NF</span>
                        <span class="bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded">2NF</span>
                        <span class="bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded">3NF</span>
                    </div>
                </div>

                <div
                    class="col-span-1 md:col-span-3 bg-slate-950 p-8 rounded-2xl border border-slate-800 relative overflow-hidden">
                    <div class="absolute top-0 right-0 p-4 opacity-20">
                        <i data-lucide="code-2" class="w-32 h-32"></i>
                    </div>
                    <h3 class="text-slate-200 font-bold mb-4">SQL Representation</h3>
                    <div class="grid md:grid-cols-2 gap-8 font-mono text-sm">
                        <div>
                            <p class="text-slate-500 mb-2">// 1. Create the Artist Table</p>
                            <pre class="text-emerald-400">
CREATE TABLE Artists (
    id INT PRIMARY KEY,
    name VARCHAR(100),
    genre VARCHAR(50)
);</pre>
                        </div>
                        <div>
                            <p class="text-slate-500 mb-2">// 2. Create the Song Table with a Link</p>
                            <pre class="text-blue-400">
CREATE TABLE Songs (
    id INT PRIMARY KEY,
    title VARCHAR(100),
    duration INT,
    artist_id INT, <span class="text-slate-500">-- The Bridge</span>
    FOREIGN KEY (artist_id) 
        REFERENCES Artists(id)
);</pre>
                        </div>
                    </div>
                </div>

            </div>
        </section>

    </main>

    <footer class="text-center py-10 text-slate-500 text-sm">
        <p>Built with ❤️ using a Relational Mindset</p>
    </footer>

    <script>
        // 1. Data Setup
        const artists = [
            { id: 1, name: "Daft Punk", genre: "Electronic" },
            { id: 2, name: "The Weeknd", genre: "R&B" },
            { id: 3, name: "Adele", genre: "Pop/Soul" },
            { id: 4, name: "Queen", genre: "Rock" }
        ];

        const songs = [
            { id: 101, title: "Get Lucky", artistId: 1, duration: "4:08" },
            { id: 102, title: "Starboy", artistId: 2, duration: "3:50" },
            { id: 103, title: "Bohemian Rhapsody", artistId: 4, duration: "5:55" },
            { id: 104, title: "Hello", artistId: 3, duration: "4:55" },
            { id: 105, title: "One More Time", artistId: 1, duration: "5:20" },
            { id: 106, title: "Blinding Lights", artistId: 2, duration: "3:20" },
            { id: 107, title: "Harder Better Faster", artistId: 1, duration: "3:44" },
            { id: 108, title: "Rolling in the Deep", artistId: 3, duration: "3:48" }
        ];

        // 2. DOM Elements
        const tbodySongs = document.getElementById('tbody-songs');
        const tbodyArtists = document.getElementById('tbody-artists');
        const btnFlat = document.getElementById('btn-flat');
        const btnRel = document.getElementById('btn-relational');
        const containerArtists = document.getElementById('container-artists');
        const containerSongs = document.getElementById('container-songs');
        const instructionText = document.getElementById('instruction-text');
        const svgLayer = document.getElementById('connection-layer');
        const thArtist = document.getElementById('th-artist');

        let isRelational = false;

        // 3. Render Functions
        function renderSongs(mode) {
            tbodySongs.innerHTML = '';

            songs.forEach((song, index) => {
                const artist = artists.find(a => a.id === song.artistId);
                const tr = document.createElement('tr');
                tr.className = "group hover:bg-slate-50 dark:hover:bg-slate-900/50 transition-colors";

                // Artist Cell Content
                let artistContent = '';
                let cellClass = '';

                if (mode === 'flat') {
                    // Flat Mode: Full text, redundant
                    artistContent = `
                        <div class="flex flex-col">
                            <span class="font-bold text-slate-700 dark:text-slate-300">${artist.name}</span>
                            <span class="text-xs text-slate-400">${artist.genre}</span>
                        </div>
                    `;
                    cellClass = "text-slate-700 dark:text-slate-300";
                } else {
                    // Relational Mode: Just the ID badge
                    artistContent = `
                        <span class="artist-fk-badge inline-flex items-center gap-1 px-2 py-1 bg-brand-100 dark:bg-brand-900/30 text-brand-600 dark:text-brand-400 text-xs font-mono font-bold rounded cursor-pointer border border-brand-200 dark:border-brand-800"
                              data-artist-id="${artist.id}">
                            <i data-lucide="link" class="w-3 h-3"></i> ID: ${artist.id}
                        </span>
                    `;
                    cellClass = "";
                }

                tr.innerHTML = `
                    <td class="p-3 font-medium text-slate-900 dark:text-white">${song.title}</td>
                    <td class="p-3 ${cellClass}">${artistContent}</td>
                    <td class="p-3 text-right text-slate-500 font-mono text-xs">${song.duration}</td>
                `;
                tbodySongs.appendChild(tr);
            });
            lucide.createIcons();
            attachHoverEffects();
        }

        function renderArtists() {
            tbodyArtists.innerHTML = '';
            artists.forEach(artist => {
                const tr = document.createElement('tr');
                tr.id = `artist-row-${artist.id}`;
                tr.className = "transition-colors duration-300";
                tr.innerHTML = `
                    <td class="p-3 font-mono text-emerald-600 dark:text-emerald-400 font-bold">#${artist.id}</td>
                    <td class="p-3 font-medium text-slate-800 dark:text-slate-200">${artist.name}</td>
                    <td class="p-3 text-slate-500 text-xs">${artist.genre}</td>
                `;
                tbodyArtists.appendChild(tr);
            });
        }

        // 4. Interaction Logic (The "Toy Model")

        function setMode(mode) {
            isRelational = mode === 'relational';

            // UI Toggles
            if (isRelational) {
                // Button Styling
                btnRel.className = "px-4 py-2 rounded-md text-sm font-medium bg-white dark:bg-slate-700 shadow-sm text-brand-600 transition-all";
                btnFlat.className = "px-4 py-2 rounded-md text-sm font-medium text-slate-500 hover:text-slate-900 dark:hover:text-slate-200 transition-all";

                // Layout Animation
                containerArtists.classList.remove('w-0', 'opacity-0');
                containerArtists.classList.add('w-full', 'md:w-1/3', 'opacity-100');
                containerSongs.classList.remove('w-full');

                thArtist.textContent = "Artist ID (FK)";
                thArtist.classList.add('text-brand-600');

                instructionText.textContent = "Hover over blue IDs to trace the connection.";

                // Trigger Re-render with animation
                gsap.to(tbodySongs, {
                    opacity: 0, duration: 0.2, onComplete: () => {
                        renderSongs('relational');
                        gsap.to(tbodySongs, { opacity: 1, duration: 0.3 });
                    }
                });

            } else {
                // Button Styling
                btnFlat.className = "px-4 py-2 rounded-md text-sm font-medium bg-white dark:bg-slate-700 shadow-sm text-brand-600 transition-all";
                btnRel.className = "px-4 py-2 rounded-md text-sm font-medium text-slate-500 hover:text-slate-900 dark:hover:text-slate-200 transition-all";

                // Layout Animation
                containerArtists.classList.remove('w-full', 'md:w-1/3', 'opacity-100');
                containerArtists.classList.add('w-0', 'opacity-0');
                containerSongs.classList.add('w-full');

                thArtist.textContent = "Artist Name & Bio";
                thArtist.classList.remove('text-brand-600');

                instructionText.textContent = "Notice how 'Daft Punk' is repeated 3 times. Inefficient.";

                // Trigger Re-render
                gsap.to(tbodySongs, {
                    opacity: 0, duration: 0.2, onComplete: () => {
                        renderSongs('flat');
                        gsap.to(tbodySongs, { opacity: 1, duration: 0.3 });
                    }
                });

                // Clear lines
                svgLayer.innerHTML = '';
            }
        }

        // 5. The "Connection" Visualization (SVG Lines)
        function attachHoverEffects() {
            if (!isRelational) return;

            const badges = document.querySelectorAll('.artist-fk-badge');

            badges.forEach(badge => {
                badge.addEventListener('mouseenter', () => {
                    const artistId = badge.getAttribute('data-artist-id');
                    const targetRow = document.getElementById(`artist-row-${artistId}`);

                    if (targetRow) {
                        // Highlight Row
                        targetRow.classList.add('bg-emerald-100', 'dark:bg-emerald-900/50');
                        badge.classList.add('ring-2', 'ring-brand-500');

                        // Draw Line
                        drawLine(badge, targetRow);
                    }
                });

                badge.addEventListener('mouseleave', () => {
                    const artistId = badge.getAttribute('data-artist-id');
                    const targetRow = document.getElementById(`artist-row-${artistId}`);

                    if (targetRow) {
                        targetRow.classList.remove('bg-emerald-100', 'dark:bg-emerald-900/50');
                        badge.classList.remove('ring-2', 'ring-brand-500');
                        svgLayer.innerHTML = ''; // Clear lines
                    }
                });
            });
        }

        function drawLine(startEl, endEl) {
            const startRect = startEl.getBoundingClientRect();
            const endRect = endEl.getBoundingClientRect();
            const stageRect = document.getElementById('stage').getBoundingClientRect();

            // Calculate coordinates relative to the SVG container
            const x1 = startRect.right - stageRect.left;
            const y1 = startRect.top + (startRect.height / 2) - stageRect.top;

            const x2 = endRect.left - stageRect.left;
            const y2 = endRect.top + (endRect.height / 2) - stageRect.top;

            // Create Bezier Curve
            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            const cX1 = x1 + 50; // Control point 1
            const cX2 = x2 - 50; // Control point 2

            const d = `M ${x1} ${y1} C ${cX1} ${y1}, ${cX2} ${y2}, ${x2} ${y2}`;

            path.setAttribute("d", d);
            path.setAttribute("class", "connector-line stroke-brand-500 dark:stroke-brand-400");

            svgLayer.appendChild(path);

            // Animate line drawing
            gsap.to(path, {
                strokeDashoffset: 0,
                duration: 0.4,
                ease: "power2.out"
            });
        }

        // 6. Theme Toggle Logic
        const themeToggleBtn = document.getElementById('theme-toggle');
        const html = document.documentElement;

        themeToggleBtn.addEventListener('click', () => {
            html.classList.toggle('dark');
        });

        // 7. Initialize
        btnFlat.addEventListener('click', () => setMode('flat'));
        btnRel.addEventListener('click', () => setMode('relational'));

        // Start
        renderArtists();
        renderSongs('flat');
        lucide.createIcons();

    </script>
</body>

</html>