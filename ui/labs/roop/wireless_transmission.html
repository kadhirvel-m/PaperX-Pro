<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wireless Transmission — Paper X</title>
    <link rel="icon" type="image/x-icon" href="../assets/img/favicon.svg">

    <!-- Inter + Material Symbols -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;700&family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,600,0,0"
        rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                container: { center: true, padding: '1rem' },
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'ui-sans-serif', 'system-ui', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace']
                    },
                    colors: {
                        brand: { 900: '#1E1E2F', 700: '#4C2A59', 500: '#9E4B8A' },
                        brandlt: {
                            50: '#FAF5FB',
                            100: '#F3E7F2',
                            200: '#E7D0E4',
                            300: '#D9B4D3',
                            400: '#C88DBA',
                            500: '#9E4B8A',
                            700: '#4C2A59',
                            900: '#1E1E2F'
                        }
                    },
                    boxShadow: {
                        glow: '0 8px 30px rgba(158,75,138,0.35)',
                        soft: '0 10px 30px rgba(0,0,0,0.25)',
                        card: '0 24px 60px rgba(30,30,47,0.35)'
                    },
                    backgroundImage: {
                        'hero-dark': 'radial-gradient(900px 520px at 50% -15%, rgba(158,75,138,0.35), transparent 65%), linear-gradient(180deg,#1E1E2F 0%,#201934 55%,#141321 100%)',
                        'hero-light': 'radial-gradient(1000px 560px at 50% -18%, rgba(158,75,138,0.18), transparent 62%), linear-gradient(180deg,#FFFFFF 0%,#FBF8FC 55%,#F7F2F9 100%)'
                    }
                }
            }
        }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/Draggable.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        :root {
            --bg-app: #F7F2F9;
            --bg-card: #FFFFFF;
            --text-head: #1E1E2F;
            --text-body: #2F2F3A;
            --text-sub: #5A5A6B;
            --border: #E5DFEC;
            --accent: #9E4B8A;
            --accent-glow: rgba(158, 75, 138, 0.2);
            --panel-bg: rgba(255, 255, 255, 0.85);
            --panel-border: rgba(158, 75, 138, 0.16);
            --grid-line: rgba(158, 75, 138, 0.05);
        }

        .dark {
            --bg-app: #1E1E2F;
            --bg-card: #201934;
            --text-head: #F3E7F2;
            --text-body: #E8E3EE;
            --text-sub: #C9BED5;
            --border: #3A3247;
            --accent: #C88DBA;
            --accent-glow: rgba(158, 75, 138, 0.35);
            --panel-bg: rgba(30, 30, 47, 0.85);
            --panel-border: rgba(200, 141, 186, 0.35);
            --grid-line: rgba(200, 141, 186, 0.08);
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
        }

        .mono {
            font-family: 'JetBrains Mono', monospace;
        }

        .lab-shell {
            min-height: 100vh;
            background-image: linear-gradient(180deg, #FFFFFF 0%, #FBF8FC 45%, #F7F2F9 100%);
        }

        .dark .lab-shell {
            background-image: linear-gradient(180deg, #1E1E2F 0%, #201934 55%, #141321 100%);
        }



        .glass-panel {
            background-color: var(--panel-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--panel-border);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        /* Range Slider */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: var(--text-head);
            cursor: pointer;
            margin-top: -8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            border: 2px solid var(--accent);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: var(--panel-border);
            border-radius: 2px;
        }

        .highlight-text {
            background: linear-gradient(to right, #9E4B8A, #B06AB3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Signal Strength Bars Animation */
        @keyframes signal-pulse {

            0%,
            100% {
                opacity: 0.5;
            }

            50% {
                opacity: 1;
            }
        }

        /* Card Styles */
        .card {
            border-radius: 1rem;
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.9), rgba(243, 231, 242, 0.95));
            box-shadow: 0 18px 40px -18px rgba(30, 30, 47, 0.35);
            border: 1px solid rgba(158, 75, 138, 0.16);
            overflow: hidden;
        }

        .dark .card {
            background: linear-gradient(145deg, rgba(30, 30, 47, 0.96), rgba(30, 30, 47, 0.86));
            border-color: rgba(200, 141, 186, 0.35);
            box-shadow: 0 22px 60px -20px rgba(0, 0, 0, 0.8);
        }

        /* Info Cards */
        .info-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .info-card:hover {
            transform: translateY(-4px);
        }
    </style>

    <!-- Persist theme before paint -->
    <script>
            (function () {
                try {
                    const s = localStorage.getItem('px_theme');
                    const prefers = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    const useDark = s ? s === 'dark' : prefers;
                    if (useDark) document.documentElement.classList.add('dark');
                } catch (_) { }
            })();
    </script>
</head>

<body class="min-h-screen font-sans antialiased text-neutral-900 dark:text-white bg-hero-light dark:bg-hero-dark">

    <!-- ============== NAVBAR (Paper X) ============== -->
    <header
        class="sticky top-0 z-50 bg-white/80 dark:bg-brand-900/70 backdrop-blur supports-[backdrop-filter]:saturate-150 border-b border-black/5 dark:border-white/10">
        <div class="container flex items-center justify-between py-3.5">
            <a href="../index.html" class="flex items-center gap-3 shrink-0" aria-label="Paper X Home">
                <img src="../assets/img/logo-light.svg" class="h-9 w-auto dark:hidden" alt="Paper X" />
                <img src="../assets/img/logo-dark.svg" class="h-9 w-auto hidden dark:block" alt="Paper X" />
            </a>
            <nav class="hidden md:flex items-center gap-6 text-sm text-neutral-700 dark:text-white/85">
                <a href="../index.html" class="hover:text-brandlt-900 dark:hover:text-white">Home</a>
                <a href="../about.html" class="hover:text-brandlt-900 dark:hover:text-white">About</a>
                <a href="../academicas.html" class="hover:text-brandlt-900 dark:hover:text-white">Academics</a>
                <a href="../contact.html" class="hover:text-brandlt-900 dark:hover:text-white">Support</a>
            </nav>
            <div class="hidden md:flex items-center gap-2">
                <button data-theme-toggle
                    class="inline-flex items-center gap-2 rounded-full px-3 py-2 text-sm ring-1 ring-black/10 dark:ring-white/15 hover:bg-black/5 dark:hover:bg-white/5"
                    aria-label="Toggle theme">
                    <span class="material-symbols-rounded">dark_mode</span>
                    <span class="hidden lg:block">Theme</span>
                </button>
                <a href="../login.html"
                    class="px-3 py-2 text-sm text-neutral-700 dark:text-white/80 hover:text-brandlt-900 dark:hover:text-white rounded-full">Log
                    in</a>
                <a href="../signup.html"
                    class="inline-flex items-center justify-center rounded-full bg-brand-500 text-white text-sm font-semibold px-4 py-2.5 hover:shadow-glow transition">Sign
                    up</a>
            </div>
            <div class="md:hidden flex items-center gap-2">
                <button type="button" data-theme-toggle aria-label="Toggle theme"
                    class="inline-flex items-center justify-center size-10 rounded-full ring-1 ring-black/10 dark:ring-white/15 hover:bg-black/5 dark:hover:bg-white/5 transition">
                    <span class="material-symbols-rounded">dark_mode</span>
                </button>
            </div>
        </div>
    </header>

    <main class="lab-shell pb-10">

        <!-- Hero Section -->
        <section class="min-h-[75vh] flex flex-col justify-center items-center px-6 relative overflow-hidden">
            <div class="absolute top-[-10%] left-[-10%] w-[600px] h-[600px] rounded-full blur-[120px] pointer-events-none"
                style="background: var(--accent-glow)"></div>

            <div class="max-w-4xl w-full z-10 space-y-8 text-center md:text-left">

                <!-- Badge -->
                <div class="flex items-center justify-center md:justify-start space-x-4 mb-4">
                    <div class="p-3 rounded-xl border border-brand-500/30 bg-brand-500/10">
                        <i data-lucide="wifi" class="w-8 h-8 text-brand-500"></i>
                    </div>
                    <span class="text-brand-500 font-bold tracking-widest text-sm uppercase">The Concept</span>
                </div>

                <h1 class="text-5xl md:text-8xl font-black tracking-tight leading-none text-center md:text-left"
                    style="color: var(--text-head)">
                    Wireless <br>
                    <span class="highlight-text">Transmission</span>
                </h1>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-12 mt-12 text-left">
                    <div class="space-y-6">
                        <p class="text-xl font-light leading-relaxed" style="color: var(--text-sub)">
                            Wireless isn't magic; it's just a very sophisticated game of <strong>Marco Polo</strong>
                            played at the speed of light.
                        </p>
                        <p class="text-xl font-light leading-relaxed" style="color: var(--text-sub)">
                            Imagine you are in a pitch-black forest. You can't see your friend, but you can shout. The
                            sound spreads out in all directions (Omni-directional). Trees muffle your voice
                            (Attenuation). If you cup your hands, you throw the sound further (Gain).
                        </p>
                    </div>

                    <div
                        class="card p-8 flex flex-col justify-center items-center space-y-6 relative overflow-hidden group hover:-translate-y-1 transition-transform duration-300">
                        <div class="absolute inset-0 bg-brand-500/5 transition-colors duration-500"></div>

                        <div class="relative w-48 h-48 flex items-center justify-center">
                            <div class="absolute w-2 h-24 bg-slate-600 dark:bg-slate-400 bottom-0 rounded-t-lg"></div>
                            <div
                                class="absolute w-6 h-8 bg-slate-500 dark:bg-slate-300 bottom-24 rounded-lg flex items-center justify-center border-2 border-slate-400 dark:border-slate-200">
                                <div class="w-2 h-2 bg-brand-500 rounded-full animate-pulse shadow-[0_0_20px_#9E4B8A]">
                                </div>
                            </div>

                            <div class="absolute w-64 h-64 border-2 border-brand-500/30 rounded-full animate-ping"
                                style="animation-duration: 3s"></div>
                            <div class="absolute w-48 h-48 border-2 border-brand-500/50 rounded-full animate-ping"
                                style="animation-duration: 3s; animation-delay: 1s"></div>
                        </div>

                        <p class="text-sm text-center mono max-w-xs" style="color: var(--text-sub)">
                            Your Wi-Fi router is just a lighthouse that blinks billions of times a second.
                        </p>
                    </div>
                </div>

                <div class="w-full flex justify-center pt-12 animate-bounce">
                    <i data-lucide="chevron-down" class="w-8 h-8 opacity-50"></i>
                </div>
            </div>
        </section>

        <!-- Signal Simulator Section -->
        <section class="py-20 px-4 md:px-8 relative border-t" style="border-color: var(--border)">
            <div class="max-w-6xl mx-auto">

                <div class="flex flex-col md:flex-row justify-between items-end mb-12">
                    <div>
                        <h2 class="text-4xl font-bold mb-2" style="color: var(--text-head)">The Signal Field</h2>
                        <p style="color: var(--text-sub)">Visualize how distance and obstacles kill your Wi-Fi.</p>
                    </div>

                    <div class="glass-panel px-6 py-3 rounded-xl flex items-center gap-4 mt-6 md:mt-0">
                        <div class="flex items-center gap-2">
                            <span class="w-3 h-3 rounded-full bg-emerald-500 animate-pulse"></span>
                            <span class="text-xs font-bold uppercase tracking-wider"
                                style="color: var(--text-head)">Live Simulation</span>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 h-[600px]">

                    <div class="lg:col-span-8 relative card rounded-2xl overflow-hidden flex flex-col cursor-crosshair"
                        id="sim-container">

                        <canvas id="signalCanvas" class="w-full h-full block z-10"></canvas>

                        <div id="tx-node"
                            class="absolute w-12 h-12 -ml-6 -mt-6 bg-brand-500 rounded-full flex items-center justify-center shadow-[0_0_30px_#9E4B8A] z-20 cursor-grab active:cursor-grabbing border-4 border-white/20">
                            <i data-lucide="router" class="w-6 h-6 text-white"></i>
                        </div>

                        <div id="rx-node"
                            class="absolute w-10 h-10 -ml-5 -mt-5 bg-emerald-500 rounded-full flex items-center justify-center shadow-lg z-30 cursor-grab active:cursor-grabbing border-2 border-white">
                            <i data-lucide="smartphone" class="w-5 h-5 text-white"></i>
                        </div>

                        <div id="wall"
                            class="absolute w-4 h-32 bg-slate-700 border border-slate-500 shadow-xl z-15 top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 hidden">
                        </div>

                        <div class="absolute top-4 left-4 z-40 pointer-events-none flex flex-col gap-2">
                            <div class="glass-panel px-3 py-1 rounded text-xs font-mono font-bold text-brand-500">
                                RSSI: <span id="rssi-val">-40</span> dBm
                            </div>
                            <div class="glass-panel px-3 py-1 rounded text-xs font-mono font-bold" id="status-badge"
                                style="color: var(--text-sub)">
                                Signal: Excellent
                            </div>
                        </div>

                    </div>

                    <div class="lg:col-span-4 flex flex-col justify-between h-full space-y-4">

                        <div class="card p-6 flex-1 flex flex-col gap-6">
                            <h3 class="text-xs font-bold uppercase tracking-widest mb-2" style="color: var(--text-sub)">
                                Environment</h3>

                            <div>
                                <div class="flex justify-between text-xs mb-2" style="color: var(--text-sub)">
                                    <span>TX Power (Loudness)</span>
                                    <span class="font-mono text-brand-500" id="power-val">20 dBm</span>
                                </div>
                                <input type="range" id="power-slider" min="0" max="30" step="1" value="20"
                                    class="w-full">
                            </div>

                            <div>
                                <div class="flex justify-between text-xs mb-2" style="color: var(--text-sub)">
                                    <span>Frequency (Pitch)</span>
                                    <span class="font-mono text-brandlt-400" id="freq-val">2.4 GHz</span>
                                </div>
                                <input type="range" id="freq-slider" min="0" max="1" step="1" value="0" class="w-full">
                                <div class="flex justify-between text-[10px] mt-1 opacity-50 font-mono">
                                    <span>2.4 GHz (Long Range)</span>
                                    <span>5 GHz (Fast/Short)</span>
                                </div>
                            </div>

                            <div
                                class="flex items-center justify-between p-3 rounded-lg border border-brand-500/20 bg-brand-500/5">
                                <span class="text-sm font-bold" style="color: var(--text-head)">Concrete Wall</span>
                                <button id="btn-wall"
                                    class="w-12 h-6 rounded-full bg-slate-600 dark:bg-slate-500 relative transition-colors duration-300"
                                    onclick="toggleWall()">
                                    <div
                                        class="w-4 h-4 bg-white rounded-full absolute top-1 left-1 transition-transform duration-300 shadow-md">
                                    </div>
                                </button>
                            </div>
                        </div>

                        <div class="card p-6 h-1/3 flex flex-col justify-center items-center">
                            <h3 class="text-xs font-bold uppercase tracking-widest mb-4" style="color: var(--text-sub)">
                                Receiver Quality</h3>

                            <div class="flex items-end gap-1 h-16 w-full justify-center">
                                <div class="w-3 bg-emerald-500 rounded-sm signal-bar" style="height: 20%"></div>
                                <div class="w-3 bg-emerald-500 rounded-sm signal-bar" style="height: 40%"></div>
                                <div class="w-3 bg-emerald-500 rounded-sm signal-bar" style="height: 60%"></div>
                                <div class="w-3 bg-emerald-500 rounded-sm signal-bar" style="height: 80%"></div>
                                <div class="w-3 bg-emerald-500 rounded-sm signal-bar" style="height: 100%"></div>
                            </div>
                            <p id="data-rate" class="mt-4 text-2xl font-black font-mono text-emerald-500">300 Mbps</p>
                        </div>

                    </div>
                </div>
            </div>
        </section>

        <!-- Info Cards Section -->
        <section class="py-24 px-6 relative z-10">
            <div class="max-w-6xl mx-auto">
                <h2 class="text-3xl font-bold mb-12 text-center" style="color: var(--text-head)">Under The Hood</h2>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

                    <div class="card info-card p-6 border-t-4 border-orange-500">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-bold" style="color: var(--text-head)">Attenuation</h3>
                                <p class="text-sm" style="color: var(--text-sub)">Signal Loss</p>
                            </div>
                            <i data-lucide="trending-down" class="w-6 h-6 text-orange-500"></i>
                        </div>
                        <p class="text-sm leading-relaxed mb-4" style="color: var(--text-sub)">
                            As a signal travels, it spreads out (Inverse Square Law) and gets absorbed by matter.
                            <br><br>
                            <strong>Free Space Path Loss (FSPL):</strong> Doubling the distance drops the power to
                            1/4th.
                        </p>
                    </div>

                    <div class="card info-card p-6 border-t-4 border-brand-500">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-bold" style="color: var(--text-head)">Frequency</h3>
                                <p class="text-sm" style="color: var(--text-sub)">2.4 vs 5 GHz</p>
                            </div>
                            <i data-lucide="activity" class="w-6 h-6 text-brand-500"></i>
                        </div>
                        <p class="text-sm leading-relaxed mb-4" style="color: var(--text-sub)">
                            Higher frequency (5GHz) carries more data but struggles to penetrate walls. Lower frequency
                            (2.4GHz) goes through walls better but is slower and more crowded.
                        </p>
                    </div>

                    <div class="card info-card p-6 border-t-4 border-brandlt-400">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-bold" style="color: var(--text-head)">Link Budget</h3>
                                <p class="text-sm" style="color: var(--text-sub)">The Math Equation</p>
                            </div>
                            <i data-lucide="calculator" class="w-6 h-6 text-brandlt-400"></i>
                        </div>
                        <div class="font-mono text-xs bg-brand-500/10 p-3 rounded mb-3" style="color: var(--text-head)">
                            RX Power = TX Power + Gains - Losses
                        </div>
                        <p class="text-sm leading-relaxed" style="color: var(--text-sub)">
                            Engineers calculate every decibel (dB) of gain from antennas and loss from cables/air to
                            ensure the signal arrives above the "Sensitivity Threshold".
                        </p>
                    </div>

                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="py-12 text-center text-sm border-t bg-white/50 dark:bg-brand-900/50"
        style="border-color: var(--border); color: var(--text-sub)">
        <p>Explorable Explanation Design — Paper X</p>
    </footer>

    <script>
        lucide.createIcons();

        // --- SIMULATOR LOGIC ---
        const canvas = document.getElementById('signalCanvas');
        const ctx = canvas.getContext('2d');
        const container = document.getElementById('sim-container');

        // UI Elements
        const txNode = document.getElementById('tx-node');
        const rxNode = document.getElementById('rx-node');
        const wall = document.getElementById('wall');
        const rssiDisplay = document.getElementById('rssi-val');
        const statusBadge = document.getElementById('status-badge');
        const dataRateDisplay = document.getElementById('data-rate');
        const powerSlider = document.getElementById('power-slider');
        const freqSlider = document.getElementById('freq-slider');
        const wallBtn = document.getElementById('btn-wall');
        const signalBars = document.querySelectorAll('.signal-bar');

        // State
        let width, height;
        let time = 0;
        let txPos = { x: 200, y: 300 };
        let rxPos = { x: 600, y: 300 };
        let wallPos = { x: 0, y: 0, w: 20, h: 200, active: false };

        // Parameters
        let txPower = 20; // dBm
        let frequency = 2.4; // GHz (0 = 2.4, 1 = 5)
        let fsplConstant = 40; // Simulated path loss constant

        // Draggable Setup
        let isDragging = false;
        let dragTarget = null;

        function resize() {
            width = container.clientWidth;
            height = container.clientHeight;
            canvas.width = width;
            canvas.height = height;

            // Initial positions centered relative to canvas
            txPos = { x: width * 0.25, y: height * 0.5 };
            rxPos = { x: width * 0.75, y: height * 0.5 };
            wallPos.x = width * 0.5;
            wallPos.y = height * 0.5;
            wallPos.h = height * 0.6;

            updateDOMPositions();
        }
        window.addEventListener('resize', resize);

        function updateDOMPositions() {
            txNode.style.left = `${txPos.x}px`;
            txNode.style.top = `${txPos.y}px`;
            rxNode.style.left = `${rxPos.x}px`;
            rxNode.style.top = `${rxPos.y}px`;

            wall.style.left = `${wallPos.x}px`;
            wall.style.top = `${wallPos.y}px`;
            wall.style.height = `${wallPos.h}px`;
        }

        // --- MOUSE DRAG LOGIC ---
        function handleStart(e, targetStr) {
            isDragging = true;
            dragTarget = targetStr;
        }

        container.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            const rect = container.getBoundingClientRect();
            const x = Math.max(20, Math.min(width - 20, e.clientX - rect.left));
            const y = Math.max(20, Math.min(height - 20, e.clientY - rect.top));

            if (dragTarget === 'tx') txPos = { x, y };
            if (dragTarget === 'rx') rxPos = { x, y };

            updateDOMPositions();
        });

        window.addEventListener('mouseup', () => { isDragging = false; dragTarget = null; });

        txNode.addEventListener('mousedown', (e) => handleStart(e, 'tx'));
        rxNode.addEventListener('mousedown', (e) => handleStart(e, 'rx'));

        // --- PHYSICS CALCULATIONS ---
        function calculateSignal() {
            // Distance in "meters" (scale down pixels)
            const dx = rxPos.x - txPos.x;
            const dy = rxPos.y - txPos.y;
            const distPixels = Math.sqrt(dx * dx + dy * dy);
            const distMeters = Math.max(1, distPixels / 20); // 20px = 1m approx

            // Frequency Factor (Higher freq = more loss)
            // Log distance path loss model simplified: Loss = 20log(d) + 20log(f) + C
            const freqLoss = frequency === 0 ? 0 : 8; // 5GHz adds ~6-8dB loss compared to 2.4

            // Wall Loss
            let obstacleLoss = 0;
            if (wallPos.active) {
                // Simple Line Intersection Check
                // Wall is vertical line at wallPos.x, from y-h/2 to y+h/2
                const wallTop = wallPos.y - wallPos.h / 2;
                const wallBot = wallPos.y + wallPos.h / 2;

                // Check if line crosses wall X
                if ((txPos.x < wallPos.x && rxPos.x > wallPos.x) || (txPos.x > wallPos.x && rxPos.x < wallPos.x)) {
                    // Check Y range intersection (simplified)
                    const slope = (rxPos.y - txPos.y) / (rxPos.x - txPos.x);
                    const yAtWall = txPos.y + slope * (wallPos.x - txPos.x);
                    if (yAtWall > wallTop && yAtWall < wallBot) {
                        obstacleLoss = frequency === 0 ? 10 : 25; // Higher freq penetrates worse
                    }
                }
            }

            // RSSI Calculation
            // RSSI = TxPower - PathLoss - ObstacleLoss
            const pathLoss = 20 * Math.log10(distMeters) + fsplConstant + freqLoss;
            let rssi = txPower - pathLoss - obstacleLoss;

            // Clamp for realism (-30 to -100)
            return Math.max(-120, Math.min(-20, rssi));
        }

        // --- DRAW LOOP ---
        function animate() {
            ctx.clearRect(0, 0, width, height);

            // Get Theme Colors
            const isLight = !document.documentElement.classList.contains('dark');
            const waveColor = isLight ? '158, 75, 138' : '200, 141, 186'; // Brand colors

            // Draw Signal Waves from TX
            time += 0.5; // Speed of propagation
            const maxRadius = Math.max(width, height);

            ctx.lineWidth = 2;

            // Frequency determines wave density
            const waveSpacing = frequency === 0 ? 40 : 25;

            for (let r = (time % waveSpacing); r < maxRadius; r += waveSpacing) {
                const opacityRaw = 1 - (r / (maxRadius * 0.8));
                if (opacityRaw < 0) continue;

                // Adjust opacity based on TX Power
                const powerFactor = txPower / 30; // 0 to 1
                let opacity = opacityRaw * powerFactor * 0.5;

                ctx.beginPath();
                ctx.arc(txPos.x, txPos.y, r, 0, Math.PI * 2);
                ctx.strokeStyle = `rgba(${waveColor}, ${opacity})`;
                ctx.stroke();
            }

            // Update UI Stats
            const rssi = calculateSignal();
            rssiDisplay.innerText = Math.round(rssi);

            // Update Bars and Text
            updateSignalUI(rssi);

            requestAnimationFrame(animate);
        }

        function updateSignalUI(rssi) {
            // Signal Quality Logic
            let quality = 0; // 0 to 5 bars
            let rate = "0 Mbps";
            let status = "Dead Zone";
            let color = "text-slate-500";

            if (rssi > -50) {
                quality = 5; rate = frequency === 0 ? "150 Mbps" : "800 Mbps"; status = "Perfect"; color = "text-emerald-500";
            } else if (rssi > -60) {
                quality = 4; rate = frequency === 0 ? "100 Mbps" : "400 Mbps"; status = "Good"; color = "text-emerald-400";
            } else if (rssi > -70) {
                quality = 3; rate = frequency === 0 ? "50 Mbps" : "150 Mbps"; status = "Fair"; color = "text-yellow-400";
            } else if (rssi > -80) {
                quality = 2; rate = frequency === 0 ? "10 Mbps" : "30 Mbps"; status = "Weak"; color = "text-orange-400";
            } else if (rssi > -90) {
                quality = 1; rate = "1 Mbps"; status = "Unstable"; color = "text-red-500";
            }

            // Update Bars
            signalBars.forEach((bar, i) => {
                if (i < quality) {
                    bar.style.opacity = "1";
                    // Dynamic color for bars
                    if (quality >= 4) bar.style.backgroundColor = "#10b981";
                    else if (quality >= 3) bar.style.backgroundColor = "#facc15";
                    else bar.style.backgroundColor = "#ef4444";
                } else {
                    bar.style.opacity = "0.2";
                    bar.style.backgroundColor = "gray";
                }
            });

            dataRateDisplay.innerText = rate;
            dataRateDisplay.className = `mt-4 text-2xl font-black font-mono ${color}`;

            const badge = document.getElementById('status-badge');
            badge.innerText = `Signal: ${status}`;
            badge.style.color = status === "Dead Zone" ? "gray" : "inherit";
        }

        // --- CONTROL LISTENERS ---
        powerSlider.addEventListener('input', (e) => {
            txPower = parseInt(e.target.value);
            document.getElementById('power-val').innerText = txPower + " dBm";
        });

        freqSlider.addEventListener('input', (e) => {
            frequency = parseInt(e.target.value);
            document.getElementById('freq-val').innerText = frequency === 0 ? "2.4 GHz" : "5 GHz";
        });

        function toggleWall() {
            wallPos.active = !wallPos.active;
            const btn = document.getElementById('btn-wall').querySelector('div');

            if (wallPos.active) {
                wall.classList.remove('hidden');
                btn.style.transform = "translateX(24px)";
                document.getElementById('btn-wall').classList.replace('bg-slate-600', 'bg-emerald-500');
                document.getElementById('btn-wall').classList.replace('dark:bg-slate-500', 'dark:bg-emerald-500');
            } else {
                wall.classList.add('hidden');
                btn.style.transform = "translateX(0)";
                document.getElementById('btn-wall').classList.replace('bg-emerald-500', 'bg-slate-600');
                document.getElementById('btn-wall').classList.replace('dark:bg-emerald-500', 'dark:bg-slate-500');
            }
        }

        // Init
        resize();
        animate();

        // --- THEME TOGGLE (Paper X) ---
        const themeToggles = document.querySelectorAll('[data-theme-toggle]');
        const root = document.documentElement;

        themeToggles.forEach(btn => {
            btn.addEventListener('click', () => {
                const isDark = root.classList.toggle('dark');
                try { localStorage.setItem('px_theme', isDark ? 'dark' : 'light'); } catch (_) { }
            });
        });

    </script>
</body>

</html>