<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theoretical Basis of Communication — Paper X</title>
    <link rel="icon" type="image/x-icon" href="../assets/img/favicon.svg">

    <!-- Inter + Material Symbols -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;700&family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,600,0,0"
        rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                container: { center: true, padding: '1rem' },
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'ui-sans-serif', 'system-ui', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace']
                    },
                    colors: {
                        brand: { 900: '#1E1E2F', 700: '#4C2A59', 500: '#9E4B8A' },
                        brandlt: {
                            50: '#FAF5FB',
                            100: '#F3E7F2',
                            200: '#E7D0E4',
                            300: '#D9B4D3',
                            400: '#C88DBA',
                            500: '#9E4B8A',
                            700: '#4C2A59',
                            900: '#1E1E2F'
                        }
                    },
                    boxShadow: {
                        glow: '0 8px 30px rgba(158,75,138,0.35)',
                        soft: '0 10px 30px rgba(0,0,0,0.25)',
                        card: '0 24px 60px rgba(30,30,47,0.35)'
                    },
                    backgroundImage: {
                        'hero-dark': 'radial-gradient(900px 520px at 50% -15%, rgba(158,75,138,0.35), transparent 65%), linear-gradient(180deg,#1E1E2F 0%,#201934 55%,#141321 100%)',
                        'hero-light': 'radial-gradient(1000px 560px at 50% -18%, rgba(158,75,138,0.18), transparent 62%), linear-gradient(180deg,#FFFFFF 0%,#FBF8FC 55%,#F7F2F9 100%)'
                    }
                }
            }
        }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        :root {
            --bg-app: #F7F2F9;
            --bg-card: #FFFFFF;
            --text-head: #1E1E2F;
            --text-body: #2F2F3A;
            --text-sub: #5A5A6B;
            --border: #E5DFEC;
            --accent-primary: #9E4B8A;
            --accent-secondary: #ef4444;
        }

        .dark {
            --bg-app: #1E1E2F;
            --bg-card: #201934;
            --text-head: #F3E7F2;
            --text-body: #E8E3EE;
            --text-sub: #C9BED5;
            --border: #3A3247;
            --accent-primary: #C88DBA;
            --accent-secondary: #ef4444;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
        }

        .mono {
            font-family: 'JetBrains Mono', monospace;
        }

        .lab-shell {
            min-height: 100vh;
            background-image: linear-gradient(180deg, #FFFFFF 0%, #FBF8FC 45%, #F7F2F9 100%);
        }

        .dark .lab-shell {
            background-image: linear-gradient(180deg, #1E1E2F 0%, #201934 55%, #141321 100%);
        }

        /* Glass Panel Card */
        .card {
            border-radius: 1rem;
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.9), rgba(243, 231, 242, 0.95));
            box-shadow: 0 18px 40px -18px rgba(30, 30, 47, 0.35);
            border: 1px solid rgba(158, 75, 138, 0.16);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .dark .card {
            background: linear-gradient(145deg, rgba(30, 30, 47, 0.96), rgba(30, 30, 47, 0.86));
            border-color: rgba(200, 141, 186, 0.35);
            box-shadow: 0 22px 60px -20px rgba(0, 0, 0, 0.8);
        }

        .glass-panel {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.8), rgba(243, 231, 242, 0.9));
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(158, 75, 138, 0.16);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.05);
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .dark .glass-panel {
            background: linear-gradient(145deg, rgba(30, 30, 47, 0.8), rgba(42, 35, 58, 0.9));
            border-color: rgba(200, 141, 186, 0.25);
        }

        .cyber-grid {
            background-image: linear-gradient(to right, rgba(158, 75, 138, 0.05) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(158, 75, 138, 0.05) 1px, transparent 1px);
            background-size: 40px 40px;
            mask-image: linear-gradient(to bottom, transparent, black, transparent);
        }

        .dark .cyber-grid {
            background-image: linear-gradient(to right, rgba(200, 141, 186, 0.08) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(200, 141, 186, 0.08) 1px, transparent 1px);
        }

        /* Custom Slider Styling */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
            width: 100%;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: var(--text-head);
            cursor: pointer;
            margin-top: -8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            border: 2px solid var(--accent-primary);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: var(--text-sub);
            opacity: 0.3;
            border-radius: 2px;
        }

        /* Animation */
        .bit {
            font-family: 'JetBrains Mono', monospace;
            font-weight: bold;
            position: absolute;
            user-select: none;
        }

        .noise-particle {
            position: absolute;
            border-radius: 50%;
            pointer-events: none;
        }

        /* Section Badge */
        .section-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            border-radius: 9999px;
            background: rgba(158, 75, 138, 0.1);
            border: 1px solid rgba(158, 75, 138, 0.2);
        }

        .dark .section-badge {
            background: rgba(200, 141, 186, 0.15);
            border-color: rgba(200, 141, 186, 0.3);
        }

        /* Concept Card Borders */
        .border-accent-emerald {
            border-left: 4px solid #10b981;
        }

        .border-accent-blue {
            border-left: 4px solid #3b82f6;
        }

        .border-accent-red {
            border-left: 4px solid #ef4444;
        }

        .border-accent-orange {
            border-left: 4px solid #f97316;
        }

        .border-accent-purple {
            border-left: 4px solid #a855f7;
        }
    </style>

    <!-- Persist theme before paint -->
    <script>
            (function () {
                try {
                    const s = localStorage.getItem('px_theme');
                    const prefers = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    const useDark = s ? s === 'dark' : prefers;
                    if (useDark) document.documentElement.classList.add('dark');
                } catch (_) { }
            })();
    </script>
</head>

<body class="min-h-screen font-sans antialiased text-neutral-900 dark:text-white bg-hero-light dark:bg-hero-dark">

    <!-- ============== NAVBAR (Paper X) ============== -->
    <header
        class="sticky top-0 z-50 bg-white/80 dark:bg-brand-900/70 backdrop-blur supports-[backdrop-filter]:saturate-150 border-b border-black/5 dark:border-white/10">
        <div class="container flex items-center justify-between py-3.5">
            <a href="../index.html" class="flex items-center gap-3 shrink-0" aria-label="Paper X Home">
                <img src="../assets/img/logo-light.svg" class="h-9 w-auto dark:hidden" alt="Paper X" />
                <img src="../assets/img/logo-dark.svg" class="h-9 w-auto hidden dark:block" alt="Paper X" />
            </a>
            <nav class="hidden md:flex items-center gap-6 text-sm text-neutral-700 dark:text-white/85">
                <a href="../index.html" class="hover:text-brandlt-900 dark:hover:text-white">Home</a>
                <a href="../about.html" class="hover:text-brandlt-900 dark:hover:text-white">About</a>
                <a href="../academicas.html" class="hover:text-brandlt-900 dark:hover:text-white">Academics</a>
                <a href="../contact.html" class="hover:text-brandlt-900 dark:hover:text-white">Support</a>
            </nav>
            <div class="hidden md:flex items-center gap-2">
                <button data-theme-toggle
                    class="inline-flex items-center gap-2 rounded-full px-3 py-2 text-sm ring-1 ring-black/10 dark:ring-white/15 hover:bg-black/5 dark:hover:bg-white/5"
                    aria-label="Toggle theme">
                    <span class="material-symbols-rounded">dark_mode</span>
                    <span class="hidden lg:block">Theme</span>
                </button>
                <a href="../login.html"
                    class="px-3 py-2 text-sm text-neutral-700 dark:text-white/80 hover:text-brandlt-900 dark:hover:text-white rounded-full">Log
                    in</a>
                <a href="../signup.html"
                    class="inline-flex items-center justify-center rounded-full bg-brand-500 text-white text-sm font-semibold px-4 py-2.5 hover:shadow-glow transition">Sign
                    up</a>
            </div>
            <div class="md:hidden flex items-center gap-2">
                <button type="button" data-theme-toggle aria-label="Toggle theme"
                    class="inline-flex items-center justify-center size-10 rounded-full ring-1 ring-black/10 dark:ring-white/15 hover:bg-black/5 dark:hover:bg-white/5 transition">
                    <span class="material-symbols-rounded">dark_mode</span>
                </button>
            </div>
        </div>
    </header>

    <main class="lab-shell pb-10">

        <div class="fixed inset-0 cyber-grid z-0 opacity-30 pointer-events-none"></div>

        <!-- Hero Section -->
        <section class="relative z-10 py-16 md:py-24">
            <div class="container max-w-5xl mx-auto px-4">
                <div class="text-center md:text-left space-y-6">

                    <div class="section-badge">
                        <i data-lucide="mic" class="w-5 h-5 text-brand-500"></i>
                        <span
                            class="text-sm font-bold tracking-widest uppercase text-brand-500 dark:text-brandlt-400">The
                            Metaphor</span>
                    </div>

                    <h1 class="text-4xl md:text-6xl lg:text-7xl font-extrabold tracking-tight leading-tight"
                        style="color: var(--text-head)">
                        Theoretical basis of <br>
                        <span
                            class="text-transparent bg-clip-text bg-gradient-to-r from-brand-500 to-brandlt-400">communication</span>
                    </h1>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-8">
                        <div class="space-y-4">
                            <p class="text-lg md:text-xl font-light leading-relaxed" style="color: var(--text-sub)">
                                Communication theory isn't just about computers. It's about a universal problem: <strong
                                    class="font-semibold" style="color: var(--text-head)">Getting a message from A to B
                                    without it changing.</strong>
                            </p>
                            <p class="text-lg md:text-xl font-light leading-relaxed" style="color: var(--text-sub)">
                                Imagine you are at a loud party. You shout a secret code to your friend across the room.
                                The music (Noise) fights against your voice (Signal). If the music is too loud, your
                                friend hears nonsense.
                            </p>
                        </div>

                        <div
                            class="card p-6 md:p-8 flex flex-col justify-center items-center space-y-6 relative overflow-hidden">
                            <div class="flex items-center justify-between w-full max-w-sm relative z-10">
                                <div class="flex flex-col items-center">
                                    <div
                                        class="w-14 h-14 md:w-16 md:h-16 rounded-full border-2 border-emerald-500 flex items-center justify-center bg-emerald-500/10 mb-2">
                                        <i data-lucide="user" class="w-7 h-7 md:w-8 md:h-8 text-emerald-500"></i>
                                    </div>
                                    <span class="text-xs font-bold text-emerald-500">YOU</span>
                                </div>

                                <div
                                    class="flex-1 h-1 bg-slate-300 dark:bg-slate-700 mx-4 relative overflow-hidden rounded-full">
                                    <div class="absolute inset-0 bg-brand-500/50 animate-pulse"></div>
                                </div>

                                <div class="flex flex-col items-center">
                                    <div
                                        class="w-14 h-14 md:w-16 md:h-16 rounded-full border-2 border-blue-500 flex items-center justify-center bg-blue-500/10 mb-2">
                                        <i data-lucide="ear" class="w-7 h-7 md:w-8 md:h-8 text-blue-500"></i>
                                    </div>
                                    <span class="text-xs font-bold text-blue-500">FRIEND</span>
                                </div>
                            </div>

                            <div
                                class="absolute inset-0 flex items-center justify-center opacity-10 pointer-events-none">
                                <i data-lucide="waves" class="w-48 h-48 md:w-64 md:h-64 text-red-500 animate-pulse"></i>
                            </div>

                            <p class="text-sm text-center max-w-xs" style="color: var(--text-sub)">
                                Claude Shannon proved there is a mathematical limit to how much you can shout before the
                                noise wins.
                            </p>
                        </div>
                    </div>

                    <div class="w-full flex justify-center pt-8 animate-bounce">
                        <i data-lucide="chevron-down" class="w-8 h-8" style="color: var(--text-sub)"></i>
                    </div>
                </div>
            </div>
        </section>

        <!-- Shannon Engine Section -->
        <section class="relative z-10 py-16 border-t" style="border-color: var(--border)">
            <div class="container max-w-6xl mx-auto px-4">

                <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-8 gap-4">
                    <div>
                        <h2 class="text-3xl md:text-4xl font-bold mb-2" style="color: var(--text-head)">The Shannon
                            Engine</h2>
                        <p style="color: var(--text-sub)">Transmit a message through a noisy digital channel.</p>
                    </div>

                    <div class="glass-panel p-3 rounded-xl flex items-center gap-4 w-full md:w-auto">
                        <span class="text-xs font-bold px-2 uppercase tracking-wider text-brand-500">Source
                            Message:</span>
                        <input type="text" id="source-input" value="HELLO"
                            class="bg-transparent border-b-2 border-brand-500/30 focus:outline-none focus:border-brand-500 text-lg font-mono font-bold w-full md:w-40 text-center uppercase"
                            style="color: var(--text-head)" maxlength="8">
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">

                    <!-- Controls -->
                    <div class="lg:col-span-3 flex flex-col gap-4">
                        <div class="card p-5">
                            <div class="flex justify-between items-center mb-4">
                                <label class="text-xs font-bold text-emerald-500 uppercase tracking-widest">Signal Power
                                    (S)</label>
                                <span id="val-signal" class="text-xs font-mono font-bold"
                                    style="color: var(--text-head)">80%</span>
                            </div>
                            <input type="range" id="slider-signal" min="10" max="100" value="80">
                            <p class="text-[10px] mt-2" style="color: var(--text-sub)">How "loud" you are shouting.</p>
                        </div>

                        <div class="card p-5">
                            <div class="flex justify-between items-center mb-4">
                                <label class="text-xs font-bold text-red-500 uppercase tracking-widest">Noise Level
                                    (N)</label>
                                <span id="val-noise" class="text-xs font-mono font-bold"
                                    style="color: var(--text-head)">20%</span>
                            </div>
                            <input type="range" id="slider-noise" min="0" max="100" value="20">
                            <p class="text-[10px] mt-2" style="color: var(--text-sub)">Static interference in the
                                channel.</p>
                        </div>

                        <div class="card p-5">
                            <div class="flex justify-between items-center mb-4">
                                <label
                                    class="text-xs font-bold text-blue-400 uppercase tracking-widest">Redundancy</label>
                                <span id="val-redun" class="text-xs font-mono font-bold"
                                    style="color: var(--text-head)">1x</span>
                            </div>
                            <input type="range" id="slider-redun" min="1" max="5" step="1" value="1">
                            <p class="text-[10px] mt-2" style="color: var(--text-sub)">Repeating the message to correct
                                errors.</p>
                        </div>
                    </div>

                    <!-- Channel Visualization -->
                    <div class="lg:col-span-9 card overflow-hidden flex flex-col" style="min-height: 450px;">
                        <div class="relative flex-1 overflow-hidden" id="channel-container"
                            style="background: rgba(0,0,0,0.05);">
                            <div
                                class="absolute inset-0 pointer-events-none flex items-center justify-between px-12 opacity-20">
                                <div class="h-full w-px border-l border-dashed border-emerald-500"></div>
                                <div class="h-full w-px border-l border-dashed border-blue-500"></div>
                            </div>

                            <div
                                class="absolute top-4 left-4 text-xs font-bold text-emerald-500 uppercase tracking-wider">
                                Encoder (TX)</div>
                            <div
                                class="absolute top-4 right-4 text-xs font-bold text-blue-500 uppercase tracking-wider">
                                Decoder (RX)</div>

                            <div class="absolute bottom-4 right-4 text-right">
                                <div class="text-[10px] uppercase tracking-wider" style="color: var(--text-sub)">
                                    Signal-to-Noise Ratio (SNR)</div>
                                <div id="snr-display" class="text-2xl font-mono font-bold"
                                    style="color: var(--text-head)">4.0 dB</div>
                            </div>
                        </div>

                        <div class="h-20 border-t flex items-center justify-between px-6 md:px-8"
                            style="border-color: var(--border); background: rgba(0,0,0,0.03);">
                            <div class="text-xs font-bold uppercase tracking-wider" style="color: var(--text-sub)">
                                Received Message:</div>
                            <div id="rx-output"
                                class="font-mono text-2xl md:text-4xl font-bold text-emerald-500 tracking-widest">HELLO
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </section>

        <!-- Concepts Section -->
        <section class="py-16 px-4 relative z-10">
            <div class="container max-w-6xl mx-auto">
                <h2 class="text-3xl font-bold mb-10" style="color: var(--text-head)">Under The Hood</h2>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

                    <!-- Shannon-Hartley -->
                    <div class="card p-6 border-accent-emerald lg:col-span-2">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-bold" style="color: var(--text-head)">Shannon-Hartley Theorem
                                </h3>
                                <p class="text-sm" style="color: var(--text-sub)">The theoretical limit of data speed.
                                </p>
                            </div>
                            <span
                                class="px-2 py-1 bg-emerald-500/20 text-emerald-600 dark:text-emerald-400 text-xs font-bold rounded">FORMULA</span>
                        </div>

                        <div class="text-center py-6">
                            <span class="text-2xl md:text-4xl font-mono font-bold" style="color: var(--text-head)">C = B
                                log₂(1 + S/N)</span>
                        </div>

                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-xs font-mono"
                            style="color: var(--text-sub)">
                            <div>
                                <span class="text-emerald-500 font-bold">C</span> = Capacity (bits/s)
                            </div>
                            <div>
                                <span class="text-emerald-500 font-bold">B</span> = Bandwidth (Hz)
                            </div>
                            <div>
                                <span class="text-emerald-500 font-bold">S</span> = Signal Power
                            </div>
                            <div>
                                <span class="text-emerald-500 font-bold">N</span> = Noise Power
                            </div>
                        </div>
                    </div>

                    <!-- Entropy -->
                    <div class="card p-6 border-accent-blue">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-bold" style="color: var(--text-head)">Entropy</h3>
                                <p class="text-sm" style="color: var(--text-sub)">Information Density</p>
                            </div>
                            <i data-lucide="binary" class="w-5 h-5 text-blue-500"></i>
                        </div>
                        <p class="text-sm leading-relaxed" style="color: var(--text-body)">
                            Entropy measures the uncertainty or "surprise" in a message. A message of "AAAAA" has low
                            entropy (0 bits of info). A random string "X9#m2" has high entropy.
                        </p>
                    </div>

                    <!-- Noise Sources -->
                    <div class="card p-6">
                        <i data-lucide="zap-off" class="w-6 h-6 text-red-500 mb-3"></i>
                        <h4 class="font-bold mb-2" style="color: var(--text-head)">Noise Sources</h4>
                        <p class="text-xs leading-relaxed" style="color: var(--text-sub)">
                            <strong class="text-red-500">Thermal Noise:</strong> Electron movement in wires.<br>
                            <strong class="text-red-500">Crosstalk:</strong> Interference from other wires.<br>
                            <strong class="text-red-500">Attenuation:</strong> Signal fading over distance.
                        </p>
                    </div>

                    <!-- The Bit -->
                    <div class="card p-6">
                        <i data-lucide="hash" class="w-6 h-6 text-orange-500 mb-3"></i>
                        <h4 class="font-bold mb-2" style="color: var(--text-head)">The Bit</h4>
                        <p class="text-xs leading-relaxed" style="color: var(--text-sub)">
                            The fundamental unit of information. It represents a single choice between two alternatives
                            (Yes/No, On/Off, 1/0).
                        </p>
                    </div>

                    <!-- Redundancy -->
                    <div class="card p-6">
                        <i data-lucide="copy" class="w-6 h-6 text-purple-500 mb-3"></i>
                        <h4 class="font-bold mb-2" style="color: var(--text-head)">Redundancy</h4>
                        <p class="text-xs leading-relaxed" style="color: var(--text-sub)">
                            Adding extra bits to detect or correct errors. If Noise > Signal, you must increase
                            Redundancy to communicate reliability.
                        </p>
                    </div>

                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="py-8 text-center text-sm border-t" style="border-color: var(--border);">
        <p style="color: var(--text-sub)">Explorable Explanation Design — Paper X</p>
    </footer>

    <script>
        // Initialize Icons
        lucide.createIcons();

        // --- THEME TOGGLE LOGIC (Paper X Style) ---
        const themeToggles = document.querySelectorAll('[data-theme-toggle]');
        const root = document.documentElement;

        themeToggles.forEach(btn => {
            btn.addEventListener('click', () => {
                const isDark = root.classList.toggle('dark');
                try { localStorage.setItem('px_theme', isDark ? 'dark' : 'light'); } catch (_) { }
            });
        });

        // --- SIMULATOR LOGIC ---
        const channelContainer = document.getElementById('channel-container');
        const sourceInput = document.getElementById('source-input');
        const rxOutput = document.getElementById('rx-output');
        const snrDisplay = document.getElementById('snr-display');

        // Sliders
        const sSignal = document.getElementById('slider-signal');
        const sNoise = document.getElementById('slider-noise');
        const sRedun = document.getElementById('slider-redun');

        // Value Displays
        const vSignal = document.getElementById('val-signal');
        const vNoise = document.getElementById('val-noise');
        const vRedun = document.getElementById('val-redun');

        let signalPower = 80;
        let noiseLevel = 20;
        let redundancy = 1;

        // Animation State
        const particles = [];
        let frameCount = 0;

        // --- FUNCTIONS ---

        function stringToBinary(str) {
            return str.split('').map(char => {
                return char.charCodeAt(0).toString(2).padStart(8, '0');
            }).join('');
        }

        function binaryToString(bin) {
            return bin.match(/.{1,8}/g).map(byte => {
                return String.fromCharCode(parseInt(byte, 2));
            }).join('');
        }

        // Bit Class
        class Bit {
            constructor(value, id, total) {
                this.value = value; // "0" or "1"
                this.originalValue = value;
                this.x = 0;
                this.y = 50 + (Math.random() * 200); // Spread vertically
                this.id = id;
                this.speed = 2 + Math.random();

                // Element creation
                this.el = document.createElement('div');
                this.el.className = 'bit text-xs transition-colors duration-200';
                this.el.innerText = value;
                this.el.style.color = value === "1" ? "#10b981" : "var(--text-sub)";

                channelContainer.appendChild(this.el);
            }

            update() {
                this.x += this.speed;

                // Noise Interaction
                const noiseFactor = Math.max(0.1, noiseLevel);
                const signalFactor = Math.max(0.1, signalPower);
                const flipChance = (noiseFactor / (signalFactor * redundancy * 10));

                if (Math.random() < flipChance) {
                    this.flip();
                }

                // Render
                this.el.style.transform = `translate(${this.x}px, ${this.y}px)`;

                // Reset Color based on current value state vs signal strength
                const opacity = signalPower / 100;
                this.el.style.opacity = Math.max(0.2, opacity);

                // Jitter position based on noise
                const jitter = (noiseLevel / 100) * 5;
                const jX = (Math.random() - 0.5) * jitter;
                const jY = (Math.random() - 0.5) * jitter;

                this.el.style.transform = `translate(${this.x + jX}px, ${this.y + jY}px) scale(${1 + (signalPower / 200)})`;

                return this.x > channelContainer.clientWidth; // Return true if off screen
            }

            flip() {
                this.value = this.value === "1" ? "0" : "1";
                this.el.innerText = this.value;
                this.el.style.color = "#ef4444"; // Turn red on error
            }

            remove() {
                this.el.remove();
            }
        }

        // Noise Visuals
        class NoiseParticle {
            constructor() {
                this.x = Math.random() * channelContainer.clientWidth;
                this.y = Math.random() * channelContainer.clientHeight;
                this.size = Math.random() * 3;

                this.el = document.createElement('div');
                this.el.className = 'noise-particle bg-red-500 opacity-0';
                this.el.style.width = this.size + 'px';
                this.el.style.height = this.size + 'px';

                channelContainer.appendChild(this.el);
            }

            update() {
                // Visibility depends on noise level
                const opacity = (noiseLevel / 100) * 0.5;
                this.el.style.opacity = opacity;

                // Movement chaos
                this.x += (Math.random() - 0.5) * 10;
                this.y += (Math.random() - 0.5) * 10;

                this.el.style.transform = `translate(${this.x}px, ${this.y}px)`;

                // Respawn if OOB
                if (this.x < 0 || this.x > channelContainer.clientWidth) this.x = Math.random() * channelContainer.clientWidth;
                if (this.y < 0 || this.y > channelContainer.clientHeight) this.y = Math.random() * channelContainer.clientHeight;
            }
        }

        // --- MAIN LOOP ---
        const bits = [];
        const noiseParticles = [];
        let receivedBin = "";
        let expectedLength = 0;

        // Initialize Noise
        for (let i = 0; i < 50; i++) {
            noiseParticles.push(new NoiseParticle());
        }

        function gameLoop() {
            // Spawn Bits
            const msg = sourceInput.value.toUpperCase() || "HELLO";
            const bin = stringToBinary(msg);
            expectedLength = bin.length;

            if (frameCount % (15 - Math.floor(redundancy * 2)) === 0) { // Spawn rate
                const index = Math.floor(frameCount / 10) % bin.length;
                const charIndex = Math.floor(Math.random() * bin.length);
                const bitVal = bin[charIndex];

                bits.push(new Bit(bitVal, charIndex, bin.length));
            }

            // Update Bits
            for (let i = bits.length - 1; i >= 0; i--) {
                const finished = bits[i].update();
                if (finished) {
                    updateReceiver(bits[i]);
                    bits[i].remove();
                    bits.splice(i, 1);
                }
            }

            // Update Noise
            noiseParticles.forEach(p => p.update());

            // Update SNR Display
            const snr = (signalPower / (Math.max(1, noiseLevel))).toFixed(2);
            snrDisplay.innerText = `${snr} dB`;
            snrDisplay.style.color = snr > 2 ? "#10b981" : "#ef4444";

            frameCount++;
            requestAnimationFrame(gameLoop);
        }

        // --- RECEIVER LOGIC ---
        function updateReceiver(bit) {
            const noiseFactor = Math.max(0.1, noiseLevel);
            const signalFactor = Math.max(0.1, signalPower);
            const errorProb = (noiseFactor / (signalFactor * redundancy * 2));

            const sourceMsg = sourceInput.value.toUpperCase();
            let newMsg = "";

            for (let i = 0; i < sourceMsg.length; i++) {
                if (Math.random() < errorProb) {
                    // Corrupt char
                    const chars = "!@#$%^&*?";
                    newMsg += chars[Math.floor(Math.random() * chars.length)];
                } else {
                    newMsg += sourceMsg[i];
                }
            }

            rxOutput.innerText = newMsg;

            // Color code output
            if (newMsg === sourceMsg) {
                rxOutput.className = "font-mono text-2xl md:text-4xl font-bold tracking-widest text-emerald-500 transition-colors";
            } else {
                rxOutput.className = "font-mono text-2xl md:text-4xl font-bold tracking-widest text-red-500 transition-colors";
            }
        }

        // --- EVENT LISTENERS ---
        sSignal.addEventListener('input', (e) => {
            signalPower = parseInt(e.target.value);
            vSignal.innerText = signalPower + "%";
        });

        sNoise.addEventListener('input', (e) => {
            noiseLevel = parseInt(e.target.value);
            vNoise.innerText = noiseLevel + "%";
        });

        sRedun.addEventListener('input', (e) => {
            redundancy = parseInt(e.target.value);
            vRedun.innerText = redundancy + "x";
        });

        // Start
        gameLoop();

    </script>
</body>

</html>