<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baseband Transmission — Paper X</title>
    <link rel="icon" type="image/x-icon" href="../assets/img/favicon.svg">

    <!-- Inter + Material Symbols -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;700&family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,600,0,0"
        rel="stylesheet">

    <!-- Tailwind CSS bundle used across Paper X -->
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                container: { center: true, padding: '1rem' },
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'ui-sans-serif', 'system-ui', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace']
                    },
                    colors: {
                        brand: { 900: '#1E1E2F', 700: '#4C2A59', 500: '#9E4B8A' },
                        brandlt: {
                            50: '#FAF5FB',
                            100: '#F3E7F2',
                            200: '#E7D0E4',
                            300: '#D9B4D3',
                            400: '#C88DBA',
                            500: '#9E4B8A',
                            700: '#4C2A59',
                            900: '#1E1E2F'
                        }
                    },
                    boxShadow: {
                        glow: '0 8px 30px rgba(158,75,138,0.35)',
                        soft: '0 10px 30px rgba(0,0,0,0.25)',
                        card: '0 24px 60px rgba(30,30,47,0.35)'
                    },
                    backgroundImage: {
                        'hero-dark': 'radial-gradient(900px 520px at 50% -15%, rgba(158,75,138,0.35), transparent 65%), linear-gradient(180deg,#1E1E2F 0%,#201934 55%,#141321 100%)',
                        'hero-light': 'radial-gradient(1000px 560px at 50% -18%, rgba(158,75,138,0.18), transparent 62%), linear-gradient(180deg,#FFFFFF 0%,#FBF8FC 55%,#F7F2F9 100%)'
                    }
                }
            }
        }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        :root {
            --bg-app: #F7F2F9;
            --bg-card: #FFFFFF;
            --text-head: #1E1E2F;
            --text-body: #2F2F3A;
            --text-sub: #5A5A6B;
            --border: #E5DFEC;
            --scope-bg: #ffffff;
            --accent-glow: rgba(158, 75, 138, 0.12);
        }

        .dark {
            --bg-app: #1E1E2F;
            --bg-card: #201934;
            --text-head: #F3E7F2;
            --text-body: #E8E3EE;
            --text-sub: #C9BED5;
            --border: #3A3247;
            --scope-bg: #0f0a15;
            --accent-glow: rgba(158, 75, 138, 0.25);
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
        }

        .mono {
            font-family: 'JetBrains Mono', monospace;
        }

        .lab-shell {
            min-height: 100vh;
            background-image: linear-gradient(180deg, #FFFFFF 0%, #FBF8FC 45%, #F7F2F9 100%);
        }

        .dark .lab-shell {
            background-image: linear-gradient(180deg, #1E1E2F 0%, #201934 55%, #141321 100%);
        }

        /* Glass Panel */
        .glass-panel {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.9), rgba(243, 231, 242, 0.95));
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(158, 75, 138, 0.16);
            box-shadow: 0 18px 40px -18px rgba(30, 30, 47, 0.35);
            border-radius: 1rem;
            transition: all 0.3s ease;
        }

        .dark .glass-panel {
            background: linear-gradient(145deg, rgba(30, 30, 47, 0.96), rgba(30, 30, 47, 0.86));
            border-color: rgba(200, 141, 186, 0.35);
            box-shadow: 0 22px 60px -20px rgba(0, 0, 0, 0.8);
        }

        /* Cyber Grid */
        .cyber-grid {
            background-size: 40px 40px;
            background-image: linear-gradient(to right, rgba(158, 75, 138, 0.03) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(158, 75, 138, 0.03) 1px, transparent 1px);
        }

        .dark .cyber-grid {
            background-image: linear-gradient(to right, rgba(200, 141, 186, 0.04) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(200, 141, 186, 0.04) 1px, transparent 1px);
        }

        /* Mode Buttons */
        .mode-btn {
            background: rgba(250, 245, 251, 0.96);
            border: 1px solid rgba(158, 75, 138, 0.18);
            color: #4C2A59;
            transition: all 0.2s ease;
        }

        .dark .mode-btn {
            background: rgba(30, 30, 47, 0.96);
            border-color: rgba(200, 141, 186, 0.35);
            color: #C9BED5;
        }

        .mode-btn:hover {
            background-color: rgba(158, 75, 138, 0.12);
            border-color: #9E4B8A;
            color: #9E4B8A;
        }

        .mode-btn.active-encoding {
            background: linear-gradient(135deg, #9E4B8A, #B06AB3);
            color: #FFFFFF;
            border-color: transparent;
            box-shadow: 0 8px 26px rgba(158, 75, 138, 0.6);
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-app);
        }

        ::-webkit-scrollbar-thumb {
            background: #9E4B8A;
            border-radius: 4px;
            opacity: 0.5;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #B06AB3;
        }

        /* Range Slider */
        input[type=range] {
            -webkit-appearance: none;
            background: transparent;
            width: 100%;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #9E4B8A;
            cursor: pointer;
            margin-top: -8px;
            box-shadow: 0 0 10px rgba(158, 75, 138, 0.5);
            border: 2px solid #fff;
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: var(--border);
            border-radius: 2px;
        }

        .highlight-text {
            background: linear-gradient(to right, #9E4B8A, #B06AB3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Info Cards */
        .info-card {
            border-radius: 1rem;
            overflow: hidden;
        }

        /* Bit Button */
        .bit-btn {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.5rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.875rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .bit-btn.active {
            background: rgba(158, 75, 138, 0.2);
            border-color: #9E4B8A;
            color: #9E4B8A;
        }

        .bit-btn.inactive {
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-sub);
        }

        /* Wire Display */
        .wire-display {
            height: 0.5rem;
            border-radius: 9999px;
            position: relative;
            overflow: hidden;
        }
    </style>

    <!-- Persist theme before paint -->
    <script>
            (function () {
                try {
                    const s = localStorage.getItem('px_theme');
                    const prefers = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    const useDark = s ? s === 'dark' : prefers;
                    if (useDark) document.documentElement.classList.add('dark');
                } catch (_) { }
            })();
    </script>
    <script src="../config.js"></script>
</head>

<body class="min-h-screen font-sans antialiased text-neutral-900 dark:text-white bg-hero-light dark:bg-hero-dark">

    <!-- ============== NAVBAR (Paper X) ============== -->
    <header
        class="sticky top-0 z-50 bg-white/80 dark:bg-brand-900/70 backdrop-blur supports-[backdrop-filter]:saturate-150 border-b border-black/5 dark:border-white/10">
        <div class="container flex items-center justify-between py-3.5">
            <a href="../index.html" class="flex items-center gap-3 shrink-0" aria-label="Paper X Home">
                <img src="../assets/img/logo-light.svg" class="h-9 w-auto dark:hidden" alt="Paper X" />
                <img src="../assets/img/logo-dark.svg" class="h-9 w-auto hidden dark:block" alt="Paper X" />
            </a>
            <nav class="hidden md:flex items-center gap-6 text-sm text-neutral-700 dark:text-white/85">
                <a href="../index.html" class="hover:text-brandlt-900 dark:hover:text-white">Home</a>
                <a href="../about.html" class="hover:text-brandlt-900 dark:hover:text-white">About</a>
                <a href="../academicas.html" class="hover:text-brandlt-900 dark:hover:text-white">Academics</a>
                <a href="../contact.html" class="hover:text-brandlt-900 dark:hover:text-white">Support</a>
            </nav>
            <div class="hidden md:flex items-center gap-2">
                <button data-theme-toggle
                    class="inline-flex items-center gap-2 rounded-full px-3 py-2 text-sm ring-1 ring-black/10 dark:ring-white/15 hover:bg-black/5 dark:hover:bg-white/5"
                    aria-label="Toggle theme">
                    <span class="material-symbols-rounded">dark_mode</span>
                    <span class="hidden lg:block">Theme</span>
                </button>
                <a href="../login.html"
                    class="px-3 py-2 text-sm text-neutral-700 dark:text-white/80 hover:text-brandlt-900 dark:hover:text-white rounded-full">Log
                    in</a>
                <a href="../signup.html"
                    class="inline-flex items-center justify-center rounded-full bg-brand-500 text-white text-sm font-semibold px-4 py-2.5 hover:shadow-glow transition">Sign
                    up</a>
            </div>
            <div class="md:hidden flex items-center gap-2">
                <button type="button" data-theme-toggle aria-label="Toggle theme"
                    class="inline-flex items-center justify-center size-10 rounded-full ring-1 ring-black/10 dark:ring-white/15 hover:bg-black/5 dark:hover:bg-white/5 transition">
                    <span class="material-symbols-rounded">dark_mode</span>
                </button>
            </div>
        </div>
    </header>

    <main class="lab-shell cyber-grid pb-10">

        <!-- Hero Section -->
        <section class="min-h-[70vh] flex flex-col justify-center items-center px-6 relative overflow-hidden pt-8">
            <div class="absolute top-[-10%] left-[-10%] w-[600px] h-[600px] rounded-full blur-[120px] pointer-events-none"
                style="background: var(--accent-glow)"></div>

            <div class="max-w-4xl w-full z-10 space-y-8 text-center md:text-left">

                <div class="flex items-center justify-center md:justify-start space-x-4 mb-4">
                    <div class="p-3 rounded-xl border border-brand-500/30 bg-brand-500/10">
                        <i data-lucide="zap" class="w-8 h-8 text-brand-500"></i>
                    </div>
                    <span class="text-brand-500 font-bold tracking-widest text-sm uppercase">The Concept</span>
                </div>

                <h1
                    class="text-5xl md:text-8xl font-black tracking-tight leading-none text-center md:text-left text-brand-900 dark:text-white">
                    Baseband <br>
                    <span class="highlight-text">Transmission</span>
                </h1>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-12 mt-12 text-left">
                    <div class="space-y-6">
                        <p class="text-xl font-light leading-relaxed text-brandlt-700 dark:text-brandlt-300">
                            Imagine a simple light switch connected to a bulb in your neighbor's house.
                        </p>
                        <p class="text-xl font-light leading-relaxed text-brandlt-700 dark:text-brandlt-300">
                            To send a message, you flick the switch. <br>
                            <strong class="text-brand-500">Up (On)</strong> is a 1. <strong class="text-brand-500">Down
                                (Off)</strong> is a 0.
                        </p>
                        <p class="text-xl font-light leading-relaxed text-brandlt-700 dark:text-brandlt-300">
                            There is no "tuning" like a radio. You occupy the <strong>entire wire</strong> with your raw
                            electrical pulse.
                        </p>
                    </div>

                    <div
                        class="glass-panel p-8 flex flex-col justify-center items-center space-y-8 relative group hover:-translate-y-1 transition-transform duration-300">
                        <div class="relative w-full h-32 flex items-center justify-between px-8">
                            <i data-lucide="battery-charging"
                                class="w-12 h-12 text-brandlt-400 dark:text-brandlt-400"></i>

                            <div
                                class="flex-1 h-2 bg-brandlt-200 dark:bg-brand-700 mx-4 rounded-full relative overflow-hidden">
                                <div id="electron-flow" class="absolute inset-0 bg-brand-500 shadow-[0_0_15px_#9E4B8A]"
                                    style="transform: translateX(-100%)"></div>
                            </div>

                            <div class="relative">
                                <i data-lucide="lightbulb" id="bulb-icon"
                                    class="w-12 h-12 text-brandlt-300 dark:text-brandlt-400 transition-colors duration-100"></i>
                                <div id="bulb-glow"
                                    class="absolute inset-0 bg-brand-500 blur-xl opacity-0 transition-opacity duration-100">
                                </div>
                            </div>
                        </div>

                        <div class="flex gap-4">
                            <button id="btn-hold"
                                class="px-6 py-3 bg-brand-500 border border-brand-500 rounded-full text-white font-bold hover:shadow-glow active:scale-95 transition-all shadow-lg flex items-center gap-2 select-none cursor-pointer">
                                <i data-lucide="power" class="w-4 h-4"></i> HOLD TO SEND "1"
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Simulator Section -->
        <section class="py-20 px-4 md:px-8 relative border-t border-brandlt-200 dark:border-brand-700">
            <div class="max-w-6xl mx-auto">

                <div class="flex flex-col md:flex-row justify-between items-end mb-12">
                    <div>
                        <h2 class="text-4xl font-bold mb-2 text-brand-900 dark:text-white">The Line Coder</h2>
                        <p class="text-brandlt-700 dark:text-brandlt-300">How we turn 1s and 0s into voltage over time.
                        </p>
                    </div>

                    <div class="glass-panel px-4 py-2 flex items-center space-x-6 mt-6 md:mt-0">
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 bg-brand-500 rounded-sm"></div>
                            <span class="text-xs font-bold text-brandlt-700 dark:text-brandlt-300">+5V (High)</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 bg-brandlt-400 rounded-sm"></div>
                            <span class="text-xs font-bold text-brandlt-700 dark:text-brandlt-300">0V (Low)</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 bg-red-500 rounded-sm"></div>
                            <span class="text-xs font-bold text-brandlt-700 dark:text-brandlt-300">-5V (Neg)</span>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 min-h-[600px]">

                    <!-- Oscilloscope -->
                    <div class="lg:col-span-8 relative glass-panel overflow-hidden flex flex-col"
                        style="background: var(--scope-bg); min-height: 450px;">
                        <div class="absolute top-4 left-4 z-10 pointer-events-none">
                            <span
                                class="text-[10px] font-bold text-brand-500 bg-brand-500/10 px-2 py-1 rounded border border-brand-500/20">OSCILLOSCOPE</span>
                        </div>

                        <canvas id="osc-canvas" class="w-full h-full block"></canvas>

                        <div
                            class="absolute inset-y-0 left-1/2 w-px border-r border-dashed pointer-events-none border-brandlt-400/30">
                        </div>
                        <div class="absolute bottom-2 left-1/2 text-[10px] pl-2 text-brandlt-700 dark:text-brandlt-300">
                            CURRENT TIME</div>
                    </div>

                    <!-- Controls -->
                    <div class="lg:col-span-4 flex flex-col gap-6">

                        <!-- Data Stream -->
                        <div class="glass-panel p-6 border-l-4 border-brand-500">
                            <h3 class="text-xs font-bold text-brand-500 uppercase tracking-widest mb-4">1. Data Stream
                            </h3>
                            <div class="flex flex-wrap gap-2" id="bit-container">
                            </div>
                            <button onclick="randomizeBits()"
                                class="mt-4 text-xs hover:text-brand-500 flex items-center gap-1 text-brandlt-700 dark:text-brandlt-300 cursor-pointer">
                                <i data-lucide="shuffle" class="w-3 h-3"></i> Randomize
                            </button>
                        </div>

                        <!-- Encoding Scheme -->
                        <div class="glass-panel p-6 border-l-4 border-brandlt-400 flex-1">
                            <h3 class="text-xs font-bold text-brandlt-500 uppercase tracking-widest mb-4">2. Line Coding
                                Scheme</h3>

                            <div class="space-y-2">
                                <button onclick="setEncoding('NRZ-L')" id="btn-nrz"
                                    class="mode-btn active-encoding w-full text-left px-4 py-3 rounded-lg text-sm font-bold transition-all cursor-pointer">
                                    NRZ-L (Non-Return to Zero)
                                    <span class="block text-[10px] font-normal opacity-70 mt-1">Simple. 1=High,
                                        0=Low.</span>
                                </button>

                                <button onclick="setEncoding('MANCHESTER')" id="btn-man"
                                    class="mode-btn w-full text-left px-4 py-3 rounded-lg text-sm font-bold transition-all cursor-pointer">
                                    Manchester (Ethernet)
                                    <span class="block text-[10px] font-normal opacity-70 mt-1">Transition in middle.
                                        Self-clocking.</span>
                                </button>

                                <button onclick="setEncoding('RZ')" id="btn-rz"
                                    class="mode-btn w-full text-left px-4 py-3 rounded-lg text-sm font-bold transition-all cursor-pointer">
                                    RZ (Return to Zero)
                                    <span class="block text-[10px] font-normal opacity-70 mt-1">Uses 3 levels (+, 0, -).
                                        Returns to 0.</span>
                                </button>
                            </div>
                        </div>

                        <!-- Speed Slider -->
                        <div class="glass-panel p-4">
                            <div class="flex justify-between items-center mb-2">
                                <label
                                    class="text-[10px] font-bold uppercase text-brandlt-700 dark:text-brandlt-300">Transmission
                                    Speed</label>
                                <span id="speed-val"
                                    class="text-[10px] font-mono text-brand-900 dark:text-white">1x</span>
                            </div>
                            <input type="range" id="speed-slider" min="0.5" max="3" step="0.1" value="1">
                        </div>

                    </div>
                </div>
            </div>
        </section>

        <!-- Under The Hood Section -->
        <section class="py-24 px-6 relative z-10">
            <div class="max-w-6xl mx-auto">
                <h2 class="text-3xl font-bold mb-12 text-center text-brand-900 dark:text-white">Under The Hood</h2>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 auto-rows-fr">

                    <div class="glass-panel p-6 info-card border-t-4 border-brand-500 h-full flex flex-col">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="text-xl font-bold text-brand-900 dark:text-white">Baseband</h3>
                            <i data-lucide="zap" class="w-6 h-6 text-brand-500"></i>
                        </div>
                        <p class="leading-relaxed text-sm flex-grow text-brandlt-700 dark:text-brandlt-300">
                            Sending a digital signal directly on the transmission medium without modulation. The entire
                            bandwidth of the cable is used for a single signal.
                        </p>
                    </div>

                    <div class="glass-panel p-6 info-card border-t-4 border-brandlt-400 h-full flex flex-col">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="text-xl font-bold text-brand-900 dark:text-white">Synchronization</h3>
                            <i data-lucide="clock" class="w-6 h-6 text-brandlt-400"></i>
                        </div>
                        <p class="leading-relaxed text-sm flex-grow text-brandlt-700 dark:text-brandlt-300">
                            The biggest challenge. If the sender sends "000000" very fast, how does the receiver know if
                            it was 6 zeros or 7? Schemes like <strong class="text-brand-500">Manchester</strong> solve
                            this by forcing a change in voltage for every bit.
                        </p>
                    </div>

                    <div class="glass-panel p-6 info-card border-t-4 border-emerald-500 h-full flex flex-col">
                        <div class="flex justify-between items-start mb-4">
                            <h3 class="text-xl font-bold text-brand-900 dark:text-white">TDM</h3>
                            <i data-lucide="layers" class="w-6 h-6 text-emerald-500"></i>
                        </div>
                        <p class="leading-relaxed text-sm flex-grow text-brandlt-700 dark:text-brandlt-300">
                            <strong class="text-brand-500">Time Division Multiplexing.</strong> Since baseband uses the
                            whole wire, multiple users must take turns. User A sends for 1ms, then User B sends for 1ms.
                        </p>
                    </div>


                    <div class="glass-panel p-6 info-card md:col-span-2 lg:col-span-3">
                        <h3 class="text-lg font-bold mb-4 text-brand-900 dark:text-white">Baseband vs. Broadband</h3>
                        <div class="grid grid-cols-2 gap-8 text-sm">
                            <div>
                                <h4 class="text-brand-500 font-bold mb-2">Baseband (Digital)</h4>
                                <ul class="space-y-2 list-disc list-inside text-brandlt-700 dark:text-brandlt-300">
                                    <li>Uses discrete voltage pulses</li>
                                    <li>Bi-directional (Half-duplex usually)</li>
                                    <li>Short distance (signal degrades)</li>
                                    <li>Example: Ethernet (LAN)</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="text-brandlt-400 font-bold mb-2">Broadband (Analog)</h4>
                                <ul class="space-y-2 list-disc list-inside text-brandlt-700 dark:text-brandlt-300">
                                    <li>Uses analog waves (Modulation)</li>
                                    <li>Uni-directional (Simplex) typically</li>
                                    <li>Long distance</li>
                                    <li>Example: Cable TV, Radio</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer
        class="py-12 text-center text-sm border-t border-brandlt-200 dark:border-brand-700 bg-white/50 dark:bg-brand-900/50">
        <p class="text-brandlt-700 dark:text-brandlt-300">Explorable Explanation Design — Paper X</p>
    </footer>

    <script>
        lucide.createIcons();

        // --- HOLD BUTTON LOGIC ---
        const btnHold = document.getElementById('btn-hold');
        const flow = document.getElementById('electron-flow');
        const bulb = document.getElementById('bulb-icon');
        const glow = document.getElementById('bulb-glow');

        function activate() {
            gsap.to(flow, { x: '0%', duration: 0.1 });
            gsap.to(bulb, { color: '#9E4B8A', duration: 0.1 });
            gsap.to(glow, { opacity: 1, duration: 0.1 });
            btnHold.style.transform = "scale(0.95)";
        }

        function deactivate() {
            gsap.to(flow, { x: '-100%', duration: 0.1 });
            gsap.to(bulb, { color: '#C88DBA', duration: 0.1 });
            gsap.to(glow, { opacity: 0, duration: 0.1 });
            btnHold.style.transform = "scale(1)";
        }

        // Add Listeners
        btnHold.addEventListener('mousedown', activate);
        btnHold.addEventListener('mouseup', deactivate);
        btnHold.addEventListener('mouseleave', deactivate);
        btnHold.addEventListener('touchstart', (e) => { e.preventDefault(); activate(); });
        btnHold.addEventListener('touchend', deactivate);

        // --- SIMULATOR CONFIG ---
        const bitCount = 8;
        let bits = [1, 0, 1, 1, 0, 0, 1, 0];
        let currentEncoding = 'NRZ-L';
        let speed = 2;
        let time = 0;

        // Canvas Setup
        const canvas = document.getElementById('osc-canvas');
        const ctx = canvas.getContext('2d');
        let width, height;

        // Elements
        const bitContainer = document.getElementById('bit-container');
        const btns = {
            'NRZ-L': document.getElementById('btn-nrz'),
            'MANCHESTER': document.getElementById('btn-man'),
            'RZ': document.getElementById('btn-rz')
        };

        function initBits() {
            bitContainer.innerHTML = '';
            bits.forEach((bit, index) => {
                const btn = document.createElement('button');
                const isDark = document.documentElement.classList.contains('dark');
                btn.className = `bit-btn cursor-pointer ${bit ? 'active' : 'inactive'}`;
                if (bit) {
                    btn.style.background = 'rgba(158, 75, 138, 0.2)';
                    btn.style.borderColor = '#9E4B8A';
                    btn.style.color = '#9E4B8A';
                    btn.style.border = '1px solid #9E4B8A';
                } else {
                    btn.style.background = isDark ? '#201934' : '#fff';
                    btn.style.border = '1px solid ' + (isDark ? '#3A3247' : '#E5DFEC');
                    btn.style.color = isDark ? '#C9BED5' : '#5A5A6B';
                }
                btn.innerText = bit;
                btn.onclick = () => {
                    bits[index] = bits[index] === 1 ? 0 : 1;
                    initBits();
                };
                bitContainer.appendChild(btn);
            });
        }

        function randomizeBits() {
            bits = bits.map(() => Math.random() > 0.5 ? 1 : 0);
            initBits();
        }

        function setEncoding(type) {
            currentEncoding = type;
            // Clear all active classes
            Object.values(btns).forEach(b => b.classList.remove('active-encoding'));
            // Add to current
            btns[type].classList.add('active-encoding');
        }

        function resize() {
            width = canvas.parentElement.clientWidth;
            height = canvas.parentElement.clientHeight;
            canvas.width = width;
            canvas.height = height;
        }
        window.addEventListener('resize', resize);
        resize();

        function getVoltage(bit, t, encoding) {
            if (encoding === 'NRZ-L') {
                return bit === 1 ? 1 : -1;
            }
            else if (encoding === 'MANCHESTER') {
                if (bit === 1) return t < 0.5 ? -1 : 1;
                else return t < 0.5 ? 1 : -1;
            }
            else if (encoding === 'RZ') {
                if (t > 0.5) return 0;
                return bit === 1 ? 1 : -1;
            }
            return 0;
        }

        function animate() {
            const isDark = document.documentElement.classList.contains('dark');
            const scopeBg = isDark ? '#0f0a15' : '#ffffff';
            const lineColor = '#9E4B8A';

            ctx.fillStyle = scopeBg;
            ctx.fillRect(0, 0, width, height);

            const bitWidth = 100;

            // Draw Grid
            ctx.strokeStyle = isDark ? 'rgba(200, 141, 186, 0.1)' : 'rgba(158, 75, 138, 0.1)';
            ctx.beginPath();
            for (let y = 0; y < height; y += 40) { ctx.moveTo(0, y); ctx.lineTo(width, y); }
            ctx.stroke();

            // Draw Signal
            ctx.lineWidth = 3;
            ctx.strokeStyle = lineColor;
            ctx.shadowColor = lineColor;
            ctx.shadowBlur = 10;
            ctx.lineJoin = 'round';
            ctx.beginPath();

            const loopWidth = bits.length * bitWidth;
            const scrollX = (time * speed) % loopWidth;
            let hasStarted = false;

            for (let x = 0; x < width; x += 2) {
                let dataPos = (x + scrollX);
                let bitIndex = Math.floor(dataPos / bitWidth) % bits.length;
                let bit = bits[bitIndex];
                let t = (dataPos % bitWidth) / bitWidth;

                let voltage = getVoltage(bit, t, currentEncoding);
                let y = (height / 2) - (voltage * (height * 0.3));

                if (!hasStarted) {
                    ctx.moveTo(x, y);
                    hasStarted = true;
                } else {
                    ctx.lineTo(x, y);
                }
            }

            ctx.stroke();
            ctx.shadowBlur = 0;

            const speedInput = document.getElementById('speed-slider');
            speed = parseFloat(speedInput.value);
            document.getElementById('speed-val').innerText = speed + "x";

            time += 1;
            requestAnimationFrame(animate);
        }

        // Init
        initBits();
        setEncoding('NRZ-L');
        animate();

        // Shared Paper X theme toggle wiring
        const themeToggles = document.querySelectorAll('[data-theme-toggle]');
        const root = document.documentElement;

        themeToggles.forEach(btn => {
            btn.addEventListener('click', () => {
                const isDark = root.classList.toggle('dark');
                try { localStorage.setItem('px_theme', isDark ? 'dark' : 'light'); } catch (_) { }
                // Re-init bits to update colors
                initBits();
            });
        });

    </script>
</body>

</html>