<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stochastic Gradient Descent Lab — Paper X</title>
    <link rel="icon" type="image/x-icon" href="../../../assets/img/favicon.svg">

    <!-- Inter + Material Symbols -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;700&family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,600,0,0"
        rel="stylesheet">

    <!-- Tailwind CSS bundle used across Paper X -->
    <link rel="stylesheet" href="../../../assets/css/tailwind.css" />

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                container: { center: true, padding: '1rem' },
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'ui-sans-serif', 'system-ui', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace']
                    },
                    colors: {
                        brand: { 900: '#1E1E2F', 700: '#4C2A59', 500: '#9E4B8A' },
                        brandlt: {
                            50: '#FAF5FB',
                            100: '#F3E7F2',
                            200: '#E7D0E4',
                            300: '#D9B4D3',
                            400: '#C88DBA',
                            500: '#9E4B8A',
                            700: '#4C2A59',
                            900: '#1E1E2F'
                        }
                    },
                    boxShadow: {
                        glow: '0 8px 30px rgba(158,75,138,0.35)',
                        soft: '0 10px 30px rgba(0,0,0,0.25)',
                        card: '0 24px 60px rgba(30,30,47,0.35)'
                    },
                    backgroundImage: {
                        'hero-dark': 'radial-gradient(900px 520px at 50% -15%, rgba(158,75,138,0.35), transparent 65%), linear-gradient(180deg,#1E1E2F 0%,#201934 55%,#141321 100%)',
                        'hero-light': 'radial-gradient(1000px 560px at 50% -18%, rgba(158,75,138,0.18), transparent 62%), linear-gradient(180deg,#FFFFFF 0%,#FBF8FC 55%,#F7F2F9 100%)'
                    }
                }
            }
        }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        :root {
            --bg-app: #F7F2F9;
            --bg-card: #FFFFFF;
            --text-head: #1E1E2F;
            --text-body: #2F2F3A;
            --text-sub: #5A5A6B;
            --border: #E5DFEC;
            --brand-500: #9E4B8A;
            --brand-700: #4C2A59;
            --brand-900: #1E1E2F;
        }

        .dark {
            --bg-app: #1E1E2F;
            --bg-card: #201934;
            --text-head: #F3E7F2;
            --text-body: #E8E3EE;
            --text-sub: #C9BED5;
            --border: #3A3247;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
        }

        .lab-shell {
            min-height: 100vh;
            background-image: linear-gradient(180deg, #FFFFFF 0%, #FBF8FC 45%, #F7F2F9 100%);
        }

        .dark .lab-shell {
            background-image: linear-gradient(180deg, #1E1E2F 0%, #201934 55%, #141321 100%);
        }

        /* Glassmorphism Panels */
        .glass-panel {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(158, 75, 138, 0.15);
            box-shadow: 0 8px 32px rgba(30, 30, 47, 0.12);
        }

        .dark .glass-panel {
            background: rgba(30, 30, 47, 0.75);
            border: 1px solid rgba(200, 141, 186, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.35);
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(158, 75, 138, 0.12);
            transition: transform 0.2s ease, border-color 0.2s;
        }

        .dark .glass-card {
            background: rgba(30, 30, 47, 0.85);
            border: 1px solid rgba(200, 141, 186, 0.25);
        }

        .glass-card:hover {
            border-color: rgba(158, 75, 138, 0.4);
        }

        .glass-button {
            background: rgba(158, 75, 138, 0.1);
            border: 1px solid rgba(158, 75, 138, 0.3);
            transition: all 0.2s ease;
        }

        .glass-button:hover {
            background: rgba(158, 75, 138, 0.2);
            box-shadow: 0 0 15px rgba(158, 75, 138, 0.3);
        }

        .glass-button.active {
            background: rgba(158, 75, 138, 0.8);
            color: white;
            box-shadow: 0 0 15px rgba(158, 75, 138, 0.5);
        }

        /* Canvas styling */
        .contour-canvas {
            background: rgba(250, 245, 251, 0.95);
            border-radius: 0.75rem;
            box-shadow: inset 0 0 20px rgba(158, 75, 138, 0.08);
        }

        .dark .contour-canvas {
            background: rgba(30, 30, 47, 0.95);
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.3);
        }

        /* Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px;
            width: 16px;
            border-radius: 50%;
            background: #9E4B8A;
            cursor: pointer;
            margin-top: -6px;
            box-shadow: 0 0 10px rgba(158, 75, 138, 0.6);
        }

        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #E7D0E4;
            border-radius: 2px;
        }

        .dark input[type=range]::-webkit-slider-runnable-track {
            background: #4C2A59;
        }

        /* Hero Section Text */
        .gradient-hero-text {
            display: inline-block;
            background-image: linear-gradient(90deg, #1E1E2F, #4C2A59, #9E4B8A, #4C2A59, #1E1E2F);
            background-size: 200% 200%;
            animation: gradient-shift 4s ease-in-out infinite;
            color: transparent;
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .dark .gradient-hero-text {
            background-image: linear-gradient(90deg, #EFA3DC, #CA6CB3, #FFFFFF, #CA6CB3, #EFA3DC);
        }

        @keyframes gradient-shift {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        canvas {
            touch-action: none;
        }
    </style>

    <!-- Persist theme before paint -->
    <script>
            (function () {
                try {
                    const s = localStorage.getItem('px_theme');
                    const prefers = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    const useDark = s ? s === 'dark' : prefers;
                    if (useDark) document.documentElement.classList.add('dark');
                } catch (_) { }
            })();
    </script>
    <script src="../../../config.js"></script>
</head>

<body class="min-h-screen font-sans antialiased text-neutral-900 dark:text-white bg-hero-light dark:bg-hero-dark">

    <!-- ============== NAVBAR (Paper X) ============== -->
    <header
        class="sticky top-0 z-50 bg-white/80 dark:bg-brand-900/70 backdrop-blur supports-[backdrop-filter]:saturate-150 border-b border-black/5 dark:border-white/10">
        <div class="container flex items-center justify-between py-3.5">
            <a href="../../../index.html" class="flex items-center gap-3 shrink-0" aria-label="Paper X Home">
                <img src="../../../assets/img/logo-light.svg" class="h-9 w-auto dark:hidden" alt="Paper X" />
                <img src="../../../assets/img/logo-dark.svg" class="h-9 w-auto hidden dark:block" alt="Paper X" />
            </a>
            <nav class="hidden md:flex items-center gap-6 text-sm text-neutral-700 dark:text-white/85">
                <a href="../../../index.html" class="hover:text-brandlt-900 dark:hover:text-white">Home</a>
                <a href="../../../about.html" class="hover:text-brandlt-900 dark:hover:text-white">About</a>
                <a href="../../../academicas.html" class="hover:text-brandlt-900 dark:hover:text-white">Academics</a>
                <a href="../../../contact.html" class="hover:text-brandlt-900 dark:hover:text-white">Support</a>
            </nav>
            <div class="hidden md:flex items-center gap-2">
                <button data-theme-toggle
                    class="inline-flex items-center gap-2 rounded-full px-3 py-2 text-sm ring-1 ring-black/10 dark:ring-white/15 hover:bg-black/5 dark:hover:bg-white/5"
                    aria-label="Toggle theme">
                    <span class="material-symbols-rounded">dark_mode</span>
                    <span class="hidden lg:block">Theme</span>
                </button>
                <a href="../../../login.html"
                    class="px-3 py-2 text-sm text-neutral-700 dark:text-white/80 hover:text-brandlt-900 dark:hover:text-white rounded-full">Log
                    in</a>
                <a href="../../../signup.html"
                    class="inline-flex items-center justify-center rounded-full bg-brand-500 text-white text-sm font-semibold px-4 py-2.5 hover:shadow-glow transition">Sign
                    up</a>
            </div>
            <div class="md:hidden flex items-center gap-2">
                <button type="button" data-theme-toggle aria-label="Toggle theme"
                    class="inline-flex items-center justify-center size-10 rounded-full ring-1 ring-black/10 dark:ring-white/15 hover:bg-black/5 dark:hover:bg-white/5 transition">
                    <span class="material-symbols-rounded">dark_mode</span>
                </button>
            </div>
        </div>
    </header>

    <main class="lab-shell pb-10">
        <!-- Hero Section -->
        <section class="pt-12 pb-8">
            <div class="container max-w-4xl mx-auto px-4 text-center">
                <div
                    class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-brand-500/10 border border-brand-500/20 text-brand-500 dark:text-brandlt-400 text-xs tracking-widest uppercase font-bold mb-4">
                    <i data-lucide="zap" class="w-3 h-3"></i> Interactive Deep Dive
                </div>

                <h1 class="text-4xl md:text-6xl font-extrabold tracking-tight gradient-hero-text mb-6">
                    Stochastic Gradient Descent
                </h1>

                <p
                    class="text-lg md:text-xl text-neutral-600 dark:text-white/70 leading-relaxed font-light max-w-2xl mx-auto">
                    Imagine a hiker navigating a mountain in thick fog. They can only feel the slope beneath their feet
                    and take steps downhill.
                </p>

                <div class="glass-panel p-6 rounded-2xl text-left max-w-3xl mx-auto mt-8 border-l-4 border-brand-500">
                    <p class="text-neutral-700 dark:text-white/80 text-lg">
                        <span class="text-brand-900 dark:text-white font-semibold">Stochastic Gradient Descent
                            (SGD)</span>
                        is like taking these steps while slightly drunk. Sometimes you stumble a bit off-course
                        (randomness),
                        but because you generally follow the slope downhill, you eventually find the village—often
                        <strong>faster</strong> than carefully measuring the entire mountain at every step.
                    </p>
                </div>

                <div class="mt-8 animate-bounce text-neutral-400 dark:text-white/40">
                    <i data-lucide="chevron-down" class="w-6 h-6 mx-auto"></i>
                </div>
            </div>
        </section>

        <!-- Lab Section -->
        <section class="py-10 px-4 md:px-8" id="lab">
            <div class="max-w-7xl mx-auto">
                <div class="flex items-center gap-4 mb-8">
                    <div class="p-3 bg-brand-500/20 rounded-lg text-brand-500 dark:text-brandlt-400">
                        <i data-lucide="gamepad-2" class="w-6 h-6"></i>
                    </div>
                    <div>
                        <h2 class="text-2xl md:text-3xl font-bold text-brand-900 dark:text-white">Interactive Simulator
                        </h2>
                        <p class="text-neutral-600 dark:text-white/60">The <strong>Green Dot</strong> is your AI model
                            learning to find the valley. Red = High Error, Blue = Low Error.</p>
                    </div>
                </div>

                <div class="grid lg:grid-cols-12 gap-8 items-start">
                    <!-- Controls Panel -->
                    <div class="lg:col-span-4 space-y-6">
                        <div class="glass-panel p-6 rounded-2xl">
                            <div class="flex items-center gap-2 mb-6 border-b border-black/5 dark:border-white/10 pb-4">
                                <i data-lucide="settings-2" class="w-4 h-4 text-brand-500"></i>
                                <h3
                                    class="text-sm font-bold uppercase tracking-wider text-neutral-600 dark:text-white/70">
                                    Tune Configuration</h3>
                            </div>

                            <div class="mb-8">
                                <div class="flex justify-between mb-2">
                                    <label class="text-sm font-semibold text-neutral-700 dark:text-white/80">Learning
                                        Rate (Step Size)</label>
                                    <span id="lr-val" class="text-sm font-mono text-brand-500">0.05</span>
                                </div>
                                <input type="range" id="learning-rate" min="0.001" max="0.2" step="0.001" value="0.05">
                                <p class="text-xs text-neutral-500 dark:text-white/50 mt-2">How big of a step the hiker
                                    takes.</p>
                            </div>

                            <div class="mb-8">
                                <div class="flex justify-between mb-2">
                                    <label
                                        class="text-sm font-semibold text-neutral-700 dark:text-white/80">Stochasticity
                                        (Drunkenness)</label>
                                    <span id="noise-val" class="text-sm font-mono text-brand-500">Medium</span>
                                </div>
                                <input type="range" id="noise-level" min="0" max="50" step="1" value="20">
                                <p class="text-xs text-neutral-500 dark:text-white/50 mt-2">How much random noise is
                                    added to the direction.</p>
                            </div>

                            <div class="grid grid-cols-2 gap-3 mb-6">
                                <button id="btn-start"
                                    class="glass-button text-brand-500 font-bold py-3 px-4 rounded-lg transition flex items-center justify-center gap-2">
                                    <i data-lucide="play" class="w-4 h-4"></i> Start
                                </button>
                                <button id="btn-reset"
                                    class="glass-button text-neutral-600 dark:text-white/70 font-bold py-3 px-4 rounded-lg transition flex items-center justify-center gap-2">
                                    <i data-lucide="rotate-ccw" class="w-4 h-4"></i> Reset
                                </button>
                            </div>

                            <div
                                class="bg-brandlt-50 dark:bg-white/5 p-4 rounded-xl border border-brand-500/10 dark:border-white/10">
                                <div
                                    class="text-xs uppercase text-neutral-500 dark:text-white/50 font-bold mb-3 flex items-center gap-2">
                                    <i data-lucide="activity" class="w-3 h-3"></i> Live Stats
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <p class="text-xs text-neutral-500 dark:text-white/50 uppercase">Loss (Height)
                                        </p>
                                        <p id="stat-loss"
                                            class="text-xl font-mono text-brand-500 dark:text-brandlt-400">0.00</p>
                                    </div>
                                    <div>
                                        <p class="text-xs text-neutral-500 dark:text-white/50 uppercase">Steps</p>
                                        <p id="stat-steps" class="text-xl font-mono text-brand-900 dark:text-white">0
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Canvas Panel -->
                    <div class="lg:col-span-8 space-y-6">
                        <div class="glass-panel p-1 rounded-2xl relative overflow-hidden group">
                            <canvas id="sim-canvas"
                                class="w-full h-[450px] contour-canvas rounded-xl cursor-crosshair"></canvas>

                            <div id="success-msg"
                                class="absolute inset-0 bg-brandlt-50/90 dark:bg-brand-900/90 flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-500 rounded-xl backdrop-blur-sm">
                                <div class="text-center">
                                    <i data-lucide="check-circle"
                                        class="w-16 h-16 text-brand-500 mx-auto mb-4 animate-pulse"></i>
                                    <h3 class="text-2xl font-bold text-brand-900 dark:text-white">Valley Found!</h3>
                                    <p class="text-neutral-600 dark:text-white/60">The model has converged.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- How It Works Section -->
        <section class="py-16 px-6 max-w-6xl mx-auto">
            <div class="mb-12 border-l-4 border-brand-500 pl-6">
                <h2 class="text-3xl md:text-4xl font-bold text-brand-900 dark:text-white mb-2">Under the Hood</h2>
                <p class="text-neutral-600 dark:text-white/60">The mathematics and intuition behind SGD.</p>
            </div>

            <div class="grid md:grid-cols-3 gap-6">
                <div class="glass-card p-6 rounded-2xl">
                    <div
                        class="w-12 h-12 rounded-full bg-brand-500/20 flex items-center justify-center mb-4 text-brand-500">
                        <i data-lucide="arrow-down-right"></i>
                    </div>
                    <h3 class="text-lg font-bold text-brand-900 dark:text-white mb-2">The Gradient</h3>
                    <p class="text-sm text-neutral-600 dark:text-white/60 leading-relaxed mb-4">
                        The gradient is a vector that points in the direction of the steepest ascent. We want to go
                        down, so we subtract the gradient.
                    </p>
                    <code
                        class="block bg-brandlt-50 dark:bg-white/5 p-3 rounded-lg text-xs font-mono text-brand-700 dark:text-brandlt-400">
                        new_w = w - (learning_rate * gradient)
                    </code>
                </div>

                <div class="glass-card p-6 rounded-2xl">
                    <div
                        class="w-12 h-12 rounded-full bg-brand-700/20 flex items-center justify-center mb-4 text-brand-700 dark:text-brandlt-400">
                        <i data-lucide="shuffle"></i>
                    </div>
                    <h3 class="text-lg font-bold text-brand-900 dark:text-white mb-2">Why "Stochastic"?</h3>
                    <p class="text-sm text-neutral-600 dark:text-white/60 leading-relaxed mb-4">
                        "Stochastic" means random. In real AI, calculating the gradient for 1,000,000 images is slow.
                        Instead, we pick <strong>one random image</strong> (or a small batch), calculate the slope, and
                        move.
                    </p>
                    <div class="flex gap-2">
                        <span
                            class="text-xs bg-brand-500/20 text-brand-500 dark:text-brandlt-400 px-2 py-1 rounded">Fast</span>
                        <span
                            class="text-xs bg-brand-500/20 text-brand-500 dark:text-brandlt-400 px-2 py-1 rounded">Noisy</span>
                    </div>
                </div>

                <div class="glass-card p-6 rounded-2xl">
                    <div
                        class="w-12 h-12 rounded-full bg-brand-900/10 dark:bg-white/10 flex items-center justify-center mb-4 text-brand-900 dark:text-white">
                        <i data-lucide="mountain"></i>
                    </div>
                    <h3 class="text-lg font-bold text-brand-900 dark:text-white mb-2">Local Minima</h3>
                    <p class="text-sm text-neutral-600 dark:text-white/60 leading-relaxed">
                        Notice how the "noise" (drunkenness) actually helps? If the ball gets stuck in a small hole
                        (local minimum) that isn't the true bottom, the random jitter can shake it out so it keeps
                        finding the real bottom.
                    </p>
                </div>
            </div>
        </section>
    </main>

    <footer
        class="text-center py-12 text-neutral-500 dark:text-white/40 text-sm border-t border-black/5 dark:border-white/10">
        <p>Designed for Interactive Learning — Paper X Labs</p>
    </footer>

    <script>
        // Initialize Lucide Icons
        lucide.createIcons();

        // --- Theme Toggle ---
        const themeToggles = document.querySelectorAll('[data-theme-toggle]');
        themeToggles.forEach(btn => {
            btn.addEventListener('click', () => {
                const html = document.documentElement;
                const isDark = html.classList.toggle('dark');
                localStorage.setItem('px_theme', isDark ? 'dark' : 'light');
            });
        });

        // --- Simulation Variables ---
        const canvas = document.getElementById('sim-canvas');
        const ctx = canvas.getContext('2d');

        let width, height;
        let isRunning = false;

        // Simulation State
        const state = {
            x: 0,
            y: 0,
            lr: 0.05,
            noise: 20,
            steps: 0,
            history: []
        };

        // UI Elements
        const ui = {
            lrInput: document.getElementById('learning-rate'),
            lrDisplay: document.getElementById('lr-val'),
            noiseInput: document.getElementById('noise-level'),
            noiseDisplay: document.getElementById('noise-val'),
            startBtn: document.getElementById('btn-start'),
            resetBtn: document.getElementById('btn-reset'),
            statLoss: document.getElementById('stat-loss'),
            statSteps: document.getElementById('stat-steps'),
            successOverlay: document.getElementById('success-msg')
        };

        // --- Math & Physics Engine ---
        function getLoss(x, y) {
            const nx = (x - width / 2) / 100;
            const ny = (y - height / 2) / 100;
            return (nx * nx) + (0.5 * ny * ny);
        }

        function getGradient(x, y) {
            const nx = (x - width / 2) / 100;
            const ny = (y - height / 2) / 100;
            return {
                dx: 2 * nx,
                dy: 1 * ny
            };
        }

        // --- Drawing Functions ---
        function resize() {
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * window.devicePixelRatio;
            canvas.height = rect.height * window.devicePixelRatio;
            ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
            width = rect.width;
            height = rect.height;

            if (!isRunning && state.steps === 0) resetSimulation();
            else drawFrame();
        }

        function drawContourMap() {
            const isDark = document.documentElement.classList.contains('dark');
            for (let r = 0; r < Math.max(width, height); r += 40) {
                ctx.beginPath();
                ctx.ellipse(width / 2, height / 2, r, r * 1.4, 0, 0, Math.PI * 2);
                ctx.strokeStyle = isDark
                    ? `rgba(158, 75, 138, ${Math.max(0.05, 0.3 - r / 1000)})`
                    : `rgba(76, 42, 89, ${Math.max(0.05, 0.25 - r / 1000)})`;
                ctx.lineWidth = 1;
                ctx.stroke();
            }

            // Draw Target "X"
            ctx.beginPath();
            ctx.strokeStyle = '#9E4B8A';
            ctx.lineWidth = 2;
            const cx = width / 2, cy = height / 2;
            ctx.moveTo(cx - 10, cy); ctx.lineTo(cx + 10, cy);
            ctx.moveTo(cx, cy - 10); ctx.lineTo(cx, cy + 10);
            ctx.stroke();
        }

        function drawAgent() {
            // Draw Trail
            if (state.history.length > 1) {
                ctx.beginPath();
                ctx.moveTo(state.history[0].x, state.history[0].y);
                for (let i = 1; i < state.history.length; i++) {
                    ctx.lineTo(state.history[i].x, state.history[i].y);
                }
                ctx.strokeStyle = 'rgba(158, 75, 138, 0.3)';
                ctx.lineWidth = 2;
                ctx.stroke();
            }

            // Draw current point (The Ball)
            ctx.beginPath();
            ctx.arc(state.x, state.y, 8, 0, Math.PI * 2);
            ctx.fillStyle = '#10b981';
            ctx.shadowBlur = 15;
            ctx.shadowColor = '#10b981';
            ctx.fill();
            ctx.shadowBlur = 0;

            // Draw Gradient Arrow (if running)
            if (isRunning) {
                const grad = getGradient(state.x, state.y);
                const dirX = -grad.dx;
                const dirY = -grad.dy;
                const noiseScale = state.noise * 2;
                const noisyX = dirX * 50 + (Math.random() - 0.5) * noiseScale;
                const noisyY = dirY * 50 + (Math.random() - 0.5) * noiseScale;

                ctx.beginPath();
                ctx.moveTo(state.x, state.y);
                ctx.lineTo(state.x + noisyX, state.y + noisyY);
                ctx.strokeStyle = '#f87171';
                ctx.lineWidth = 2;
                ctx.stroke();
            }
        }

        function drawFrame() {
            const isDark = document.documentElement.classList.contains('dark');
            ctx.fillStyle = isDark ? '#1E1E2F' : '#FAF5FB';
            ctx.fillRect(0, 0, width, height);
            drawContourMap();
            drawAgent();
        }

        // --- Simulation Logic ---
        function updatePhysics() {
            if (!isRunning) return;

            const grad = getGradient(state.x, state.y);
            const noiseX = (Math.random() - 0.5) * state.noise;
            const noiseY = (Math.random() - 0.5) * state.noise;

            const moveX = (grad.dx * 100 + noiseX) * state.lr;
            const moveY = (grad.dy * 100 + noiseY) * state.lr;

            gsap.to(state, {
                x: state.x - moveX,
                y: state.y - moveY,
                duration: 0.2,
                ease: "power1.out",
                onUpdate: () => {
                    state.x = Math.max(0, Math.min(width, state.x));
                    state.y = Math.max(0, Math.min(height, state.y));
                },
                onComplete: () => {
                    state.history.push({ x: state.x, y: state.y });
                    if (state.history.length > 50) state.history.shift();

                    state.steps++;
                    updateUI();

                    const dist = Math.hypot(state.x - width / 2, state.y - height / 2);
                    if (dist < 10) {
                        isRunning = false;
                        ui.successOverlay.style.opacity = '1';
                        ui.startBtn.innerHTML = '<i data-lucide="play" class="w-4 h-4"></i> Start';
                        lucide.createIcons();
                    } else if (isRunning) {
                        updatePhysics();
                    }
                }
            });
        }

        function updateUI() {
            const currentLoss = getLoss(state.x, state.y);
            ui.statLoss.textContent = currentLoss.toFixed(4);
            ui.statSteps.textContent = state.steps;
        }

        function resetSimulation() {
            gsap.killTweensOf(state);
            isRunning = false;
            ui.startBtn.innerHTML = '<i data-lucide="play" class="w-4 h-4"></i> Start';
            ui.successOverlay.style.opacity = '0';

            const angle = Math.random() * Math.PI * 2;
            const radius = Math.min(width, height) * 0.35;
            state.x = (width / 2) + Math.cos(angle) * radius;
            state.y = (height / 2) + Math.sin(angle) * radius;

            state.steps = 0;
            state.history = [{ x: state.x, y: state.y }];

            updateUI();
            drawFrame();
            lucide.createIcons();
        }

        // --- Event Listeners ---
        ui.startBtn.addEventListener('click', () => {
            if (isRunning) {
                isRunning = false;
                ui.startBtn.innerHTML = '<i data-lucide="play" class="w-4 h-4"></i> Resume';
            } else {
                isRunning = true;
                ui.startBtn.innerHTML = '<i data-lucide="pause" class="w-4 h-4"></i> Pause';
                ui.successOverlay.style.opacity = '0';
                updatePhysics();
            }
            lucide.createIcons();
        });

        ui.resetBtn.addEventListener('click', resetSimulation);

        ui.lrInput.addEventListener('input', (e) => {
            state.lr = parseFloat(e.target.value);
            ui.lrDisplay.textContent = state.lr.toFixed(3);
        });

        ui.noiseInput.addEventListener('input', (e) => {
            state.noise = parseInt(e.target.value);
            ui.noiseDisplay.textContent = state.noise === 0 ? "None" : (state.noise < 20 ? "Low" : (state.noise < 35 ? "Medium" : "High"));
        });

        function animate() {
            drawFrame();
            requestAnimationFrame(animate);
        }

        // Init
        window.addEventListener('resize', resize);
        resize();
        animate();
    </script>
</body>

</html>