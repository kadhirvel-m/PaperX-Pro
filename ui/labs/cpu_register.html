<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CPU Registers Lab — Paper X</title>
    <link rel="icon" type="image/x-icon" href="../assets/img/favicon.svg">

    <!-- Inter + Material Symbols -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,600,0,0"
        rel="stylesheet">

    <!-- Tailwind CSS bundle used across Paper X -->
    <link rel="stylesheet" href="../assets/css/tailwind.css" />

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                container: { center: true, padding: '1rem' },
                extend: {
                    fontFamily: { sans: ['Inter', 'ui-sans-serif', 'system-ui', 'sans-serif'] },
                    colors: {
                        brand: { 900: '#1E1E2F', 700: '#4C2A59', 500: '#9E4B8A' },
                        brandlt: {
                            50: '#FAF5FB',
                            100: '#F3E7F2',
                            200: '#E7D0E4',
                            300: '#D9B4D3',
                            400: '#C88DBA',
                            500: '#9E4B8A',
                            700: '#4C2A59',
                            900: '#1E1E2F'
                        },
                        cyber: {
                            dark: '#1E1E2F',
                            panel: '#201934',
                            accent: '#9E4B8A',
                            glow: '#C88DBA',
                            success: '#10b981',
                            text: '#F3E7F2'
                        }
                    },
                    boxShadow: {
                        glow: '0 8px 30px rgba(158,75,138,0.35)',
                        soft: '0 10px 30px rgba(0,0,0,0.25)',
                        card: '0 24px 60px rgba(30,30,47,0.35)'
                    },
                    backgroundImage: {
                        'hero-dark': 'radial-gradient(900px 520px at 50% -15%, rgba(158,75,138,0.35), transparent 65%), linear-gradient(180deg,#1E1E2F 0%,#201934 55%,#141321 100%)',
                        'hero-light': 'radial-gradient(1000px 560px at 50% -18%, rgba(158,75,138,0.18), transparent 62%), linear-gradient(180deg,#FFFFFF 0%,#FBF8FC 55%,#F7F2F9 100%)'
                    }
                }
            }
        }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        :root {
            --bg-app: #F7F2F9;
            --bg-card: #FFFFFF;
            --text-head: #1E1E2F;
            --text-body: #2F2F3A;
            --text-sub: #5A5A6B;
            --border: #E5DFEC;
            --accent: #9E4B8A;
            --accent-light: #C88DBA;
        }

        .dark {
            --bg-app: #1E1E2F;
            --bg-card: #201934;
            --text-head: #F3E7F2;
            --text-body: #E8E3EE;
            --text-sub: #C9BED5;
            --border: #3A3247;
            --accent: #C88DBA;
            --accent-light: #D9B4D3;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
        }

        .lab-shell {
            min-height: 100vh;
            background-image: linear-gradient(180deg, #FFFFFF 0%, #FBF8FC 45%, #F7F2F9 100%);
        }

        .dark .lab-shell {
            background-image: linear-gradient(180deg, #1E1E2F 0%, #201934 55%, #141321 100%);
        }

        /* --- GLASS PANEL --- */
        .glass-panel {
            background: linear-gradient(145deg, rgba(255, 255, 255, 0.9), rgba(243, 231, 242, 0.95));
            backdrop-filter: blur(12px);
            border: 1px solid rgba(158, 75, 138, 0.16);
            box-shadow: 0 18px 40px -18px rgba(30, 30, 47, 0.35);
            border-radius: 1rem;
        }

        .dark .glass-panel {
            background: linear-gradient(145deg, rgba(30, 30, 47, 0.96), rgba(30, 30, 47, 0.86));
            border-color: rgba(200, 141, 186, 0.35);
            box-shadow: 0 22px 60px -20px rgba(0, 0, 0, 0.8);
        }

        /* --- REGISTER SLOT --- */
        .register-slot {
            transition: all 0.3s ease;
            background: var(--bg-card);
            border: 1px solid var(--border);
        }

        .register-slot.active {
            border-color: var(--accent);
            box-shadow: 0 0 15px rgba(158, 75, 138, 0.3);
        }

        /* --- DATA PACKET --- */
        .data-packet {
            position: absolute;
            width: 30px;
            height: 30px;
            background: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 12px;
            opacity: 0;
            z-index: 50;
            pointer-events: none;
        }

        /* --- ALU PULSE --- */
        .alu-pulse {
            animation: pulse-brand 0.5s ease-in-out;
        }

        @keyframes pulse-brand {
            0% {
                box-shadow: 0 0 0 0 rgba(158, 75, 138, 0.7);
                border-color: #9E4B8A;
            }

            70% {
                box-shadow: 0 0 0 20px rgba(158, 75, 138, 0);
            }

            100% {
                box-shadow: 0 0 0 0 rgba(158, 75, 138, 0);
            }
        }

        /* --- RAM SLOT --- */
        .ram-slot {
            background: var(--bg-card);
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        /* --- INSTRUCTION BUTTONS --- */
        .instruction-btn {
            background: var(--bg-card);
            border: 1px solid var(--border);
            transition: all 0.2s ease;
        }

        .instruction-btn:hover {
            border-color: var(--accent);
            background: rgba(158, 75, 138, 0.05);
        }

        .dark .instruction-btn:hover {
            background: rgba(158, 75, 138, 0.15);
        }

        /* --- INFO CARDS --- */
        .info-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 1rem;
            transition: all 0.3s ease;
        }

        .info-card:hover {
            border-color: var(--accent);
        }

        /* --- SPEED BARS --- */
        .speed-bar {
            background: var(--border);
        }

        .speed-bar-fill {
            background: linear-gradient(90deg, #9E4B8A, #C88DBA);
        }
    </style>

    <!-- Persist theme before paint -->
    <script>
            (function () {
                try {
                    const s = localStorage.getItem('px_theme');
                    const prefers = window.matchMedia('(prefers-color-scheme: dark)').matches;
                    const useDark = s ? s === 'dark' : prefers;
                    if (useDark) document.documentElement.classList.add('dark');
                } catch (_) { }
            })();
    </script>
    <script src="../config.js"></script>
</head>

<body class="min-h-screen font-sans antialiased text-neutral-900 dark:text-white bg-hero-light dark:bg-hero-dark">

    <!-- ============== NAVBAR (Paper X) ============== -->
    <header
        class="sticky top-0 z-50 bg-white/80 dark:bg-brand-900/70 backdrop-blur supports-[backdrop-filter]:saturate-150 border-b border-black/5 dark:border-white/10">
        <div class="container flex items-center justify-between py-3.5">
            <a href="../index.html" class="flex items-center gap-3 shrink-0" aria-label="Paper X Home">
                <img src="../assets/img/logo-light.svg" class="h-9 w-auto dark:hidden" alt="Paper X" />
                <img src="../assets/img/logo-dark.svg" class="h-9 w-auto hidden dark:block" alt="Paper X" />
            </a>
            <nav class="hidden md:flex items-center gap-6 text-sm text-neutral-700 dark:text-white/85">
                <a href="../index.html" class="hover:text-brandlt-900 dark:hover:text-white">Home</a>
                <a href="../about.html" class="hover:text-brandlt-900 dark:hover:text-white">About</a>
                <a href="../academicas.html" class="hover:text-brandlt-900 dark:hover:text-white">Academics</a>
                <a href="../contact.html" class="hover:text-brandlt-900 dark:hover:text-white">Support</a>
            </nav>
            <div class="hidden md:flex items-center gap-2">
                <button data-theme-toggle
                    class="inline-flex items-center gap-2 rounded-full px-3 py-2 text-sm ring-1 ring-black/10 dark:ring-white/15 hover:bg-black/5 dark:hover:bg-white/5"
                    aria-label="Toggle theme">
                    <span class="material-symbols-rounded">dark_mode</span>
                    <span class="hidden lg:block">Theme</span>
                </button>
                <a href="../login.html"
                    class="px-3 py-2 text-sm text-neutral-700 dark:text-white/80 hover:text-brandlt-900 dark:hover:text-white rounded-full">Log
                    in</a>
                <a href="../signup.html"
                    class="inline-flex items-center justify-center rounded-full bg-brand-500 text-white text-sm font-semibold px-4 py-2.5 hover:shadow-glow transition">Sign
                    up</a>
            </div>
            <div class="md:hidden flex items-center gap-2">
                <button type="button" data-theme-toggle aria-label="Toggle theme"
                    class="inline-flex items-center justify-center size-10 rounded-full ring-1 ring-black/10 dark:ring-white/15 hover:bg-black/5 dark:hover:bg-white/5 transition">
                    <span class="material-symbols-rounded">dark_mode</span>
                </button>
            </div>
        </div>
    </header>

    <main class="lab-shell pb-10">

        <!-- ============== HERO SECTION ============== -->
        <section class="pt-8 pb-6">
            <div class="container max-w-4xl mx-auto px-4">
                <div class="flex items-start gap-6 mb-6">
                    <div class="p-4 bg-brand-500/10 dark:bg-brand-500/20 rounded-2xl border border-brand-500/20">
                        <i data-lucide="chef-hat" class="w-12 h-12 text-brand-500 dark:text-brand-400"></i>
                    </div>
                    <div>
                        <h1 class="text-3xl md:text-4xl font-bold tracking-tight text-brand-900 dark:text-white mb-2">
                            The Chef's Cutting Board
                        </h1>
                        <p class="text-lg text-neutral-600 dark:text-white/70">
                            Understanding CPU Registers through a Kitchen Analogy
                        </p>
                    </div>
                </div>

                <div class="hidden sm:flex flex-wrap gap-2 text-xs text-neutral-500 dark:text-white/60">
                    <span
                        class="inline-flex items-center gap-1 rounded-full border border-black/5 dark:border-white/10 px-3 py-1">
                        <span class="material-symbols-rounded text-base">bolt</span>
                        Interactive Simulation
                    </span>
                    <span
                        class="inline-flex items-center gap-1 rounded-full border border-black/5 dark:border-white/10 px-3 py-1">
                        <span class="material-symbols-rounded text-base">memory</span>
                        CPU Architecture
                    </span>
                </div>
            </div>
        </section>

        <!-- ============== ANALOGY SECTION ============== -->
        <section class="pb-8">
            <div class="container max-w-4xl mx-auto px-4">
                <div class="glass-panel p-6 md:p-8">
                    <p class="text-xl font-light leading-relaxed text-neutral-700 dark:text-white/90 mb-4">
                        Imagine a professional kitchen.
                    </p>
                    <p class="text-neutral-600 dark:text-white/70 mb-4">
                        The <strong class="text-brand-700 dark:text-brand-400">Pantry (RAM)</strong> is huge. It holds
                        every ingredient you own, but it's across the room.
                        The <strong class="text-brand-700 dark:text-brand-400">Cutting Board (Register)</strong> is
                        right in front of you. It's tiny—it can only hold two
                        or three onions at once.
                    </p>
                    <p
                        class="border-l-4 border-brand-500 pl-6 italic text-neutral-600 dark:text-white/70 bg-brand-500/5 dark:bg-brand-500/10 py-3 rounded-r-lg mb-4">
                        You cannot chop an onion while it is inside the pantry.
                    </p>
                    <p class="text-neutral-600 dark:text-white/70">
                        You <strong class="text-brand-700 dark:text-brand-400">must</strong> fetch it, place it on the
                        <strong class="text-brand-700 dark:text-brand-400">Cutting Board</strong>, chop it (process
                        it), and then put it back.
                        A CPU works exactly the same way. It cannot add two numbers sitting in RAM. It must load them
                        into
                        <strong class="text-brand-700 dark:text-brand-400">Registers</strong> first.
                    </p>
                </div>
            </div>
        </section>

        <!-- ============== CPU SIMULATOR ============== -->
        <section class="pb-12">
            <div class="container max-w-6xl mx-auto px-4">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold flex items-center gap-2 text-brand-900 dark:text-white">
                        <i data-lucide="cpu" class="text-brand-500 dark:text-brand-400"></i>
                        CPU Simulator
                        <span
                            class="text-xs font-mono bg-brand-500/10 dark:bg-brand-500/20 px-2 py-1 rounded text-brand-600 dark:text-brand-300">v1.0</span>
                    </h2>
                    <div class="text-sm text-neutral-500 dark:text-white/60 font-mono">
                        Status: <span id="status-text" class="text-brand-500 dark:text-brand-400">IDLE</span>
                    </div>
                </div>

                <div class="glass-panel p-4 md:p-8 relative overflow-hidden">
                    <div id="flying-packet" class="data-packet">0</div>

                    <div class="flex flex-col lg:flex-row gap-6 relative">

                        <!-- RAM COLUMN -->
                        <div class="lg:w-[180px] shrink-0 space-y-4 z-10">
                            <div class="flex items-center justify-between">
                                <h3 class="font-mono text-neutral-500 dark:text-white/60 text-sm">RAM (MEMORY)</h3>
                                <i data-lucide="database" class="w-4 h-4 text-neutral-400 dark:text-white/40"></i>
                            </div>
                            <div class="grid grid-cols-1 gap-2" id="ram-container">
                            </div>
                        </div>

                        <!-- INSTRUCTION SET COLUMN -->
                        <div class="flex-1 flex flex-col justify-center space-y-6 z-10 min-w-[280px]">

                            <!-- Bus Activity Bar -->
                            <div
                                class="h-2 w-full bg-brand-500/10 dark:bg-brand-500/20 rounded-full relative overflow-hidden">
                                <div class="absolute inset-0 bg-gradient-to-r from-transparent via-brand-500/50 to-transparent w-1/2 translate-x-[-100%]"
                                    id="bus-activity"></div>
                            </div>

                            <div class="glass-panel p-6 space-y-4">
                                <h4
                                    class="text-xs font-bold uppercase tracking-wider text-neutral-500 dark:text-white/60 mb-2">
                                    Instruction Set
                                </h4>

                                <div class="space-y-3">
                                    <button onclick="sim.load(0, 'AX')" id="btn-load-ax"
                                        class="instruction-btn w-full flex items-center justify-between p-3 rounded-lg transition-all group disabled:opacity-50">
                                        <span class="font-mono text-sm text-brand-600 dark:text-brand-400">MOV AX, [addr
                                            0]</span>
                                        <span
                                            class="text-xs text-neutral-500 dark:text-white/60 group-hover:text-brand-500">Fetch
                                            1st number</span>
                                    </button>

                                    <button onclick="sim.load(1, 'BX')" id="btn-load-bx"
                                        class="instruction-btn w-full flex items-center justify-between p-3 rounded-lg transition-all group disabled:opacity-50">
                                        <span class="font-mono text-sm text-brand-600 dark:text-brand-400">MOV BX, [addr
                                            1]</span>
                                        <span
                                            class="text-xs text-neutral-500 dark:text-white/60 group-hover:text-brand-500">Fetch
                                            2nd number</span>
                                    </button>

                                    <button onclick="sim.add()" id="btn-add"
                                        class="instruction-btn w-full flex items-center justify-between p-3 rounded-lg transition-all group disabled:opacity-50">
                                        <span class="font-mono text-sm text-brand-500 dark:text-brand-300">ADD AX,
                                            BX</span>
                                        <span
                                            class="text-xs text-neutral-500 dark:text-white/60 group-hover:text-brand-500">Calculate</span>
                                    </button>

                                    <button onclick="sim.store('AX', 2)" id="btn-store"
                                        class="instruction-btn w-full flex items-center justify-between p-3 rounded-lg transition-all group disabled:opacity-50">
                                        <span class="font-mono text-sm text-amber-600 dark:text-amber-400">MOV [addr 2],
                                            AX</span>
                                        <span
                                            class="text-xs text-neutral-500 dark:text-white/60 group-hover:text-brand-500">Save
                                            Result</span>
                                    </button>

                                    <button onclick="sim.reset()"
                                        class="w-full p-2 mt-4 text-xs text-neutral-500 dark:text-white/60 hover:text-brand-500 dark:hover:text-brand-400 border border-transparent hover:border-brand-500/30 rounded-lg transition">
                                        RESET SYSTEM
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- CPU CORE COLUMN -->
                        <div class="lg:w-[280px] shrink-0 glass-panel p-6 relative z-10">
                            <div
                                class="absolute -top-3 left-6 bg-brand-500 px-3 py-1 text-xs font-bold text-white rounded-full">
                                CPU CORE
                            </div>

                            <div class="space-y-6 mt-4">
                                <div class="space-y-3">
                                    <div
                                        class="flex items-center justify-between text-xs text-neutral-500 dark:text-white/60 font-mono mb-1">
                                        <span>REGISTERS</span>
                                    </div>

                                    <div id="reg-AX"
                                        class="register-slot p-4 rounded-lg flex justify-between items-center">
                                        <span class="text-brand-500 dark:text-brand-400 font-mono font-bold">AX</span>
                                        <span class="value font-mono text-xl text-brand-900 dark:text-white">0</span>
                                    </div>

                                    <div id="reg-BX"
                                        class="register-slot p-4 rounded-lg flex justify-between items-center">
                                        <span class="text-brand-500 dark:text-brand-400 font-mono font-bold">BX</span>
                                        <span class="value font-mono text-xl text-brand-900 dark:text-white">0</span>
                                    </div>
                                </div>

                                <div id="alu"
                                    class="register-slot rounded-lg p-4 flex flex-col items-center justify-center gap-2 transition-all duration-300">
                                    <i data-lucide="calculator"
                                        class="w-6 h-6 text-brand-500 dark:text-brand-400 mb-1"></i>
                                    <span class="text-xs font-bold text-neutral-600 dark:text-white/80">ALU</span>
                                    <span
                                        class="text-[10px] text-neutral-500 dark:text-white/60 text-center leading-tight">Arithmetic
                                        Logic
                                        Unit</span>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>

                <p class="text-center mt-6 text-neutral-500 dark:text-white/60 text-sm">
                    Follow the buttons from top to bottom to perform a calculation cycle.
                </p>
            </div>
        </section>

        <!-- ============== UNDER THE HOOD ============== -->
        <section class="pb-16">
            <div class="container max-w-4xl mx-auto px-4">
                <h2 class="text-3xl font-bold mb-8 text-brand-900 dark:text-white">Under the Hood</h2>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

                    <div class="info-card p-6">
                        <div class="flex items-start justify-between mb-4">
                            <h3 class="font-bold text-lg text-brand-900 dark:text-white">General Purpose Registers</h3>
                            <span
                                class="text-xs bg-brand-500/10 dark:bg-brand-500/20 text-brand-600 dark:text-brand-300 px-2 py-1 rounded-full">x86
                                Arch</span>
                        </div>
                        <ul class="space-y-3 text-neutral-600 dark:text-white/70 text-sm">
                            <li class="flex gap-3">
                                <span class="font-mono text-brand-500 dark:text-brand-400 font-bold">AX</span>
                                <span>(Accumulator): Used for arithmetic & logic. The "main" work zone.</span>
                            </li>
                            <li class="flex gap-3">
                                <span class="font-mono text-brand-500 dark:text-brand-400 font-bold">BX</span>
                                <span>(Base): Often used as a pointer to data.</span>
                            </li>
                            <li class="flex gap-3">
                                <span class="font-mono text-brand-500 dark:text-brand-400 font-bold">CX</span>
                                <span>(Counter): Used for loops (like `for` loops).</span>
                            </li>
                            <li class="flex gap-3">
                                <span class="font-mono text-brand-500 dark:text-brand-400 font-bold">DX</span>
                                <span>(Data): Used for I/O operations and large numbers.</span>
                            </li>
                        </ul>
                    </div>

                    <div class="info-card p-6">
                        <div class="flex items-start justify-between mb-4">
                            <h3 class="font-bold text-lg text-brand-900 dark:text-white">The Speed Gap</h3>
                            <i data-lucide="zap" class="w-5 h-5 text-brand-500 dark:text-brand-400"></i>
                        </div>
                        <div class="space-y-4">
                            <div>
                                <div class="flex justify-between text-xs text-neutral-500 dark:text-white/60 mb-1">
                                    <span>Register Access</span>
                                    <span class="text-emerald-600 dark:text-emerald-400">~0.3 ns</span>
                                </div>
                                <div class="speed-bar w-full rounded-full h-2">
                                    <div class="speed-bar-fill h-2 rounded-full" style="width: 1%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-xs text-neutral-500 dark:text-white/60 mb-1">
                                    <span>L1 Cache</span>
                                    <span>~1 ns</span>
                                </div>
                                <div class="speed-bar w-full rounded-full h-2">
                                    <div class="speed-bar-fill h-2 rounded-full opacity-70" style="width: 5%"></div>
                                </div>
                            </div>
                            <div>
                                <div class="flex justify-between text-xs text-neutral-500 dark:text-white/60 mb-1">
                                    <span>RAM (Main Memory)</span>
                                    <span class="text-red-500 dark:text-red-400">~100 ns</span>
                                </div>
                                <div class="speed-bar w-full rounded-full h-2">
                                    <div class="bg-neutral-400 dark:bg-neutral-500 h-2 rounded-full"
                                        style="width: 100%"></div>
                                </div>
                            </div>
                        </div>
                        <p class="mt-4 text-xs text-neutral-500 dark:text-white/60">
                            Accessing RAM is roughly 300x slower than a Register. This is why CPUs try to keep active
                            data in registers or cache.
                        </p>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- ============== FOOTER ============== -->
    <footer class="border-t border-black/5 dark:border-white/10 py-8">
        <div class="container text-center">
            <p class="text-neutral-500 dark:text-white/60 text-sm">
                Built with ❤️ for Paper X — GSAP & Tailwind
            </p>
        </div>
    </footer>

    <script>
        // Initialize Icons
        lucide.createIcons();

        // --- SIMULATOR STATE ---
        const simulatorState = {
            ram: [5, 3, 0, 0, 0], // Address 0..4
            registers: { AX: 0, BX: 0 },
            isAnimating: false
        };

        // --- DOM ELEMENTS ---
        const ramContainer = document.getElementById('ram-container');
        const regAXEl = document.getElementById('reg-AX');
        const regBXEl = document.getElementById('reg-BX');
        const packetEl = document.getElementById('flying-packet');
        const statusEl = document.getElementById('status-text');
        const aluEl = document.getElementById('alu');

        // --- INITIALIZATION ---
        function initRAM() {
            ramContainer.innerHTML = '';
            simulatorState.ram.forEach((val, index) => {
                const el = document.createElement('div');
                el.className = `ram-slot p-3 rounded-lg flex justify-between items-center id-ram-${index}`;
                el.innerHTML = `
                    <span class="text-xs text-neutral-500 dark:text-white/60 font-mono">0x${index}</span>
                    <span class="font-mono text-brand-600 dark:text-brand-400 font-bold value">${val}</span>
                `;
                ramContainer.appendChild(el);
            });
        }

        // --- CORE ANIMATION FUNCTIONS ---

        function updateUI() {
            // Update Register UI
            regAXEl.querySelector('.value').innerText = simulatorState.registers.AX;
            regBXEl.querySelector('.value').innerText = simulatorState.registers.BX;

            // Update RAM UI
            const ramSlots = document.querySelectorAll('.ram-slot .value');
            ramSlots.forEach((slot, i) => {
                slot.innerText = simulatorState.ram[i];
            });
        }

        const sim = {

            // 1. LOAD: Moves data from RAM -> Register
            load: (addr, regName) => {
                if (simulatorState.isAnimating) return;
                simulatorState.isAnimating = true;
                statusEl.innerText = `FETCHING FROM 0x${addr}...`;

                // Get Coordinates
                const sourceEl = document.querySelector(`.id-ram-${addr}`);
                const targetEl = document.getElementById(`reg-${regName}`);

                const start = sourceEl.getBoundingClientRect();
                const end = targetEl.getBoundingClientRect();

                // Highlight Source
                gsap.to(sourceEl, { borderColor: '#9E4B8A', duration: 0.2 });

                // Prepare Packet
                packetEl.innerText = simulatorState.ram[addr];

                // Animate Packet
                const tl = gsap.timeline({
                    onComplete: () => {
                        // Logic Update
                        simulatorState.registers[regName] = simulatorState.ram[addr];
                        updateUI();

                        // Highlight Target
                        gsap.fromTo(targetEl,
                            { borderColor: '#9E4B8A', boxShadow: '0 0 20px rgba(158, 75, 138, 0.5)' },
                            { borderColor: 'var(--border)', boxShadow: 'none', duration: 1 }
                        );

                        // Reset Source
                        gsap.to(sourceEl, { borderColor: 'var(--border)', duration: 0.5 });

                        simulatorState.isAnimating = false;
                        statusEl.innerText = 'IDLE';
                    }
                });

                tl.set(packetEl, { x: start.left + start.width / 2 - 15, y: start.top + window.scrollY + start.height / 2 - 15, opacity: 1, scale: 0.5 })
                    .to(packetEl, { scale: 1.2, duration: 0.2 }) // Pop out
                    .to(packetEl, { x: end.left + end.width / 2 - 15, y: end.top + window.scrollY + end.height / 2 - 15, duration: 1.5, ease: "power2.inOut" }) // Fly
                    .to(packetEl, { scale: 0, opacity: 0, duration: 0.2 }); // Absorb
            },

            // 2. ADD: Combines AX and BX in the ALU
            add: () => {
                if (simulatorState.isAnimating) return;
                if (simulatorState.registers.AX === 0 && simulatorState.registers.BX === 0) {
                    alert("Load some data first!");
                    return;
                }
                simulatorState.isAnimating = true;
                statusEl.innerText = 'CALCULATING...';

                // Visualize ALU Activity
                aluEl.style.borderColor = '#9E4B8A';
                aluEl.style.boxShadow = '0 0 30px rgba(158, 75, 138, 0.3)';

                const tl = gsap.timeline({
                    onComplete: () => {
                        const result = simulatorState.registers.AX + simulatorState.registers.BX;
                        simulatorState.registers.AX = result;
                        updateUI();

                        // Flash AX to show result landed there
                        gsap.fromTo(regAXEl,
                            { backgroundColor: 'rgba(158, 75, 138, 0.2)' },
                            { backgroundColor: 'var(--bg-card)', duration: 1 }
                        );

                        aluEl.style.borderColor = '';
                        aluEl.style.boxShadow = '';
                        simulatorState.isAnimating = false;
                        statusEl.innerText = 'IDLE';
                    }
                });

                // Animate numbers "sucking" into ALU (Conceptual)
                tl.to([regAXEl, regBXEl], { x: 10, duration: 0.1, yoyo: true, repeat: 3 })
                    .to(aluEl, { scale: 1.1, duration: 0.2 })
                    .to(aluEl, { scale: 1.0, duration: 0.2, delay: 0.5 });
            },

            // 3. STORE: Moves data from AX -> RAM
            store: (regName, addr) => {
                if (simulatorState.isAnimating) return;
                simulatorState.isAnimating = true;
                statusEl.innerText = `STORING TO 0x${addr}...`;

                const sourceEl = document.getElementById(`reg-${regName}`);
                const targetEl = document.querySelector(`.id-ram-${addr}`);

                const start = sourceEl.getBoundingClientRect();
                const end = targetEl.getBoundingClientRect();

                // Prepare Packet (Color change for STORE)
                packetEl.innerText = simulatorState.registers[regName];
                packetEl.style.backgroundColor = '#f59e0b'; // Amber
                packetEl.style.color = 'white';

                const tl = gsap.timeline({
                    onComplete: () => {
                        simulatorState.ram[addr] = simulatorState.registers[regName];
                        updateUI();

                        // Highlight RAM slot
                        gsap.fromTo(targetEl,
                            { borderColor: '#f59e0b', backgroundColor: 'rgba(245, 158, 11, 0.1)' },
                            { borderColor: 'var(--border)', backgroundColor: 'var(--bg-card)', duration: 1 }
                        );

                        // Reset packet style
                        packetEl.style.backgroundColor = '#9E4B8A';

                        simulatorState.isAnimating = false;
                        statusEl.innerText = 'IDLE';
                    }
                });

                tl.set(packetEl, { x: start.left + start.width / 2 - 15, y: start.top + window.scrollY + start.height / 2 - 15, opacity: 1, scale: 0.5 })
                    .to(packetEl, { scale: 1.2, duration: 0.2 })
                    .to(packetEl, { x: end.left + end.width / 2 - 15, y: end.top + window.scrollY + end.height / 2 - 15, duration: 1.5, ease: "power2.inOut" })
                    .to(packetEl, { scale: 0, opacity: 0, duration: 0.2 });
            },

            reset: () => {
                simulatorState.ram = [5, 3, 0, 0, 0];
                simulatorState.registers = { AX: 0, BX: 0 };
                updateUI();
                statusEl.innerText = 'SYSTEM RESET';
                setTimeout(() => statusEl.innerText = 'IDLE', 1000);
            }
        };

        // Initialize
        initRAM();
        updateUI();

        // Shared Paper X theme toggle wiring
        const themeToggles = document.querySelectorAll('[data-theme-toggle]');
        const root = document.documentElement;

        themeToggles.forEach(btn => {
            btn.addEventListener('click', () => {
                const isDark = root.classList.toggle('dark');
                try { localStorage.setItem('px_theme', isDark ? 'dark' : 'light'); } catch (_) { }
            });
        });

    </script>
</body>

</html>