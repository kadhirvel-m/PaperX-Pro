<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Paper X — Project Postings</title>
  <meta name="description" content="Browse all collaborative project postings from the Paper X community." />
  <link rel="icon" type="image/x-icon" href="../assets/img/favicon.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,600,0,0"
    rel="stylesheet">
  <link rel="stylesheet" href="../assets/css/tailwind.css" />
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        container: { center: true, padding: '1rem' },
        extend: {
          fontFamily: { sans: ['Inter', 'ui-sans-serif', 'system-ui', 'sans-serif'] },
          colors: {
            brand: { 900: '#1E1E2F', 700: '#4C2A59', 500: '#9E4B8A' },
            brandlt: { 50: '#FAF5FB', 100: '#F3E7F2', 200: '#E7D0E4', 300: '#D9B4D3', 400: '#C88DBA', 500: '#9E4B8A', 700: '#4C2A59', 900: '#1E1E2F' },
            ink: '#1E1E2F', plum: '#4C2A59', orchid: '#9E4B8A'
          },
          boxShadow: { glow: '0 8px 30px rgba(158,75,138,0.35)', soft: '0 20px 44px rgba(30,30,47,0.18)' },
          backgroundImage: {
            'hero-light': 'radial-gradient(1000px 600px at 50% -10%, rgba(158,75,138,0.18), transparent 60%), linear-gradient(180deg,#FFFFFF 0%,#FBF8FC 45%,#F7F2F9 100%)',
            'hero-dark': 'radial-gradient(1000px 600px at 50% -10%, rgba(158,75,138,0.28), transparent 60%), linear-gradient(180deg,#1E1E2F 0%,#201934 35%,#141321 100%)'
          }
        }
      }
    }
  </script>
  <style>
    .material-symbols-rounded {
      vertical-align: -6px;
    }

    .lift {
      transition: transform .28s cubic-bezier(.4, .2, .2, 1), box-shadow .28s ease;
    }

    .lift:hover {
      transform: translateY(-4px);
      box-shadow: 0 14px 34px -6px rgba(158, 75, 138, 0.35);
    }

    .gradient-hero-text {
      background-image: linear-gradient(90deg, #1E1E2F, #4C2A59, #9E4B8A, #4C2A59, #1E1E2F);
      background-size: 200% 200%;
      animation: gradient-shift 6s ease-in-out infinite;
      color: transparent;
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent
    }

    .dark .gradient-hero-text {
      background-image: linear-gradient(90deg, #EFA3DC, #CA6CB3, #FFFFFF, #CA6CB3, #EFA3DC)
    }

    @keyframes gradient-shift {
      0% {
        background-position: 0% 50%
      }

      50% {
        background-position: 100% 50%
      }

      100% {
        background-position: 0% 50%
      }
    }
  </style>
  <script>
      (() => { const stored = localStorage.getItem('px_theme'); const prefers = window.matchMedia('(prefers-color-scheme: dark)').matches; const dark = stored ? stored === 'dark' : prefers; if (dark) document.documentElement.classList.add('dark'); })();
  </script>
  <script src="../config.js" defer></script>
  <script src="../collage/helpers.js" defer></script>
</head>

<body
  class="min-h-screen font-sans antialiased text-neutral-900 dark:text-white bg-hero-light dark:bg-hero-dark transition-colors">
  <header
    class="sticky top-0 z-40 bg-white/70 dark:bg-brand-900/60 backdrop-blur supports-[backdrop-filter]:saturate-150 border-b border-black/5 dark:border-white/10 relative">
    <div class="container flex items-center justify-between py-4">
      <a href="../index.html" class="flex items-center gap-3" aria-label="Paper X Home">
        <img src="../assets/img/logo-light.svg" alt="Paper X" class="h-10 w-auto dark:hidden">
        <img src="../assets/img/logo-dark.svg" alt="Paper X" class="h-10 w-auto hidden dark:block">
      </a>
      <nav class="hidden md:flex items-center gap-6 text-sm text-neutral-700 dark:text-white/85">
        <a class="hover:text-brandlt-900 dark:hover:text-white" href="../index.html">Home</a>
        <a class="hover:text-brandlt-900 dark:hover:text-white" href="../about.html">About</a>
        <button
          class="group inline-flex items-center gap-1 hover:text-brandlt-900 dark:hover:text-white transition">Products
          <span
            class="material-symbols-rounded text-base opacity-70 group-hover:opacity-100">expand_more</span></button>
        <div class="relative" id="navProjectsWrap">
          <button type="button" id="navProjectsBtn" aria-haspopup="true" aria-expanded="false"
            class="group inline-flex items-center gap-2 px-3 py-2 rounded-xl hover:bg-black/5 dark:hover:bg-white/10 transition focus:outline-none focus:ring-2 focus:ring-brand-500/50">
            <span
              class="material-symbols-rounded text-[18px] leading-none group-hover:scale-110 transition-transform">hub</span>
            <span class="font-medium">Project Portal</span>
            <span
              class="material-symbols-rounded text-base leading-none transition-transform duration-200 group-data-[open=true]:rotate-180"
              data-projects-caret>expand_more</span>
          </button>
          <div id="navProjectsMenu" role="menu" aria-label="Project Portal" tabindex="-1"
            class="invisible opacity-0 translate-y-1 absolute left-1/2 -translate-x-1/2 mt-2 w-72 rounded-2xl border border-black/10 dark:border-white/10 bg-white/95 dark:bg-brand-900/95 shadow-[0_8px_28px_-4px_rgba(30,30,47,0.35)] backdrop-blur-xl ring-1 ring-black/5 dark:ring-white/10 transition duration-150 ease-out data-[open=true]:visible data-[open=true]:opacity-100 data-[open=true]:translate-y-0">
            <div class="p-3 pb-2 border-b border-black/5 dark:border-white/10">
              <p class="text-[11px] uppercase tracking-wide font-semibold text-neutral-500 dark:text-white/40">Manage
              </p>
            </div>
            <ul class="py-1" data-menu-list>
              <li role="none"><a role="menuitem" href="postings.html" data-menu-item
                  class="flex items-start gap-3 px-4 py-2.5 text-sm hover:bg-black/5 dark:hover:bg-white/10 focus:bg-black/5 dark:focus:bg-white/10 outline-none rounded-xl group"><span
                    class="material-symbols-rounded text-[20px] text-brand-500 dark:text-white/80 group-hover:scale-110 transition-transform">folder_open</span><span
                    class="flex flex-col"><span class="font-medium">Project Postings</span><span
                      class="text-[11px] text-neutral-500 dark:text-white/40">Browse active listings</span></span></a>
              </li>
              <li role="none"><a role="menuitem" href="project_post.html" data-menu-item
                  class="flex items-start gap-3 px-4 py-2.5 text-sm hover:bg-black/5 dark:hover:bg-white/10 focus:bg-black/5 dark:focus:bg-white/10 outline-none rounded-xl group"><span
                    class="material-symbols-rounded text-[20px] text-brand-500 dark:text-white/80 group-hover:scale-110 transition-transform">add_circle</span><span
                    class="flex flex-col"><span class="font-medium">Create Project</span><span
                      class="text-[11px] text-neutral-500 dark:text-white/40">Publish a new
                      opportunity</span></span></a></li>
              <li role="none"><a role="menuitem" href="incoming_requests.html" data-menu-item
                  class="flex items-start gap-3 px-4 py-2.5 text-sm hover:bg-black/5 dark:hover:bg-white/10 focus:bg-black/5 dark:focus:bg-white/10 outline-none rounded-xl group"><span
                    class="material-symbols-rounded text-[20px] text-brand-500 dark:text-white/80 group-hover:scale-110 transition-transform">inbox</span><span
                    class="flex flex-col"><span class="font-medium">Incoming Requests</span><span
                      class="text-[11px] text-neutral-500 dark:text-white/40">Review collaborator
                      joins</span></span></a></li>
              <li role="none"><a role="menuitem" href="my_applications.html" data-menu-item
                  class="flex items-start gap-3 px-4 py-2.5 text-sm hover:bg-black/5 dark:hover:bg-white/10 focus:bg-black/5 dark:focus:bg-white/10 outline-none rounded-xl group"><span
                    class="material-symbols-rounded text-[20px] text-brand-500 dark:text-white/80 group-hover:scale-110 transition-transform">assignment_ind</span><span
                    class="flex flex-col"><span class="font-medium">My Applications</span><span
                      class="text-[11px] text-neutral-500 dark:text-white/40">Track application status</span></span></a>
              </li>
              <li role="none"><a role="menuitem" href="skill-test.html" data-menu-item
                  class="flex items-start gap-3 px-4 py-2.5 text-sm hover:bg-black/5 dark:hover:bg-white/10 focus:bg-black/5 dark:focus:bg-white/10 outline-none rounded-xl group"><span
                    class="material-symbols-rounded text-[20px] text-brand-500 dark:text-white/80 group-hover:scale-110 transition-transform">verified</span><span
                    class="flex flex-col"><span class="font-medium">Skill Test Portal</span><span
                      class="text-[11px] text-neutral-500 dark:text-white/40">Assess & verify skills</span></span></a>
              </li>
            </ul>
            <div
              class="px-4 py-3 border-t border-black/5 dark:border-white/10 bg-white/70 dark:bg-white/5 rounded-b-2xl flex items-center gap-3 text-xs text-neutral-500 dark:text-white/40">
              <span class="material-symbols-rounded text-base">tips_and_updates</span>
              <span>Boost collaboration with verified contributors.</span>
            </div>
          </div>
        </div>
        <a class="hover:text-brandlt-900 dark:hover:text-white" href="../contact.html">Contact</a>
        <a class="hover:text-brandlt-900 dark:hover:text-white" href="../help.html">Help</a>
        <a class="hover:text-brandlt-900 dark:hover:text-white" href="../collage/clg_info.html">Collages</a>
      </nav>
      <div class="hidden md:flex items-center gap-2">
        <button id="themeToggle" data-theme-toggle
          class="inline-flex items-center gap-2 rounded-full px-3 py-2 text-sm ring-1 ring-black/10 dark:ring-white/15 hover:bg-black/5 dark:hover:bg-white/5"
          aria-label="Toggle theme"><span class="material-symbols-rounded">dark_mode</span><span
            class="hidden sm:block">Theme</span></button>
        <a href="../login.html"
          class="text-sm text-neutral-700 dark:text-white/85 hover:text-brandlt-900 dark:hover:text-white px-3 py-2 rounded-full">Log
          in</a>
        <a href="../signup.html"
          class="inline-flex items-center justify-center rounded-full bg-brand-500 text-white text-sm font-semibold px-4 py-2.5 hover:shadow-glow transition">Sign
          up</a>
        <a id="navProfile" href="../profile.html" title="Profile"
          class="hidden items-center justify-center w-10 h-10 rounded-full overflow-hidden border border-black/10 dark:border-white/10 bg-white/90 dark:bg-brand-900/60"><img
            id="navProfileImg" alt="Profile" class="w-full h-full object-cover hidden" /><span id="navProfileInitial"
            class="text-xs font-semibold">ME</span></a>
        <button id="signOutBtn" type="button" title="Sign out" aria-label="Sign out"
          class="hidden items-center gap-2 rounded-full border border-black/10 dark:border-white/15 px-3 py-1.5 text-sm text-neutral-700 dark:text-white/80 hover:bg-black/5 dark:hover:bg-white/5 transition"><span
            class="material-symbols-rounded text-base">logout</span><span>Sign out</span></button>
      </div>
      <div class="md:hidden flex items-center gap-2">
        <button type="button" data-theme-toggle aria-label="Toggle theme"
          class="inline-flex items-center justify-center size-10 rounded-full ring-1 ring-black/10 dark:ring-white/15 hover:bg-black/5 dark:hover:bg-white/5 transition"><span
            class="material-symbols-rounded">dark_mode</span></button>
        <button id="mobileNavToggle" type="button" aria-expanded="false" aria-controls="mobileNavPanel"
          class="inline-flex items-center justify-center size-10 rounded-full ring-1 ring-black/10 dark:ring-white/15 hover:bg-black/5 dark:hover:bg-white/5 transition"><span
            class="sr-only">Toggle navigation</span><span class="material-symbols-rounded"
            data-icon>menu</span></button>
      </div>
    </div>
  </header>
  <!-- Mobile navigation (drawer) from index -->
  <div id="mobileNavBackdrop" aria-hidden="true"
    class="md:hidden fixed inset-0 z-40 bg-black/60 dark:bg-black/80 backdrop-blur-sm hidden"></div>
  <nav id="mobileNavPanel" aria-hidden="true"
    class="md:hidden fixed inset-x-4 top-24 z-50 hidden flex flex-col gap-5 max-h-[calc(100vh-6.5rem)] overflow-y-auto rounded-3xl border border-black/10 dark:border-white/10 bg-white/95 dark:bg-brand-900/95 shadow-card backdrop-blur supports-[backdrop-filter]:backdrop-blur-xl p-6">
    <div class="flex flex-col gap-2 text-sm text-neutral-700 dark:text-white/80">
      <a href="#" data-close-mobile-nav
        class="flex items-center justify-between rounded-xl px-3 py-2 bg-white/70 dark:bg-white/5 ring-1 ring-black/5 dark:ring-white/10"><span>Products</span><span
          class="material-symbols-rounded text-base opacity-70">expand_more</span></a>
      <a href="../about.html" data-close-mobile-nav
        class="rounded-xl px-3 py-2 hover:bg-brandlt-100/70 hover:dark:bg-brand-700/20 transition">About</a>
      <a href="#" data-close-mobile-nav
        class="flex items-center justify-between rounded-xl px-3 py-2 bg-white/70 dark:bg-white/5 ring-1 ring-black/5 dark:ring-white/10"><span>Developers</span><span
          class="material-symbols-rounded text-base opacity-70">expand_more</span></a>
      <a href="#" data-close-mobile-nav
        class="flex items-center justify-between rounded-xl px-3 py-2 bg-white/70 dark:bg-white/5 ring-1 ring-black/5 dark:ring-white/10"><span>Partners</span><span
          class="material-symbols-rounded text-base opacity-70">expand_more</span></a>
      <a href="../contact.html" data-close-mobile-nav
        class="rounded-xl px-3 py-2 hover:bg-brandlt-100/70 hover:dark:bg-brand-700/20 transition">Contact</a>
      <a href="../help.html" data-close-mobile-nav
        class="rounded-xl px-3 py-2 hover:bg-brandlt-100/70 hover:dark:bg-brand-700/20 transition">Help</a>
      <a href="../index.html#pricing" data-close-mobile-nav
        class="rounded-xl px-3 py-2 hover:bg-brandlt-100/70 hover:dark:bg-brand-700/20 transition">Pricing</a>
    </div>
    <div class="flex flex-col gap-3 border-t border-black/5 dark:border-white/10 pt-4">
      <a href="../login.html" data-close-mobile-nav
        class="inline-flex items-center justify-center rounded-full px-4 py-2 text-sm font-medium ring-1 ring-black/10 dark:ring-white/15 text-neutral-700 dark:text-white/80 hover:bg-black/5 dark:hover:bg-white/10 transition">Log
        in</a>
      <a href="../signup.html" data-close-mobile-nav
        class="inline-flex items-center justify-center rounded-full px-5 py-3 text-sm font-semibold text-white bg-gradient-to-r from-[#9E4B8A] via-[#B06AB3] to-[#FF7FD1] shadow-[0_4px_18px_-6px_rgba(158,75,138,0.6)] hover:shadow-[0_6px_24px_-8px_rgba(158,75,138,0.7)] transition">Sign
        up</a>
      <a id="navProfileMobile" href="../profile.html" data-close-mobile-nav
        class="hidden inline-flex items-center gap-2 rounded-xl border border-black/10 dark:border-white/15 px-4 py-2 text-sm text-neutral-700 dark:text-white/80 bg-white/70 dark:bg-brand-900/60"><span
          class="material-symbols-rounded text-base">account_circle</span><span data-profile-name>My profile</span></a>
      <button id="signOutBtnMobile" type="button"
        class="hidden inline-flex items-center gap-2 rounded-full border border-black/10 dark:border-white/15 px-4 py-2 text-sm text-neutral-700 dark:text-white/80 hover:bg-black/5 dark:hover:bg-white/10 transition"><span
          class="material-symbols-rounded text-base">logout</span><span>Sign out</span></button>
    </div>
  </nav>

  <!-- Hero / Filters -->
  <section class="relative border-b border-black/5 dark:border-white/10">
    <div class="container max-w-6xl py-8 md:py-12 space-y-8">
      <div class="flex flex-col md:flex-row md:items-end md:justify-between gap-6">
        <div class="space-y-4 max-w-2xl">
          <h1 class="text-3xl md:text-4xl font-extrabold gradient-hero-text leading-tight">Collaborative Project
            Postings</h1>
          <p class="text-neutral-600 dark:text-white/70 text-sm md:text-base">Discover active opportunities, evaluate
            tech stack fit, and contribute to real builds.</p>
        </div>
        <a href="project_post.html"
          class="inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-brand-500 via-[#B06AB3] to-[#FF7FD1] px-6 py-3 text-sm font-semibold text-white shadow-[0_8px_28px_-6px_rgba(158,75,138,0.45)] hover:shadow-[0_12px_36px_-8px_rgba(158,75,138,0.55)] transition"><span
            class="material-symbols-rounded text-base">add</span>New Project</a>
      </div>
      <div class="flex flex-col gap-4">
        <div class="flex flex-col sm:flex-row sm:items-center gap-3 justify-between">
          <div class="flex gap-3 w-full sm:w-auto">
            <select id="cat"
              class="rounded-2xl border border-black/10 dark:border-white/15 bg-white/80 dark:bg-white/5 px-3 py-2 text-sm text-neutral-800 dark:text-white focus:border-brand-500 focus:ring-brand-500/40 focus:outline-none">
              <option value="">All Categories</option>
              <option>AI/ML</option>
              <option>Web</option>
              <option>Mobile</option>
              <option>Robotics</option>
              <option>FinTech</option>
              <option>EdTech</option>
            </select>
            <select id="sort"
              class="rounded-2xl border border-black/10 dark:border-white/15 bg-white/80 dark:bg-white/5 px-3 py-2 text-sm text-neutral-800 dark:text-white focus:border-brand-500 focus:ring-brand-500/40 focus:outline-none">
              <option value="new">Sort: Newest</option>
            </select>
          </div>
          <div class="flex gap-3 w-full sm:w-auto">
            <div class="flex-1 relative min-w-[240px]">
              <span
                class="material-symbols-rounded absolute left-3 top-1/2 -translate-y-1/2 text-neutral-500 dark:text-white/40">search</span>
              <input id="q"
                class="w-full pl-10 rounded-2xl border border-black/10 dark:border-white/15 bg-white/80 dark:bg-white/5 px-3 py-2 text-sm text-neutral-900 dark:text-white focus:border-brand-500 focus:ring-brand-500/40 focus:outline-none"
                placeholder="Search titles, stacks, domains..." />
            </div>
            <button id="btnSearch"
              class="inline-flex items-center gap-2 rounded-2xl border border-black/10 dark:border-white/15 px-5 py-2 text-sm font-medium text-neutral-700 dark:text-white/80 hover:border-brand-500/50 transition"><span
                class="material-symbols-rounded text-base">tune</span>Filter</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <main class="py-10 md:py-14">
    <div class="container max-w-6xl">
      <div id="postingsGrid" class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3"></div>
    </div>
  </main>

  <footer class="border-t border-black/5 dark:border-white/10 py-10">
    <div
      class="container flex flex-col gap-3 text-sm text-neutral-500 dark:text-white/60 sm:flex-row sm:items-center sm:justify-between">
      <p>© <span id="y"></span> Paper X · Project Portal.</p>
      <div class="flex flex-wrap items-center gap-4">
        <a href="../about.html" class="hover:text-brand-500 dark:hover:text-white transition">About</a>
        <a href="../help.html" class="hover:text-brand-500 dark:hover:text-white transition">Help centre</a>
        <a href="../contact.html" class="hover:text-brand-500 dark:hover:text-white transition">Contact</a>
      </div>
    </div>
  </footer>

  <script>
    const yEl = document.getElementById('y'); if (yEl) yEl.textContent = new Date().getFullYear();
    const root = document.documentElement; const toggles = () => Array.from(document.querySelectorAll('[data-theme-toggle]'));
    function updateThemeIcons(mode) { toggles().forEach(btn => { const ic = btn.querySelector('.material-symbols-rounded'); if (ic) ic.textContent = mode === 'dark' ? 'light_mode' : 'dark_mode'; }); }
    function setTheme(mode) { mode === 'dark' ? root.classList.add('dark') : root.classList.remove('dark'); localStorage.setItem('px_theme', mode); updateThemeIcons(mode); }
    setTheme(root.classList.contains('dark') ? 'dark' : 'light');
    document.addEventListener('click', e => { const t = e.target.closest('[data-theme-toggle]'); if (!t) return; const next = root.classList.contains('dark') ? 'light' : 'dark'; setTheme(next); });
  </script>
  <script>
    // Enhanced Project Portal dropdown logic (copied from index)
    (function () {
      const wrap = document.getElementById('navProjectsWrap');
      if (!wrap) return;
      const btn = document.getElementById('navProjectsBtn');
      const menu = document.getElementById('navProjectsMenu');
      const caret = btn && btn.querySelector('[data-projects-caret]');
      const items = () => Array.from(menu.querySelectorAll('[data-menu-item]'));
      let open = false; let closeTimer = null;
      function applyState() { if (open) { menu.setAttribute('data-open', 'true'); btn.setAttribute('aria-expanded', 'true'); wrap.dataset.open = 'true'; if (caret) caret.textContent = 'expand_less'; setTimeout(() => { items()[0]?.focus(); }, 60); } else { menu.removeAttribute('data-open'); btn.setAttribute('aria-expanded', 'false'); wrap.dataset.open = 'false'; if (caret) caret.textContent = 'expand_more'; } }
      function setState(n) { if (n === open) return; open = n; applyState(); }
      function toggle() { setState(!open); }
      function close() { setState(false); }
      btn?.addEventListener('click', e => { e.preventDefault(); e.stopPropagation(); toggle(); });
      wrap.addEventListener('mouseenter', () => { if (window.matchMedia('(min-width: 1024px)').matches) setState(true); });
      wrap.addEventListener('mouseleave', () => { if (window.matchMedia('(min-width: 1024px)').matches) closeTimer = setTimeout(close, 120); });
      wrap.addEventListener('mousemove', () => { if (closeTimer) { clearTimeout(closeTimer); closeTimer = null; } });
      document.addEventListener('click', e => { if (!open) return; if (!wrap.contains(e.target)) close(); });
      document.addEventListener('keydown', e => {
        if (!open && (e.key === 'ArrowDown' || e.key === 'Enter' || e.key === ' ')) {
          if (document.activeElement === btn) { e.preventDefault(); setState(true); return; }
        }
        if (e.key === 'Escape' && open) { e.stopPropagation(); close(); btn.focus(); }
        if (open) { const list = items(); const idx = list.indexOf(document.activeElement); if (e.key === 'ArrowDown') { e.preventDefault(); const next = idx < 0 ? 0 : (idx + 1) % list.length; list[next].focus(); } else if (e.key === 'ArrowUp') { e.preventDefault(); const prev = idx < 0 ? list.length - 1 : (idx - 1 + list.length) % list.length; list[prev].focus(); } else if (e.key === 'Home') { e.preventDefault(); list[0]?.focus(); } else if (e.key === 'End') { e.preventDefault(); list[list.length - 1]?.focus(); } }
      });
      wrap.dataset.open = 'false'; btn.setAttribute('aria-expanded', 'false'); btn.setAttribute('aria-controls', 'navProjectsMenu');
    })();
  </script>
  <script>
    // Listings logic (adapted styles remain)
    // mobile menu
    // Auth-aware avatar
    (function () { const token = localStorage.getItem('px_token'); if (!token) return; document.querySelectorAll('a[href="../login.html"], a[href="../signup.html"]').forEach(el => el.classList.add('hidden')); const navProfile = document.getElementById('navProfile'); const navProfileImg = document.getElementById('navProfileImg'); const navProfileInitial = document.getElementById('navProfileInitial'); if (navProfile) navProfile.classList.remove('hidden'); const API = ((window.API_BASE || window.__API_BASE || 'http://127.0.0.1:8000')).replace(/\/$/, ''); fetch(`${API}/api/profile`, { headers: { Authorization: `Bearer ${token}` } }).then(r => r.ok ? r.json() : null).then(p => { if (!p) return; let initials = 'ME'; if (p.name) initials = p.name.split(' ').filter(Boolean).map(s => s[0]?.toUpperCase()).slice(0, 2).join(''); if (navProfileInitial) navProfileInitial.textContent = initials; if (p.profile_image_url && navProfileImg) { navProfileImg.src = p.profile_image_url; navProfileImg.classList.remove('hidden'); navProfileInitial.classList.add('hidden'); } }).catch(() => { }); })();

    (function () {
      const API = ((window.API_BASE || window.__API_BASE || 'http://127.0.0.1:8000')).replace(/\/$/, '');
      const grid = document.getElementById('postingsGrid');
      const q = document.getElementById('q');
      const cat = document.getElementById('cat');
      const btnSearch = document.getElementById('btnSearch');

      const skeleton = () => `
        <article class="rounded-2xl border border-black/5 dark:border-white/10 bg-white/80 dark:bg-white/5 p-4 animate-pulse">
          <div class="h-40 w-full bg-black/5 dark:bg-white/10 rounded-xl"></div>
          <div class="h-5 w-3/4 bg-black/5 dark:bg-white/10 rounded mt-4"></div>
          <div class="h-4 w-2/3 bg-black/5 dark:bg-white/10 rounded mt-2"></div>
          <div class="flex gap-2 mt-4">
            <div class="h-6 w-16 bg-black/5 dark:bg-white/10 rounded"></div>
            <div class="h-6 w-16 bg-black/5 dark:bg-white/10 rounded"></div>
            <div class="h-6 w-16 bg-black/5 dark:bg-white/10 rounded"></div>
          </div>
        </article>`;

      const esc = (s) => (s || '').toString().replace(/[&<>]/g, c => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;' }[c]));
      const chip = (t) => `<span class="rounded-full px-2 py-1 bg-brandlt-200/70 dark:bg-white/10 text-[11px] text-brand-700 dark:text-white/80 ring-1 ring-black/5 dark:ring-white/10">${esc(t)}</span>`;
      const domainPill = (d) => `<span class="text-[11px] rounded-full px-2 py-1 bg-gradient-to-r from-brand-500 to-brand-700 text-white shadow-sm">${esc(d)}</span>`;

      const initialsOf = (name) => (name || '').split(' ').filter(Boolean).map(s => s[0]?.toUpperCase()).slice(0, 2).join('') || 'U';

      // Helpers for skills parsing and match score
      const normalize = (s) => (s || '').toString().trim().toLowerCase();
      const splitSkills = (text) => {
        if (!text) return [];
        return text.split(/[,;\n\t|]+/).map(normalize).filter(Boolean);
      };
      const unique = (arr) => Array.from(new Set(arr));

      const token = localStorage.getItem('px_token');
      let mySkills = null; // null until loaded; [] if none
      const getMyProfileSkills = async () => {
        if (!token) return [];
        try {
          const r = await fetch(`${API}/api/profile`, { headers: { Authorization: `Bearer ${token}` } });
          if (!r.ok) return [];
          const prof = await r.json();
          const skills = unique([
            ...splitSkills(prof.skills),
            ...splitSkills(prof.technologies),
          ]);
          return skills;
        } catch { return []; }
      };

      const matchScore = (postSkills = [], mySkillsArr = []) => {
        const ps = unique((postSkills || []).map(normalize).filter(Boolean));
        const ms = new Set((mySkillsArr || []).map(normalize).filter(Boolean));
        const total = ps.length;
        let matches = 0;
        if (total && ms.size) {
          ps.forEach(s => { if (ms.has(s)) matches++; });
        }
        const percent = total ? Math.round((matches / total) * 100) : 0;
        return { matches, total, percent };
      };

      const render = (items = [], publishers = {}, mySkillsArr = []) => {
        if (!items.length) {
          grid.innerHTML = `<div class="col-span-full text-sm opacity-70 rounded-xl border border-black/10 dark:border-white/10 p-4">No postings yet.</div>`;
          return;
        }
        grid.innerHTML = items.map(p => {
          const b = p.basics || {};
          const cover = p.cover_url ? `<img src="${esc(p.cover_url)}" alt="Cover" class="w-full h-40 object-cover">` : `<div class="w-full h-40 bg-black/5 dark:bg:white/10"></div>`;
          const domain = (Array.isArray(b.domains) && b.domains[0]) ? domainPill(b.domains[0]) : '';
          const techs = (Array.isArray(b.tech_stack) ? b.tech_stack.slice(0, 3) : []).map(chip).join('');
          const title = esc(b.title || 'Untitled');
          const tagline = esc(b.tagline || (b.description || ''));
          const pub = publishers[p.user_id] || {};
          const pubName = esc(pub.name || 'View publisher');
          const pubHref = `public_profile.html?user_id=${encodeURIComponent(p.user_id || '')}`;
          const avatar = pub.profile_image_url
            ? `<img src="${esc(pub.profile_image_url)}" alt="${pubName}" class="w-7 h-7 rounded-full object-cover"/>`
            : `<span class="w-7 h-7 inline-flex items-center justify-center rounded-full bg-black/10 dark:bg:white/10 text-[10px]">${initialsOf(pub.name)}</span>`;
          const score = matchScore(b.tech_stack || [], mySkillsArr);
          const color = score.total === 0 ? 'bg-neutral-500/70' : (score.percent >= 66 ? 'bg-emerald-600' : score.percent >= 33 ? 'bg-amber-600' : 'bg-brand-700');
          const pillTitle = score.total ? `${score.matches} of ${score.total} skills match` : (mySkillsArr.length ? 'No skills listed in posting' : 'Add skills in profile to see match');
          const pill = `<span title="${esc(pillTitle)}" class="inline-flex items-center gap-1 text-[11px] ${color} text-white px-2 py-1 rounded-full shadow-md"><span class="material-symbols-rounded text-[15px]">bolt</span>${score.total ? score.percent + '%' : '—'}</span>`;

          return `
            <article class="relative lift rounded-3xl border border-black/5 dark:border-white/10 bg-white/80 dark:bg-white/5 backdrop-blur overflow-hidden cursor-pointer p-0" onclick="window.location.href='project.html?id=${encodeURIComponent(p.id)}'">
              <div class="absolute top-2 right-2 z-10">${pill}</div>
              <div class="overflow-hidden">${cover}</div>
              <div class="p-5">
                <div class="flex items-center justify-between">${domain}<span class="text-xs opacity-70"></span></div>
                <h3 class="mt-3 font-semibold text-neutral-900 dark:text-white line-clamp-1">${title}</h3>
                <p class="mt-1 text-sm text-neutral-600 dark:text-white/70 line-clamp-2">${tagline}</p>
                <div class="mt-3 flex flex-wrap gap-2">${techs}</div>
                <div class="mt-4 flex items-center justify-between">
                  <a href="${pubHref}" onclick="event.stopPropagation()" class="flex items-center gap-2 text-sm opacity-90 hover:opacity-100">
                    ${avatar}
                    <span class="hover:underline">${pubName}</span>
                  </a>
                  <button class="inline-flex items-center gap-1 rounded-full px-3 py-1.5 text-[11px] font-medium border border-black/10 dark:border-white/15 hover:border-brand-500/50 hover:bg-black/5 dark:hover:bg-white/10 transition"><span class="material-symbols-rounded text-[16px]">bookmark_add</span>Save</button>
                </div>
              </div>
            </article>`;
        }).join('');
      };

      const prefetchPublishers = async (items = []) => {
        const uids = Array.from(new Set(items.map(p => p.user_id).filter(Boolean)));
        const entries = await Promise.all(uids.map(async uid => {
          try {
            const r = await fetch(`${API}/api/public/profiles/${encodeURIComponent(uid)}`);
            if (!r.ok) throw new Error('nf');
            const d = await r.json();
            return [uid, d];
          } catch { return [uid, { user_id: uid }]; }
        }));
        const map = {};
        entries.forEach(([k, v]) => map[k] = v);
        return map;
      };

      const load = async () => {
        grid.innerHTML = skeleton() + skeleton() + skeleton();
        try {
          if (mySkills === null) mySkills = await getMyProfileSkills();
          const r = await fetch(`${API}/api/projects`);
          let items = await r.json();
          if (!Array.isArray(items)) items = [];
          // basic client-side filter using nested basics
          const term = (q.value || '').toLowerCase();
          const catVal = (cat.value || '').toLowerCase();
          const filtered = items.filter(p => {
            const b = p.basics || {};
            const joined = [b.title, b.tagline, b.description, ...(b.tech_stack || []), ...(b.domains || [])].join(' ').toLowerCase();
            const inTerm = !term || joined.includes(term);
            const inCat = !catVal || (Array.isArray(b.domains) && b.domains.join(' ').toLowerCase().includes(catVal));
            return inTerm && inCat;
          });
          const publishers = await prefetchPublishers(filtered);
          render(filtered, publishers, mySkills || []);
        } catch (e) {
          grid.innerHTML = `<div class=\"col-span-full text-sm opacity-70 rounded-xl border border-black/10 dark:border-white/10 p-4\">Failed to load postings.</div>`;
        }
      };

      btnSearch.addEventListener('click', load);
      q.addEventListener('keydown', (e) => { if (e.key === 'Enter') { e.preventDefault(); load(); } });
      cat.addEventListener('change', load);
      load();
    })();
  </script>
</body>

</html>